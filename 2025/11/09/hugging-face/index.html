<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <base href="http://mospany.github.io/">
  <title>å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ - å¢¨æ–¯æ½˜åœ’</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  <meta name="keywords" content="æŠ€æœ¯æ–‡ç« ,äººå·¥æ™ºèƒ½,">
  <meta name="description" content="1ã€æ¨¡å‹æ–‡ä»¶ ä»¥Qwen1.5-32B-Chat-AWQæ¨¡å‹æ–‡ä»¶åˆ—è¡¨ä¸ºä¾‹ï¼š shengping.mo@y108p30:/data2/huggingface/Qwen/Qwen1.5-32B-Chat-AWQ$ ls -lh total 20G -rw-r--r-- 1 xd xd 839 Jun 27 22:30 config.json -rw-r--r-- 1 xd xd 243 Jun 27 22:30 generation_config.json -rw-r--r-- 1 xd xd 6.8K Jun 27 22:30 LICENSE -rw-r--r-- 1">
  <meta name="author" content="mospan">
  <meta itemprop="name" content="å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ - å¢¨æ–¯æ½˜åœ’">
  <meta itemprop="description" content="1ã€æ¨¡å‹æ–‡ä»¶ ä»¥Qwen1.5-32B-Chat-AWQæ¨¡å‹æ–‡ä»¶åˆ—è¡¨ä¸ºä¾‹ï¼š shengping.mo@y108p30:/data2/huggingface/Qwen/Qwen1.5-32B-Chat-AWQ$ ls -lh total 20G -rw-r--r-- 1 xd xd 839 Jun 27 22:30 config.json -rw-r--r-- 1 xd xd 243 Jun 27 22:30 generation_config.json -rw-r--r-- 1 xd xd 6.8K Jun 27 22:30 LICENSE -rw-r--r-- 1">
  <meta itemprop="image" content="http://mospany.github.io/img/author.jpg">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@mospan" />
  <meta name="twitter:title" content="å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ - å¢¨æ–¯æ½˜åœ’" />
  
  <meta name="twitter:description" content="">
  <link rel="shortcut icon" href="img/favicon.ico"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png" />
  <link rel="stylesheet" href="highlight/styles/github.css">
  <script src="highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="font/hack/css/hack.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <header>
    <div>
  
  <div id="imglogo">
    <a href="http://mospany.github.io/"><img src="http://mospany.github.io/img/logo.jpg" alt="å¢¨æ–¯æ½˜åœ’" title="å¢¨æ–¯æ½˜åœ’"/></a>
  </div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="http://mospany.github.io/" title="å¢¨æ–¯æ½˜åœ’">å¢¨æ–¯æ½˜åœ’</a></h1>
    <h2 class="blog-motto">æŠ€æœ¯æ”¹å˜ç”Ÿæ´»ï¼Œå­¦ä¹ æˆå°±æœªæ¥</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">é¦–é¡µ</a></li> 
      
      <li><a href="/about">å…³äº</a></li> 
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder="æœç´¢">
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="http://mospany.github.io/2025/11/09/hugging-face/" title="å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ" itemprop="url">å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ</a>
  </h1>
  <p class="article-author">By 
    
      <a href="http://blog.mospan.cn" title="mospan">mospan</a>
    
  </p>
  <p class="article-time">
    <time datetime="2025-11-09 11:24:40 &#43;0800 CST" itemprop="datePublished">2025å¹´11æœˆ09æ—¥</time>
  </p>
</header>

	<div class="article-content">
    
    

<h1 id="1-æ¨¡å‹æ–‡ä»¶">1ã€æ¨¡å‹æ–‡ä»¶</h1>

<p>ä»¥Qwen1.5-32B-Chat-AWQæ¨¡å‹æ–‡ä»¶åˆ—è¡¨ä¸ºä¾‹ï¼š</p>

<pre><code class="language-json">shengping.mo@y108p30:/data2/huggingface/Qwen/Qwen1.5-32B-Chat-AWQ$ ls -lh
total 20G
-rw-r--r-- 1 xd xd  839 Jun 27 22:30 config.json
-rw-r--r-- 1 xd xd  243 Jun 27 22:30 generation_config.json
-rw-r--r-- 1 xd xd 6.8K Jun 27 22:30 LICENSE
-rw-r--r-- 1 xd xd 1.6M Jun 27 22:30 merges.txt
-rw-r--r-- 1 xd xd 4.7G Jun 27 22:28 model-00001-of-00005.safetensors
-rw-r--r-- 1 xd xd 4.7G Jun 27 22:29 model-00002-of-00005.safetensors
-rw-r--r-- 1 xd xd 4.7G Jun 27 22:29 model-00003-of-00005.safetensors
-rw-r--r-- 1 xd xd 4.3G Jun 27 22:30 model-00004-of-00005.safetensors
-rw-r--r-- 1 xd xd 1.5G Jun 27 22:30 model-00005-of-00005.safetensors
-rw-r--r-- 1 xd xd 140K Jun 27 22:30 model.safetensors.index.json
-rw-r--r-- 1 xd xd 4.0K Jun 27 22:30 README.md
-rw-r--r-- 1 xd xd 1.3K Jun 27 22:30 tokenizer_config.json
-rw-r--r-- 1 xd xd 6.8M Jun 27 22:30 tokenizer.json
-rw-r--r-- 1 xd xd 2.7M Jun 27 22:30 vocab.json
shengping.mo@y108p30:/data2/huggingface/Qwen/Qwen1.5-32B-Chat-AWQ$ 
</code></pre>

<h1 id="2-æ•´ä½“åˆ†æ">2ã€æ•´ä½“åˆ†æ</h1>

<ol>
<li><p>config.json</p>

<ol>
<li>å­˜å‚¨æ¨¡å‹æ¶æ„å…ƒæ•°æ®ï¼ŒåŒ…æ‹¬ç½‘ç»œå±‚æ•°ï¼Œéšè—ç»´åº¦ï¼Œæ³¨æ„åŠ›å¤´æ•°ï¼Œè¯è¡¨å¤§å°ï¼Œæ¿€æ´»å‡½æ•°ç±»å‹ç­‰å‚æ•°
<br /></li>
</ol></li>

<li><p>æ¨¡å‹æƒé‡æ–‡ä»¶ï¼štorchÂ å’ŒÂ hfÂ æƒé‡æ–‡ä»¶</p>

<ol>
<li><p>pytroch_model.pth:Â ç”¨äºä¿å­˜æ¨¡å‹æƒé‡å‚æ•°çš„äºŒè¿›åˆ¶æ–‡ä»¶ï¼Œä»¥å­—å…¸çš„å½¢å¼ä¿å­˜ï¼Œé”®ä¸ºå±‚åç§°ï¼Œå€¼ä¸ºå¯¹åº”çš„æƒé‡å¼ é‡æ•°æ®ã€‚</p></li>

<li><p>model.safetensorï¼šå’Œpthæƒé‡æ–‡ä»¶çš„åŠŸèƒ½ç›¸åŒï¼ŒåŒºåˆ«æ˜¯é‡‡ç”¨äº†å®‰å…¨åºåˆ—åŒ–æ ¼å¼ï¼Œé¿å…ååºåˆ—åŒ–æ¼æ´é£é™©ã€‚</p></li>

<li><p>åˆ†ç‰‡æƒé‡æ–‡ä»¶ï¼šå¯¹äºè¶…å¤§å‹çš„æ¨¡å‹æƒé‡ï¼Œä¼šè¢«åˆ†å‰²æˆå¤šä¸ªæ–‡ä»¶ï¼Œè§£å†³å•ä¸ªæ–‡ä»¶ä½“ç§¯é™åˆ¶é—®é¢˜ã€‚</p></li>
</ol></li>

<li><p>åˆ†è¯å™¨ç›¸å…³</p>

<ol>
<li><p>tokenizer_config.json:Â åˆ†è¯å™¨ç±»å‹ã€ç‰¹æ®Šæ ‡è®°çš„å®šä¹‰</p></li>

<li><p>tokenizer.json:Â å°†åˆ†è¯å™¨çš„æ‰€æœ‰é…ç½®ä¿¡æ¯ï¼ŒåŒ…æ‹¬è¯æ±‡è¡¨ï¼Œåˆå¹¶è§„åˆ™ï¼Œå½’ä¸€åŒ–ï¼Œé¢„åˆ†è¯ï¼Œåå¤„ç†ç­‰æ‰“åŒ…åœ¨ä¸€èµ·ï¼Œç›®çš„æ˜¯è®©è®­ç»ƒå’Œæ¨ç†è¿‡ç¨‹ä¸­çš„åˆ†è¯è¡Œä¸ºå®Œå…¨ä¸€è‡´ã€‚</p></li>
</ol></li>

<li><p>æ–‡æœ¬ç”Ÿæˆå‚æ•°é…ç½®æ–‡ä»¶Â </p>

<ol>
<li>generation_config.jsonï¼šå®šä¹‰æ–‡æœ¬ç”Ÿæˆç­–ç•¥ï¼ŒåŒ…æ‹¬æ¸©åº¦ï¼Œtop-pç­‰è¶…å‚æ•°ã€‚
<br /></li>
</ol></li>
</ol>

<h3 id="tokenizer-json">tokenizer.json</h3>

<p>æ–‡ä»¶å®šä¹‰äº†åˆ†è¯å™¨çš„æ‰€æœ‰é…ç½®</p>

<ol>
<li><p>added_tokens:Â åŸæœ‰è¯æ±‡è¡¨åŸºç¡€ä¸Šé¢å¤–æ·»åŠ çš„ç‰¹æ®Štoken([PAD]Â [CLS])</p></li>

<li><p>post_processor:Â åå¤„ç†æ¨¡æ¿ï¼Œè®¾ç½®å•å¥ï¼ŒåŒå¥å¯¹è¾“å…¥æ—¶è¾“å…¥æ—¶è‡ªåŠ¨æ·»åŠ [cls]Â å’ŒÂ [sep]</p></li>

<li><p>decoderï¼šè§£ç å™¨ç±»å‹</p></li>

<li><p>modelï¼šåº•å±‚åˆ†è¯å™¨æ¨¡å‹Â çš„ç±»å‹åŠå…¶å‚æ•°ã€‚</p>

<ol>
<li><p>Vocab:Â å®šä¹‰äº†è¯æ±‡è¡¨ï¼Œå…¶ä¸­keyä¸ºtokençš„å­—ç¬¦ä¸²ï¼Œvalueä¸ºå¯¹åº”çš„idã€‚</p></li>

<li><p>mergesï¼šå®šä¹‰äº†å­tokenåˆå¹¶æˆæ›´é•¿tokençš„è§„åˆ™ã€‚</p></li>
</ol></li>
</ol>

<h3 id="special-tokens-map-json">special_tokens_map.json</h3>

<p>æ–‡ä»¶å®šä¹‰äº†ä¸æ–‡æœ¬åºåˆ—å¤„ç†ç›¸å…³çš„ç‰¹æ®Štoken</p>

<ol>
<li><p>bos_tokenÂ (BeginningÂ ofÂ SentenceÂ Token):Â åºåˆ—å¼€å§‹æ ‡è®°ï¼Œæ–‡æœ¬åºåˆ—çš„èµ·å§‹ä½ç½®</p></li>

<li><p>eos_tokenÂ (EndÂ ofÂ SentenceÂ Token)ï¼šÂ åºåˆ—ç»“æŸæ ‡è®°ï¼Œè¡¨ç¤ºæ–‡æœ¬åºåˆ—çš„ç»“æŸä½ç½®ã€‚</p></li>

<li><p>eop_tokenÂ (EndÂ ofÂ ParagraphÂ Token):Â æ®µè½ç»“æŸæ ‡è®°ï¼Œè¡¨ç¤ºæ®µè½ç»“æŸçš„ç‰¹æ®Šæ ‡è®°</p></li>

<li><p>pad_tokenÂ (PaddingÂ Token):Â å¡«å……æ ‡è®°ï¼Œå®ƒå°†ç”¨äºæ–‡æœ¬åºåˆ—å¡«å……åˆ°ç›¸åŒé•¿åº¦æ—¶ä½¿ç”¨çš„ç‰¹æ®Štokenã€‚tokenizer.jsonÂ æ–‡ä»¶è§£æã€‚Â </p></li>
</ol>

<h1 id="3-å…·ä½“åˆ†æ">3ã€å…·ä½“åˆ†æ</h1>

<h2 id="3-1-config-json">3.1Â config.json</h2>

<p>ä½œç”¨ï¼šç”¨äº<strong>æè¿°æ¨¡å‹çš„ç»“æ„ã€è¶…å‚æ•°ã€è®­ç»ƒæ–¹å¼ã€ç‰¹æ®Šè¡Œä¸ºç­‰ä¿¡æ¯</strong>ï¼Œåœ¨åŠ è½½æ¨¡å‹æ—¶è‡ªåŠ¨è§£æå¹¶æ„å»ºæ¨¡å‹å®ä¾‹ã€‚</p>

<pre><code class="language-json">{
  // ä½¿ç”¨çš„æ¨¡å‹æ¶æ„åç§°
  &quot;architectures&quot;: [
    &quot;Qwen2ForCausalLM&quot;
  ],
  // æ³¨æ„åŠ›å±‚çš„dropoutæ¯”ä¾‹
  &quot;attention_dropout&quot;: 0.0,
  // å¥å­èµ·å§‹ï¼ˆBOSï¼‰tokençš„ID
  &quot;bos_token_id&quot;: 151643,
  // å¥å­ç»“æŸï¼ˆEOSï¼‰tokençš„ID
  &quot;eos_token_id&quot;: 151645,
  // éšè—å±‚æ¿€æ´»å‡½æ•°
  &quot;hidden_act&quot;: &quot;silu&quot;,
  // éšè—å±‚ç»´åº¦
  &quot;hidden_size&quot;: 5120,
  // å‚æ•°åˆå§‹åŒ–èŒƒå›´
  &quot;initializer_range&quot;: 0.02,
  // å‰é¦ˆç½‘ç»œä¸­é—´å±‚çš„ç»´åº¦
  &quot;intermediate_size&quot;: 27392,
  // æœ€å¤§ä½ç½®ç¼–ç é•¿åº¦
  &quot;max_position_embeddings&quot;: 32768,
  // æ”¯æŒæ»‘åŠ¨çª—å£çš„æœ€å¤§å±‚æ•°
  &quot;max_window_layers&quot;: 35,
  // æ¨¡å‹ç±»å‹æ ‡è¯†
  &quot;model_type&quot;: &quot;qwen2&quot;,
  // æ³¨æ„åŠ›å¤´çš„æ•°é‡
  &quot;num_attention_heads&quot;: 40,
  // Transformerå±‚çš„æ•°é‡
  &quot;num_hidden_layers&quot;: 64,
  // key-valueæ³¨æ„åŠ›å¤´çš„æ•°é‡ï¼ˆç”¨äºåˆ†ç»„æ³¨æ„åŠ›ç­‰ï¼‰
  &quot;num_key_value_heads&quot;: 8,
  // é‡åŒ–ç›¸å…³é…ç½®
  &quot;quantization_config&quot;: {
    // é‡åŒ–ä½æ•°
    &quot;bits&quot;: 4,
    // é‡åŒ–åˆ†ç»„å¤§å°
    &quot;group_size&quot;: 32,
    // ä¸è¿›è¡Œé‡åŒ–çš„æ¨¡å—
    &quot;modules_to_not_convert&quot;: null,
    // é‡åŒ–æ–¹æ³•
    &quot;quant_method&quot;: &quot;awq&quot;,
    // é‡åŒ–ç‰ˆæœ¬
    &quot;version&quot;: &quot;gemm&quot;,
    // æ˜¯å¦ä½¿ç”¨é›¶ç‚¹
    &quot;zero_point&quot;: true
  },
  // RMSNormçš„epsilonå€¼
  &quot;rms_norm_eps&quot;: 1e-06,
  // ROPEä½ç½®ç¼–ç çš„thetaå‚æ•°
  &quot;rope_theta&quot;: 1000000.0,
  // æ»‘åŠ¨çª—å£é•¿åº¦
  &quot;sliding_window&quot;: 32768,
  // æ˜¯å¦å…±äº«è¯åµŒå…¥æƒé‡
  &quot;tie_word_embeddings&quot;: false,
  // PyTorchä¸­ä½¿ç”¨çš„æ•°æ®ç±»å‹
  &quot;torch_dtype&quot;: &quot;float16&quot;,
  // transformersåº“çš„ç‰ˆæœ¬
  &quot;transformers_version&quot;: &quot;4.38.2&quot;,
  // æ˜¯å¦ä½¿ç”¨ç¼“å­˜ï¼ˆåŠ é€Ÿæ¨ç†ï¼‰
  &quot;use_cache&quot;: true,
  // æ˜¯å¦å¯ç”¨æ»‘åŠ¨çª—å£æœºåˆ¶
  &quot;use_sliding_window&quot;: false,
  // è¯è¡¨å¤§å°
  &quot;vocab_size&quot;: 152064
}
</code></pre>

<h3 id="ä¸€-åŸºæœ¬æ¨¡å‹è§„æ ¼">ğŸ§ Â ä¸€ã€åŸºæœ¬æ¨¡å‹è§„æ ¼</h3>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>model_type</code>:Â <code>&quot;qwen2&quot;</code></td>
<td>æ¨¡å‹ç±»å‹</td>
<td>æ¥è‡ªé˜¿é‡Œè¾¾æ‘©é™¢çš„Â Qwen2Â ç³»åˆ—</td>
</tr>

<tr>
<td><code>architectures</code>:Â <code>&quot;Qwen2ForCausalLM&quot;</code></td>
<td>æ¶æ„</td>
<td>è‡ªå›å½’è¯­è¨€æ¨¡å‹ï¼ˆCausalÂ LanguageÂ Modelï¼‰</td>
</tr>

<tr>
<td><code>hidden_size</code>:Â <code>5120</code></td>
<td>æ¯å±‚ç»´åº¦</td>
<td>å¤§å‹æ¨¡å‹ï¼ˆä¼°ç®—Â 20BÂ å‚æ•°çº§åˆ«ï¼‰</td>
</tr>

<tr>
<td><code>num_hidden_layers</code>:Â <code>64</code></td>
<td>TransformerÂ å±‚æ•°</td>
<td>å±‚æ•°éå¸¸æ·±</td>
</tr>

<tr>
<td><code>num_attention_heads</code>:Â <code>40</code></td>
<td>æ³¨æ„åŠ›å¤´æ•°</td>
<td></td>
</tr>

<tr>
<td><code>num_key_value_heads</code>:Â <code>8</code></td>
<td>KVÂ åˆ†ç»„æ•°é‡</td>
<td>è¡¨æ˜é‡‡ç”¨äº†Â <strong>GroupedÂ QueryÂ AttentionÂ (GQA)</strong></td>
</tr>

<tr>
<td><code>intermediate_size</code>:Â <code>27392</code></td>
<td>FFNÂ å±‚ç»´åº¦</td>
<td></td>
</tr>

<tr>
<td><code>vocab_size</code>:Â <code>152064</code></td>
<td>è¯è¡¨å¤§å°</td>
<td>åŒ…å«ä¸­æ–‡/è‹±æ–‡ç­‰å¤šè¯­è¨€è¯è¡¨</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="äºŒ-ä¸Šä¸‹æ–‡å’Œä½ç½®å¤„ç†">ğŸ§ Â äºŒã€ä¸Šä¸‹æ–‡å’Œä½ç½®å¤„ç†</h3>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>max_position_embeddings</code>:Â <code>32768</code></td>
<td>æœ€å¤§ä½ç½®åµŒå…¥ï¼ˆç†è®ºæœ€å¤§ä¸Šä¸‹æ–‡é•¿åº¦ï¼‰</td>
</tr>

<tr>
<td><code>sliding_window</code>:Â <code>32768</code></td>
<td>å®é™…çª—å£å¤§å°</td>
</tr>

<tr>
<td><code>max_window_layers</code>:Â <code>35</code></td>
<td>å¯æ”¯æŒæ»‘åŠ¨çª—å£çš„å±‚æ•°</td>
</tr>

<tr>
<td><code>rope_theta</code>:Â <code>1e6</code></td>
<td>ç”¨äºÂ RoPEï¼ˆæ—‹è½¬ä½ç½®ç¼–ç ï¼‰çš„é¢‘ç‡å‚æ•°ï¼ˆé€‚é…é•¿ä¸Šä¸‹æ–‡ï¼‰</td>
</tr>
</tbody>
</table>

<p>ğŸ“ŒÂ <strong>è¯´æ˜</strong>ï¼šè¿™æ˜¯ä¸€ä¸ª<strong>æ”¯æŒè¶…é•¿ä¸Šä¸‹æ–‡</strong>ï¼ˆ32KÂ tokenï¼‰çš„æ¨¡å‹ï¼Œé€‚åˆï¼š</p>

<ul>
<li><p>è¯»å¤§æ–‡æ¡£ï¼ˆPDF/åˆåŒ/ä»£ç ï¼‰</p></li>

<li><p>é•¿å¯¹è¯å†å²ä¿æŒä¸Šä¸‹æ–‡è¿è´¯</p></li>

<li><p>æ–‡æœ¬å®¡æ ¡ã€çŸ¥è¯†æå–</p></li>
</ul>

<hr />

<h3 id="ä¸‰-ä¼˜åŒ–ä¸é‡åŒ–é…ç½®">âš™ï¸Â ä¸‰ã€ä¼˜åŒ–ä¸é‡åŒ–é…ç½®</h3>

<table>
<thead>
<tr>
<th>å‚æ•°</th>
<th>å«ä¹‰</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>quantization_config.bits</code>:Â <code>4</code></td>
<td>4-bitÂ é‡åŒ–</td>
</tr>

<tr>
<td><code>quant_method</code>:Â <code>awq</code></td>
<td>ä½¿ç”¨Â AWQï¼ˆActivation-awareÂ WeightÂ Quantizationï¼‰</td>
</tr>

<tr>
<td><code>group_size</code>:Â <code>32</code></td>
<td>æ¯ç»„å‚æ•°é‡åŒ–å—å¤§å°</td>
</tr>

<tr>
<td><code>version</code>:Â <code>gemm</code></td>
<td>é‡åŒ–å†…æ ¸ç±»å‹ï¼ŒåŸºäºÂ GEMM</td>
</tr>

<tr>
<td><code>zero_point</code>:Â true</td>
<td>ä½¿ç”¨Â Zero-pointÂ å¯¹ç§°é‡åŒ–</td>
</tr>

<tr>
<td><code>torch_dtype</code>:Â <code>&quot;float16&quot;</code></td>
<td>åŠç²¾åº¦Â float16Â è¿ç®—</td>
</tr>
</tbody>
</table>

<p>ğŸ“ŒÂ <strong>è¯´æ˜</strong>ï¼šè¿™è¯´æ˜è¿™ä¸ªæ¨¡å‹æ˜¯ç»è¿‡Â <strong>4bitÂ AWQÂ é‡åŒ–ä¼˜åŒ–çš„ç‰ˆæœ¬</strong>ï¼Œæ„å‘³ç€ä½ å¯ä»¥ï¼š</p>

<ul>
<li><p>åœ¨æ¶ˆè´¹çº§æ˜¾å¡ï¼ˆæ¯”å¦‚Â 24GÂ æ˜¾å­˜ï¼‰è¿è¡Œ</p></li>

<li><p>å»¶è¿Ÿæ›´ä½ï¼Œæ¨ç†é€Ÿåº¦å¿«</p></li>

<li><p>éƒ¨ç½²æˆæœ¬é™ä½</p></li>
</ul>

<h2 id="3-2-generation-config-json">3.2Â generation_config.json</h2>

<p>æ¨ç†å‚æ•°ï¼ˆç”Ÿæˆç­–ç•¥ï¼‰é…ç½®æ–‡ä»¶,Â Â ç”¨äºæ§åˆ¶æ¨¡å‹ç”Ÿæˆæ–‡æœ¬æ—¶çš„è¡Œä¸ºï¼ˆä¾‹å¦‚é‡‡æ ·ç­–ç•¥ã€ç»ˆæ­¢ç¬¦å·ã€é‡å¤æƒ©ç½šç­‰ï¼‰ï¼ŒÂ è¿™æ®µÂ JSONÂ æ˜¯æ¨¡å‹çš„â€œç”Ÿæˆç­–ç•¥è¯´æ˜ä¹¦â€ï¼Œæ§åˆ¶æ¨¡å‹å¦‚ä½•ä»è¾“å…¥ä¸­â€œè¯´å‡ºâ€ä¸‹ä¸€å¥è¯ã€‚</p>

<pre><code class="language-json">{
  // èµ·å§‹æ ‡è®°çš„token id
  &quot;bos_token_id&quot;: 151643,
  // æ˜¯å¦ä½¿ç”¨é‡‡æ ·ç”Ÿæˆ
  &quot;do_sample&quot;: true,
  // ç»“æŸæ ‡è®°çš„token idåˆ—è¡¨
  &quot;eos_token_id&quot;: [
    151645,
    151643
  ],
  // å¡«å……tokençš„id
  &quot;pad_token_id&quot;: 151643,
  // é‡å¤æƒ©ç½šç³»æ•°
  &quot;repetition_penalty&quot;: 1.05,
  // é‡‡æ ·æ¸©åº¦
  &quot;temperature&quot;: 0.7,
  // top-ké‡‡æ ·å‚æ•°
  &quot;top_k&quot;: 20,
  // top-pé‡‡æ ·å‚æ•°
  &quot;top_p&quot;: 0.8,
  // transformersåº“çš„ç‰ˆæœ¬
  &quot;transformers_version&quot;: &quot;4.38.2&quot;
}
</code></pre>

<h3 id="å­—æ®µè§£æä¸ä½œç”¨">ğŸ”Â å­—æ®µè§£æä¸ä½œç”¨</h3>

<table>
<thead>
<tr>
<th>å‚æ•°å</th>
<th>ç¤ºä¾‹å€¼</th>
<th>å«ä¹‰ä¸ä½œç”¨</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>bos_token_id</code></td>
<td><code>151643</code></td>
<td>BeginÂ OfÂ Sequenceï¼Œç”Ÿæˆèµ·å§‹æ ‡è®°Â tokenÂ ID</td>
</tr>

<tr>
<td><code>eos_token_id</code></td>
<td><code>[151645,Â 151643]</code></td>
<td>EndÂ OfÂ Sequenceï¼Œé‡åˆ°è¿™äº›Â tokenÂ IDÂ æ—¶åœæ­¢ç”Ÿæˆ</td>
</tr>

<tr>
<td><code>pad_token_id</code></td>
<td><code>151643</code></td>
<td>ç”¨äºÂ paddingï¼ˆå¯¹é½åºåˆ—ï¼‰æ—¶ä½¿ç”¨çš„Â tokenÂ ID</td>
</tr>

<tr>
<td><code>do_sample</code></td>
<td><code>true</code></td>
<td>å¯ç”¨é‡‡æ ·ï¼ˆå¦åˆ™æ˜¯è´ªå©ª/beamÂ searchï¼‰</td>
</tr>

<tr>
<td><code>temperature</code></td>
<td><code>0.7</code></td>
<td>æ§åˆ¶é‡‡æ ·éšæœºæ€§ï¼ˆå€¼è¶Šä½è¶Šç¡®å®šï¼‰</td>
</tr>

<tr>
<td><code>top_k</code></td>
<td><code>20</code></td>
<td>é™åˆ¶æ¯ä¸€æ­¥é‡‡æ ·æ—¶æœ€å¤šè€ƒè™‘å‰Â 20Â ä¸ªæ¦‚ç‡æœ€é«˜çš„Â token</td>
</tr>

<tr>
<td><code>top_p</code></td>
<td><code>0.8</code></td>
<td>nucleusÂ samplingï¼ˆåªè€ƒè™‘ç´¯ç§¯æ¦‚ç‡Â â‰¥Â 0.8Â çš„Â tokenï¼‰</td>
</tr>

<tr>
<td><code>repetition_penalty</code></td>
<td><code>1.05</code></td>
<td>æƒ©ç½šé‡å¤è¯è¯­ï¼ˆ&gt;1Â ä¼šé™ä½é‡å¤å‡ºç°Â tokenÂ çš„æ¦‚ç‡ï¼‰</td>
</tr>

<tr>
<td><code>transformers_version</code></td>
<td><code>&quot;4.38.2&quot;</code></td>
<td>æŒ‡æ˜æ­¤é…ç½®å…¼å®¹çš„Â HuggingFaceÂ TransformersÂ ç‰ˆæœ¬</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="å®é™…ç”Ÿæˆä¸­å®ƒæ€ä¹ˆç”¨">ğŸ§ Â å®é™…ç”Ÿæˆä¸­å®ƒæ€ä¹ˆç”¨ï¼Ÿ</h3>

<p>ä½ åŠ è½½æ¨¡å‹åï¼Œå¦‚æœè¯¥æ–‡ä»¶å­˜åœ¨ï¼ŒTransformersÂ ä¼šè‡ªåŠ¨è¯»å–è¿™äº›å‚æ•°å¹¶åº”ç”¨åˆ°Â <code>generate()</code>Â è°ƒç”¨ä¸­ï¼š</p>

<pre><code class="language-python">from transformers import AutoTokenizer, AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(&quot;Qwen/Qwen2-7B&quot;)
tokenizer = AutoTokenizer.from_pretrained(&quot;Qwen/Qwen2-7B&quot;)

input_ids = tokenizer(&quot;ä½ å¥½ï¼Œè¯·å¸®æˆ‘æ€»ç»“ä¸€ä¸‹è¿™æ®µè¯ï¼š&quot;, return_tensors=&quot;pt&quot;).input_ids
outputs = model.generate(input_ids)
print(tokenizer.decode(outputs[0], skip_special_tokens=True))

</code></pre>

<blockquote>
<p>å¦‚æœç›®å½•ä¸‹å­˜åœ¨Â <code>generation_config.json</code>ï¼Œ<code>model.generate()</code>Â ä¼šé»˜è®¤è¯»å–å…¶ä¸­çš„è®¾ç½®ï¼ˆå¦‚Â <code>top_k</code>,Â <code>temperature</code>Â ç­‰ï¼‰ã€‚</p>
</blockquote>

<p>ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨è¦†ç›–å®ƒï¼š</p>

<pre><code class="language-python">outputs = model.generate(
    input_ids,
    temperature=0.7,
    top_k=20,
    top_p=0.8,
    repetition_penalty=1.05,
    do_sample=True,
    max_new_tokens=256
)

</code></pre>

<hr />

<h3 id="ä½ å¯ä»¥ç”¨å®ƒåšä»€ä¹ˆ">âœ…Â ä½ å¯ä»¥ç”¨å®ƒåšä»€ä¹ˆï¼Ÿ</h3>

<ul>
<li><p><strong>è‡ªå®šä¹‰ç”Ÿæˆé£æ ¼</strong>ï¼šæ›´éšæœºæˆ–æ›´ç¡®å®šã€æ§åˆ¶é‡å¤</p></li>

<li><p><strong>ä¼˜åŒ–å¯¹è¯æµç•…æ€§</strong>ï¼šç»“åˆÂ <code>eos_token_id</code>ï¼Œèƒ½æ›´è‡ªç„¶åœ°ä¸­æ­¢è¾“å‡º</p></li>

<li><p><strong>è‡ªåŠ¨åŒ–éƒ¨ç½²</strong>ï¼šå¤šä¸ªæ¨¡å‹å¯ç»Ÿä¸€è¯»å–ç”Ÿæˆç­–ç•¥æ–‡ä»¶</p></li>
</ul>

<hr />

<h2 id="3-3-merges-txt">3.3Â merges.txt</h2>

<p><code>merges.txt</code>Â æ˜¯Â HuggingÂ FaceÂ æ¨¡å‹ä¸­çš„ä¸€ä¸ªÂ <strong>åˆ†è¯å™¨ï¼ˆTokenizerï¼‰æ–‡ä»¶</strong>ï¼Œå®ƒæ˜¯Â <strong>ByteÂ PairÂ Encodingï¼ˆBPEï¼‰</strong>Â åˆ†è¯ç®—æ³•çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œé…åˆÂ <code>vocab.json</code>Â ä½¿ç”¨ï¼Œå†³å®šäº†å¦‚ä½•å°†æ–‡æœ¬åˆ†å‰²æˆÂ tokenã€‚</p>

<p><img src="https://alidocs.oss-cn-zhangjiakou.aliyuncs.com/res/4jKqm0b8gmBmbnw1/img/ad459646-9cf9-4b50-9321-5f022f5f71d6.png" alt="image.png" /></p>

<p><code>merges.txt</code>Â æ˜¯Â HuggingÂ FaceÂ æ¨¡å‹ä¸­çš„ä¸€ä¸ªÂ <strong>åˆ†è¯å™¨ï¼ˆTokenizerï¼‰æ–‡ä»¶</strong>ï¼Œå®ƒæ˜¯Â <strong>ByteÂ PairÂ Encodingï¼ˆBPEï¼‰</strong>Â åˆ†è¯ç®—æ³•çš„æ ¸å¿ƒç»„æˆéƒ¨åˆ†ä¹‹ä¸€ï¼Œé…åˆÂ <code>vocab.json</code>Â ä½¿ç”¨ï¼Œå†³å®šäº†å¦‚ä½•å°†æ–‡æœ¬åˆ†å‰²æˆÂ tokenã€‚</p>

<hr />

<h3 id="bpe-åˆ†è¯ç®—æ³•èƒŒæ™¯ç®€è¿°">ğŸ§ Â BPEÂ åˆ†è¯ç®—æ³•èƒŒæ™¯ç®€è¿°</h3>

<p><strong>ByteÂ PairÂ EncodingÂ (BPE)</strong>Â æ˜¯ä¸€ç§åŸºäºé¢‘ç‡çš„å­è¯ï¼ˆsubwordï¼‰åˆ†è¯æ–¹æ³•ï¼Œå¸¸ç”¨äºï¼š</p>

<ul>
<li><p>GPTÂ ç³»åˆ—ï¼ˆåŒ…æ‹¬Â OpenAIÂ æ¨¡å‹ï¼‰</p></li>

<li><p>RoBERTaã€DistilBERTã€Qwenã€LLaMAã€BLOOMÂ ç­‰Â HuggingFaceÂ æ¨¡å‹</p></li>

<li><p>é€‚ç”¨äºå¤šè¯­è¨€ã€ä¸­æ–‡ã€ä»£ç ç­‰</p></li>
</ul>

<hr />

<h3 id="merges-txt-æ–‡ä»¶ä½œç”¨">ğŸ“‚Â <code>**merges.txt**</code>Â æ–‡ä»¶ä½œç”¨</h3>

<p><strong>å®šä¹‰æ¯ä¸€æ­¥åˆå¹¶å“ªäº›å­è¯ï¼Œå½¢æˆæ–°çš„è¯ç‰‡æ®µï¼ˆtokenï¼‰</strong>ï¼Œå³ï¼š</p>

<ul>
<li><p>ä»åŸå§‹å­—ç¬¦é€æ­¥æ„å»ºæ›´å¤§çš„å¸¸è§å­è¯</p></li>

<li><p>ä¿ç•™é«˜é¢‘ç»„åˆã€å‡å°‘è¯è¡¨å¤§å°ã€æå‡è¡¨ç¤ºèƒ½åŠ›</p></li>
</ul>

<hr />

<h3 id="æ–‡ä»¶å†…å®¹æ ¼å¼ç¤ºä¾‹">ğŸ§¾Â æ–‡ä»¶å†…å®¹æ ¼å¼ç¤ºä¾‹</h3>

<pre><code class="language-txt">#version: 0.2
t h
th e
he r
re s
es t
...

</code></pre>

<p>æ¯ä¸€è¡Œæ˜¯ä¸€ä¸ªÂ <strong>åˆå¹¶è§„åˆ™ï¼ˆmergeÂ ruleï¼‰</strong>ï¼Œæ ¼å¼ä¸ºä¸¤ä¸ªç©ºæ ¼åˆ†éš”çš„å­è¯ï¼ˆsymbolï¼‰ï¼š</p>

<pre><code class="language-plaintext">A B

</code></pre>

<p>è¡¨ç¤ºÂ <code>AÂ BÂ â†’Â AB</code>Â çš„åˆå¹¶æ“ä½œã€‚æ¨¡å‹åœ¨åˆ†è¯æ—¶ä¼šæŒ‰è¿™äº›è§„åˆ™é¡ºåºåœ°å°†å­—ç¬¦å¯¹åˆå¹¶æˆÂ tokenï¼Œç›´åˆ°æ— æ³•åˆå¹¶ä¸ºæ­¢ã€‚</p>

<hr />

<h3 id="ä¸-vocab-json-çš„å…³ç³»">ğŸ”„Â ä¸Â vocab.jsonÂ çš„å…³ç³»</h3>

<table>
<thead>
<tr>
<th>æ–‡ä»¶</th>
<th>ä½œç”¨</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>vocab.json</code></td>
<td>ä¿å­˜æœ€ç»ˆçš„Â tokenÂ â†’Â idÂ æ˜ å°„ï¼ˆæ‰€æœ‰å¯ç”¨Â tokenï¼‰</td>
</tr>

<tr>
<td><code>merges.txt</code></td>
<td>ä¿å­˜Â BPEÂ åˆå¹¶è§„åˆ™ï¼ˆä»å­—ç¬¦æ„é€ è¿™äº›Â tokenÂ çš„è·¯å¾„ï¼‰</td>
</tr>
</tbody>
</table>

<blockquote>
<p>äºŒè€…å…±åŒå®šä¹‰äº†åˆ†è¯å™¨çš„è¡Œä¸ºï¼Œç¼ºä¸€ä¸å¯ã€‚</p>
</blockquote>

<hr />

<h3 id="åº”ç”¨ä¸¾ä¾‹-gpt-åˆ†è¯è¿‡ç¨‹">ğŸ“¦Â åº”ç”¨ä¸¾ä¾‹ï¼šGPTÂ åˆ†è¯è¿‡ç¨‹</h3>

<p>å‡è®¾åŸå§‹æ–‡æœ¬æ˜¯Â <code>&quot;there&quot;</code></p>

<ol>
<li><p>åˆå§‹å­—ç¬¦åºåˆ—ï¼š<code>[&quot;t&quot;,Â &quot;h&quot;,Â &quot;e&quot;,Â &quot;r&quot;,Â &quot;e&quot;]</code></p></li>

<li><p>ç¬¬ä¸€æ¬¡åŒ¹é…åˆå¹¶è§„åˆ™ï¼š<code>tÂ hÂ â†’Â th</code></p></li>

<li><p>å˜ä¸ºï¼š<code>[&quot;th&quot;,Â &quot;e&quot;,Â &quot;r&quot;,Â &quot;e&quot;]</code></p></li>

<li><p>ç„¶åï¼š<code>thÂ eÂ â†’Â the</code></p></li>

<li><p>ç„¶åï¼š<code>theÂ rÂ â†’Â ther</code></p></li>

<li><p>ç„¶åï¼š<code>therÂ eÂ â†’Â there</code>Â â†’Â âœ…Â å®Œæ•´Â token</p></li>
</ol>

<p>æœ€ç»ˆå°±æ˜¯ä¸€ä¸ªÂ tokenï¼š<code>there</code>ï¼Œå¯¹åº”Â <code>vocab.json</code>Â ä¸­çš„æŸä¸ªÂ IDã€‚</p>

<hr />

<h3 id="æ€ä¹ˆæŸ¥çœ‹">ğŸ”Â æ€ä¹ˆæŸ¥çœ‹ï¼Ÿ</h3>

<p>ä½¿ç”¨Â HuggingFaceÂ TokenizerÂ APIÂ æŸ¥çœ‹åˆ†è¯å™¨ï¼š</p>

<pre><code class="language-python">from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(&quot;Qwen/Qwen2-7B&quot;)
print(tokenizer.tokenize(&quot;there&quot;))

</code></pre>

<hr />

<h3 id="å¸¸è§ç”¨é€”">ğŸ› ï¸Â å¸¸è§ç”¨é€”</h3>

<table>
<thead>
<tr>
<th>ä½œç”¨</th>
<th>ç¤ºä¾‹</th>
</tr>
</thead>

<tbody>
<tr>
<td>âœ…Â è‡ªå®šä¹‰åˆ†è¯å™¨</td>
<td>ç”¨ä½ è‡ªå·±çš„Â <code>merges.txt</code>Â +Â <code>vocab.json</code>Â åˆ›å»ºåˆ†è¯å™¨</td>
</tr>

<tr>
<td>ğŸ§ªÂ åˆ†ææ¨¡å‹åˆ†è¯ä¹ æƒ¯</td>
<td>çœ‹å“ªäº›è¯è¢«æ‹†äº†ï¼Œæ¯”å¦‚ä¸­æ–‡Â <code>æ•°æ®å¤„ç†</code>Â â†’Â <code>æ•°</code>,Â <code>æ®</code>,Â <code>å¤„ç†</code></td>
</tr>

<tr>
<td>ğŸ“¦Â å¾®è°ƒÂ tokenizer</td>
<td>ç”¨Â HuggingFaceÂ <code>tokenizers</code>Â å·¥å…·é‡æ–°è®­ç»ƒÂ tokenizer</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="å®æˆ˜ç¤ºä¾‹-åˆ›å»ºè‡ªå®šä¹‰-bpe-åˆ†è¯å™¨">ğŸ§°Â å®æˆ˜ç¤ºä¾‹ï¼šåˆ›å»ºè‡ªå®šä¹‰Â BPEÂ åˆ†è¯å™¨</h3>

<pre><code class="language-python">from tokenizers import Tokenizer, models, trainers, pre_tokenizers

tokenizer = Tokenizer(models.BPE())
tokenizer.pre_tokenizer = pre_tokenizers.Whitespace()

trainer = trainers.BpeTrainer(vocab_size=10000, special_tokens=[&quot;&lt;pad&gt;&quot;, &quot;&lt;unk&gt;&quot;])
tokenizer.train([&quot;your_corpus.txt&quot;], trainer)

tokenizer.save(&quot;tokenizer.json&quot;)  # é‡Œé¢åŒ…å« vocab å’Œ merges

</code></pre>

<hr />

<h3 id="æ€»ç»“ä¸€å¥è¯">âœ…Â æ€»ç»“ä¸€å¥è¯</h3>

<blockquote>
<p><code>merges.txt</code>Â æ˜¯Â HuggingFaceÂ BPEÂ åˆ†è¯å™¨çš„â€œåˆå¹¶è§„åˆ™è¡¨â€ï¼Œå‘Šè¯‰æ¨¡å‹å¦‚ä½•ä»å­—ç¬¦ç»„åˆæˆÂ tokenï¼Œå®ƒæ˜¯Â <code>vocab.json</code>Â çš„æ„é€ è¿‡ç¨‹è®°å½•ï¼ŒäºŒè€…é…åˆç”¨äºæ¨¡å‹è¾“å…¥çš„åˆ†è¯å¤„ç†ã€‚</p>
</blockquote>

<hr />

<h2 id="3-4-model-00001-of-000xx-safetensors">3.4Â model-00001-of-000XX.safetensors</h2>

<p><code>model-00001-of-000XX.safetensors</code>Â æ˜¯Â HuggingÂ FaceÂ æˆ–ç±»ä¼¼æ¡†æ¶åœ¨ä¿å­˜å¤§å‹æ¨¡å‹æƒé‡æ—¶ç”Ÿæˆçš„æ–‡ä»¶ä¹‹ä¸€ã€‚å…¶ä¸­XXå€¼ä»£è¡¨æœ‰å¤šå°‘ä¸ªç±»ä¼¼çš„æƒé‡æ–‡ä»¶ï¼Œè¿™ä¸ªæ–‡ä»¶çš„Â <strong>ä½œç”¨æ˜¯ä¿å­˜æ¨¡å‹çš„å®é™…æƒé‡ï¼ˆå‚æ•°ï¼‰æ•°æ®</strong>ï¼Œæ˜¯æ¨ç†æˆ–è®­ç»ƒæ—¶çœŸæ­£åŠ è½½åˆ°æ¨¡å‹ä¸­çš„æ ¸å¿ƒå†…å®¹ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯æ¦‚æ‹¬">ğŸ“¦Â ä¸€å¥è¯æ¦‚æ‹¬</h3>

<blockquote>
<p><code>model-00001-of-000XX.safetensors</code>Â æ˜¯ä¿å­˜Â TransformerÂ æ¨¡å‹å‚æ•°çš„<strong>åˆ†ç‰‡åŒ–Â safetensorsÂ æ–‡ä»¶</strong>ï¼Œå®ƒæ˜¯Â <code>.bin</code>Â çš„å®‰å…¨é«˜æ•ˆæ›¿ä»£ï¼Œç”¨äºå¤šæ–‡ä»¶åˆ†å¸ƒå¼åŠ è½½å¤§å‹æ¨¡å‹ã€‚</p>
</blockquote>

<hr />

<h3 id="æ–‡ä»¶ç»„æˆä¸å‘½åç»“æ„">ğŸ”Â æ–‡ä»¶ç»„æˆä¸å‘½åç»“æ„</h3>

<p>æ¯”å¦‚ä½ çœ‹åˆ°è¿™æ ·çš„ç›®å½•ç»“æ„ï¼š</p>

<pre><code class="language-bash">model-00001-of-00007.safetensors
model-00002-of-00007.safetensors
...
model-00007-of-00007.safetensors
model.safetensors.index.json
config.json
tokenizer.json
generation_config.json
...

</code></pre>

<p>å«ä¹‰å¦‚ä¸‹ï¼š</p>

<table>
<thead>
<tr>
<th>æ–‡ä»¶å</th>
<th>å«ä¹‰</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>model-00001-of-00007.safetensors</code></td>
<td>æ¨¡å‹å‚æ•°çš„ç¬¬Â 1Â ä¸ªåˆ†ç‰‡ï¼Œå…±Â 7Â ä¸ª</td>
</tr>

<tr>
<td><code>model.safetensors.index.json</code></td>
<td>è®°å½•æ¯ä¸ªæƒé‡å¼ é‡å­˜å‚¨åœ¨å“ªä¸ªåˆ†ç‰‡ä¸­ï¼ˆç´¢å¼•æ–‡ä»¶ï¼‰</td>
</tr>

<tr>
<td><code>config.json</code></td>
<td>æ¨¡å‹ç»“æ„æè¿°</td>
</tr>

<tr>
<td><code>tokenizer.json</code>Â /Â <code>merges.txt</code></td>
<td>åˆ†è¯å™¨æ–‡ä»¶</td>
</tr>

<tr>
<td><code>generation_config.json</code></td>
<td>æ–‡æœ¬ç”Ÿæˆç­–ç•¥é…ç½®</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="safetensors-æ ¼å¼ç®€æ">ğŸ§ Â safetensorsÂ æ ¼å¼ç®€æ</h3>

<p><code>safetensors</code>Â æ˜¯ä¸€ç§ç”±Â HuggingÂ FaceÂ ç¤¾åŒºä¸»å¯¼å¼€å‘çš„<strong>å®‰å…¨ã€å¿«é€Ÿã€é›¶æ‹·è´çš„æ¨¡å‹æƒé‡ä¿å­˜æ ¼å¼</strong>ï¼Œç”¨äºæ›¿ä»£æ—©æœŸçš„Â <code>.bin</code>ï¼ˆPyTorchÂ pickleï¼‰æ ¼å¼ã€‚</p>

<h4 id="ç›¸æ¯”-bin-æ ¼å¼çš„ä¼˜åŠ¿">âœ…Â ç›¸æ¯”Â <code>**.bin**</code>Â æ ¼å¼çš„ä¼˜åŠ¿ï¼š</h4>

<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th><code>.bin</code></th>
<th><code>.safetensors</code></th>
</tr>
</thead>

<tbody>
<tr>
<td>å®‰å…¨æ€§ï¼ˆé¿å…æ‰§è¡ŒÂ pickleï¼‰</td>
<td>âŒÂ å¯èƒ½æ‰§è¡Œæ¶æ„ä»£ç </td>
<td>âœ…Â å®Œå…¨é™æ€æ•°æ®</td>
</tr>

<tr>
<td>åŠ è½½é€Ÿåº¦ï¼ˆé›¶æ‹·è´Â mmapï¼‰</td>
<td>è¾ƒæ…¢</td>
<td>âœ…Â æå¿«</td>
</tr>

<tr>
<td>åˆ†ç‰‡æ”¯æŒ</td>
<td>âœ…</td>
<td>âœ…</td>
</tr>

<tr>
<td>é€šç”¨æ€§ï¼ˆå…¼å®¹Â PyTorchï¼‰</td>
<td>âœ…</td>
<td>âœ…ï¼ˆHuggingFaceÂ ä¸“ç”¨ï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="æ–‡ä»¶å†…éƒ¨ç»“æ„">ğŸ”Â æ–‡ä»¶å†…éƒ¨ç»“æ„</h3>

<p>ä½ ä¸èƒ½ç›´æ¥æ‰“å¼€Â <code>.safetensors</code>Â æ–‡ä»¶ï¼Œä½†å¯ä»¥ç”¨Â <code>safetensors</code>Â å®˜æ–¹åº“è¯»å–å…¶ä¸­å†…å®¹ï¼š</p>

<pre><code class="language-python">from safetensors import safe_open

with safe_open(&quot;model-00001-of-00007.safetensors&quot;, framework=&quot;pt&quot;) as f:
    for name in f.keys():
        tensor = f.get_tensor(name)
        print(name, tensor.shape)

</code></pre>

<p>è¿™äº›Â <code>name</code>Â å°±æ˜¯æ¨¡å‹çš„æƒé‡åï¼ˆå¦‚ï¼š<code>transformer.h.0.attn.q_proj.weight</code>ï¼‰ï¼Œå¯¹åº”æ¨¡å‹å±‚ã€‚</p>

<hr />

<h3 id="model-safetensors-index-json-ä½œç”¨">ğŸ“¦Â <code>**model.safetensors.index.json**</code>Â ä½œç”¨</h3>

<p>è¿™ä¸ªÂ JSONÂ æ–‡ä»¶å‘Šè¯‰æ¡†æ¶ï¼š</p>

<ul>
<li><p>æ‰€æœ‰å‚æ•°éƒ½æœ‰å“ªäº›</p></li>

<li><p>æ¯ä¸ªå‚æ•°åœ¨å“ªä¸ªÂ <code>.safetensors</code>Â åˆ†ç‰‡ä¸­</p></li>

<li><p>æ¯ä¸ªÂ tensorÂ çš„å½¢çŠ¶ä¸æ•°æ®ç±»å‹</p></li>
</ul>

<p>ç¤ºä¾‹ç»“æ„å¦‚ä¸‹ï¼š</p>

<pre><code class="language-json">{
  &quot;metadata&quot;: {
    &quot;total_size&quot;: 54123342123
  },
  &quot;weight_map&quot;: {
    &quot;transformer.h.0.attn.q_proj.weight&quot;: &quot;model-00001-of-00007.safetensors&quot;,
    &quot;transformer.h.0.attn.k_proj.weight&quot;: &quot;model-00001-of-00007.safetensors&quot;,
    ...
  }
}

</code></pre>

<p>è¿™æ ·æ¡†æ¶å°±èƒ½åœ¨å¤šä¸ªåˆ†ç‰‡ä¸­æ‰¾åˆ°æ¯ä¸ªå‚æ•°çš„ä½ç½®ã€‚</p>

<hr />

<h3 id="å¦‚ä½•åŠ è½½å«-safetensors-çš„æ¨¡å‹">ğŸ› ï¸Â å¦‚ä½•åŠ è½½å«Â <code>**.safetensors**</code>Â çš„æ¨¡å‹ï¼Ÿ</h3>

<p>ä½¿ç”¨Â HuggingÂ FaceÂ TransformersÂ ä¼šè‡ªåŠ¨è¯†åˆ«ï¼š</p>

<pre><code class="language-python">from transformers import AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(&quot;your_model_dir&quot;, trust_remote_code=True)

</code></pre>

<p>æ¡†æ¶ä¼šï¼š</p>

<ul>
<li><p>åŠ è½½Â <code>config.json</code>Â æ„å»ºæ¨¡å‹ç»“æ„</p></li>

<li><p>åŠ è½½Â <code>safetensors.index.json</code>Â æ˜ å°„æ–‡ä»¶</p></li>

<li><p>ä»å¤šä¸ªÂ <code>.safetensors</code>Â åˆ†ç‰‡ä¸­åŠ è½½æƒé‡</p></li>
</ul>

<hr />

<h3 id="å¦‚æœä½ è¦ä¿å­˜ä¸º-safetensors">ğŸ“¤Â å¦‚æœä½ è¦ä¿å­˜ä¸ºÂ <code>**.safetensors**</code></h3>

<pre><code class="language-python">from transformers import AutoModelForCausalLM

model.save_pretrained(&quot;your_dir&quot;, safe_serialization=True)

</code></pre>

<p>å®ƒä¼šè‡ªåŠ¨ç”Ÿæˆï¼š</p>

<ul>
<li><p>åˆ†ç‰‡çš„Â <code>model-xxxx-of-yyyy.safetensors</code></p></li>

<li><p><code>model.safetensors.index.json</code></p></li>
</ul>

<p>ä½ ä¹Ÿå¯ä»¥è®¾ç½®Â <code>max_shard_size</code>Â æ§åˆ¶åˆ†ç‰‡å¤§å°ï¼ˆå¦‚Â <code>&quot;2GB&quot;</code>ï¼‰ã€‚</p>

<hr />

<h3 id="æ€»ç»“">âœ…Â æ€»ç»“</h3>

<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å†…å®¹</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ–‡ä»¶å</td>
<td><code>model-00001-of-000XX.safetensors</code></td>
</tr>

<tr>
<td>ä½œç”¨</td>
<td>å­˜å‚¨Â TransformerÂ æ¨¡å‹å‚æ•°çš„åˆ†ç‰‡ï¼ˆæƒé‡ï¼‰</td>
</tr>

<tr>
<td>æ­é…ä½¿ç”¨</td>
<td><code>model.safetensors.index.json</code>Â æä¾›ç´¢å¼•</td>
</tr>

<tr>
<td>åŠ è½½æ–¹å¼</td>
<td>è‡ªåŠ¨ç”±Â HuggingÂ FaceÂ TransformersÂ è¯†åˆ«</td>
</tr>

<tr>
<td>æ›¿ä»£æ ¼å¼</td>
<td>æ›´å¿«ã€æ›´å®‰å…¨çš„Â <code>.bin</code>Â æ›¿ä»£å“</td>
</tr>

<tr>
<td>åº”ç”¨åœºæ™¯</td>
<td>å¤§æ¨¡å‹åˆ†å¸ƒå¼æƒé‡ç®¡ç†ï¼Œç§æœ‰éƒ¨ç½²ï¼Œå®‰å…¨æ¨¡å‹åˆ†å‘</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-5-model-safetensors-index-json">3.5Â model.safetensors.index.json</h2>

<p><code>model.safetensors.index.json</code>Â æ˜¯Â HuggingÂ FaceÂ TransformersÂ åœ¨ä½¿ç”¨Â <code>.safetensors</code>Â æ ¼å¼ä¿å­˜å¤§æ¨¡å‹æƒé‡æ—¶ç”Ÿæˆçš„Â <strong>ç´¢å¼•æ–‡ä»¶</strong>ï¼Œç”¨äºè®°å½•Â <strong>æ¯ä¸ªæ¨¡å‹å‚æ•°ï¼ˆtensorï¼‰åœ¨å“ªä¸ªåˆ†ç‰‡æ–‡ä»¶ä¸­</strong>ï¼Œè®©æ¨¡å‹åŠ è½½å™¨èƒ½æ­£ç¡®åˆ†å¸ƒå¼åŠ è½½å¤šä¸ªÂ <code>.safetensors</code>Â æ–‡ä»¶ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯æ€»ç»“">ğŸ§ Â ä¸€å¥è¯æ€»ç»“</h3>

<blockquote>
<p><code>model.safetensors.index.json</code>Â æ˜¯å¤šåˆ†ç‰‡Â <code>.safetensors</code>Â æƒé‡æ–‡ä»¶çš„<strong>ç›®å½•æ˜ å°„è¡¨</strong>ï¼Œè®°å½•äº†æ¯ä¸ªæƒé‡å¼ é‡çš„æ–‡ä»¶ä½ç½®ã€‚</p>
</blockquote>

<hr />

<h3 id="ä¸ºä»€ä¹ˆéœ€è¦å®ƒ">ğŸ“¦Â ä¸ºä»€ä¹ˆéœ€è¦å®ƒï¼Ÿ</h3>

<p>å½“æ¨¡å‹å¾ˆå¤§ï¼ˆä¾‹å¦‚Â 7B/14B/70Bï¼‰ï¼Œæ‰€æœ‰å‚æ•°æ— æ³•æ”¾è¿›ä¸€ä¸ªÂ <code>.safetensors</code>Â æ–‡ä»¶æ—¶ï¼Œä¼šè¢«æ‹†æˆå¤šç‰‡ï¼Œæ¯”å¦‚ï¼š</p>

<pre><code class="language-plaintext">model-00001-of-00007.safetensors
model-00002-of-00007.safetensors
...
model-00007-of-00007.safetensors

</code></pre>

<p>è¿™æ—¶å°±éœ€è¦ä¸€ä¸ªç´¢å¼•æ–‡ä»¶å‘Šè¯‰ä½ ï¼š</p>

<ul>
<li><p>æ¯ä¸ªÂ tensorÂ å­˜åœ¨å“ªä¸ªåˆ†ç‰‡æ–‡ä»¶é‡Œ</p></li>

<li><p>æ‰€æœ‰æƒé‡ä¸€å…±å¤šå¤§</p></li>
</ul>

<hr />

<h3 id="æ–‡ä»¶ç»“æ„è¯¦è§£">ğŸ“„Â æ–‡ä»¶ç»“æ„è¯¦è§£</h3>

<pre><code class="language-json">{
    &quot;metadata&quot;: {
        // æ€»å¤§å°ï¼ˆå­—èŠ‚ï¼‰
        &quot;total_size&quot;: 21011769344
    },
    &quot;weight_map&quot;: {
        // åµŒå…¥å±‚æƒé‡æ–‡ä»¶
        &quot;model.embed_tokens.weight&quot;: &quot;model-00001-of-00005.safetensors&quot;,
        // ç¬¬0å±‚è‡ªæ³¨æ„åŠ›q_projçš„æƒé‡æ–‡ä»¶
        &quot;model.layers.0.self_attn.q_proj.qweight&quot;: &quot;model-00001-of-00005.safetensors&quot;,
        &quot;model.layers.0.self_attn.q_proj.qzeros&quot;: &quot;model-00001-of-00005.safetensors&quot;,
        &quot;model.layers.0.self_attn.q_proj.scales&quot;: &quot;model-00001-of-00005.safetensors&quot;,
        &quot;model.layers.0.self_attn.q_proj.bias&quot;: &quot;model-00001-of-00005.safetensors&quot;,
</code></pre>

<p>ä¸€ä¸ªå…¸å‹çš„Â <code>model.safetensors.index.json</code>Â æ–‡ä»¶å†…å®¹å¦‚ä¸‹ï¼ˆå·²æ ¼å¼åŒ–ï¼‰ï¼š</p>

<pre><code class="language-json">{
  &quot;metadata&quot;: {
    &quot;total_size&quot;: 13789162534  // æ‰€æœ‰åˆ†ç‰‡çš„æ€»å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰
  },
  &quot;weight_map&quot;: {
    &quot;model.embed_tokens.weight&quot;: &quot;model-00001-of-00007.safetensors&quot;,
    &quot;model.layers.0.self_attn.q_proj.weight&quot;: &quot;model-00001-of-00007.safetensors&quot;,
    &quot;model.layers.0.self_attn.k_proj.weight&quot;: &quot;model-00001-of-00007.safetensors&quot;,
    ...
    &quot;lm_head.weight&quot;: &quot;model-00007-of-00007.safetensors&quot;
  }
}

</code></pre>

<hr />

<h3 id="å­—æ®µè§£é‡Š">ğŸ§©Â å­—æ®µè§£é‡Š</h3>

<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>ç±»å‹</th>
<th>å«ä¹‰</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>metadata.total_size</code></td>
<td>int</td>
<td>æ‰€æœ‰æƒé‡æ€»å¤§å°ï¼ˆå­—èŠ‚æ•°ï¼‰</td>
</tr>

<tr>
<td><code>weight_map</code></td>
<td>dict</td>
<td>keyÂ ä¸ºå‚æ•°åï¼ŒvalueÂ ä¸ºå¯¹åº”çš„åˆ†ç‰‡æ–‡ä»¶å</td>
</tr>
</tbody>
</table>

<p>ä¾‹å¦‚ï¼š</p>

<pre><code class="language-json">&quot;model.layers.42.mlp.down_proj.weight&quot;: &quot;model-00006-of-00007.safetensors&quot;

</code></pre>

<p>è¡¨ç¤ºè¿™ä¸€å±‚çš„å‚æ•°åœ¨ç¬¬Â 6Â ä¸ªæƒé‡åˆ†ç‰‡ä¸­ã€‚</p>

<hr />

<h3 id="ä½¿ç”¨æ–¹å¼">ğŸ› ï¸Â ä½¿ç”¨æ–¹å¼</h3>

<p>å½“ä½ ç”¨Â TransformersÂ çš„Â <code>.from_pretrained()</code>Â åŠ è½½Â safetensorsÂ æƒé‡æ—¶ï¼Œå®ƒä¼šï¼š</p>

<ol>
<li><p>è¯»å–Â <code>config.json</code>Â å»ºå¥½æ¨¡å‹ç»“æ„</p></li>

<li><p>æ£€æŸ¥æ˜¯å¦æœ‰Â <code>model.safetensors.index.json</code></p></li>

<li><p>æ ¹æ®Â <code>weight_map</code>Â å»æ¯ä¸ªåˆ†ç‰‡Â <code>.safetensors</code>Â æ–‡ä»¶åŠ è½½å‚æ•°</p></li>
</ol>

<p>ä½ æ— éœ€æ‰‹åŠ¨æ“ä½œã€‚</p>

<pre><code class="language-python">from transformers import AutoModelForCausalLM

model = AutoModelForCausalLM.from_pretrained(&quot;path/to/model&quot;, trust_remote_code=True)

</code></pre>

<hr />

<h3 id="è‡ªå®šä¹‰ç”¨æ³•-é«˜çº§">âœï¸Â è‡ªå®šä¹‰ç”¨æ³•ï¼ˆé«˜çº§ï¼‰</h3>

<p>ä½ å¯ä»¥ä¿®æ”¹æˆ–ç”Ÿæˆè‡ªå·±çš„Â <code>model.safetensors.index.json</code>ï¼Œä¾‹å¦‚ï¼š</p>

<ul>
<li><p><strong>åŠ è½½éƒ¨åˆ†æƒé‡</strong>ï¼šæ¯”å¦‚åªåŠ è½½Â encoderÂ å±‚ç”¨äºå¾®è°ƒ</p></li>

<li><p><strong>é‡æ–°åˆ†ç‰‡</strong>ï¼šå°†ä¸€ä¸ªå¤§æ–‡ä»¶æ‹†æˆå¤šä¸ªåˆ†ç‰‡</p></li>
</ul>

<p>å·¥å…·åŒ…æ”¯æŒï¼š</p>

<pre><code class="language-python">from safetensors.torch import load_file
from transformers import PreTrainedModel

# å¯è¯»å–ç‰¹å®š safetensors æ–‡ä»¶
tensors = load_file(&quot;model-00001-of-00007.safetensors&quot;)

</code></pre>

<hr />

<h3 id="è¡¥å……è¯´æ˜">ğŸ“ŒÂ è¡¥å……è¯´æ˜</h3>

<ul>
<li><p><code>.index.json</code>Â æ˜¯Â <strong>åªè¯»è¾…åŠ©æ–‡ä»¶</strong>ï¼Œä¸åŒ…å«å‚æ•°å€¼æœ¬èº«</p></li>

<li><p><strong>ä¸å¯ç¼ºå¤±</strong>ï¼šå¦‚æœæœ‰å¤šä¸ªåˆ†ç‰‡ï¼Œå¿…é¡»å­˜åœ¨æ­¤æ–‡ä»¶ï¼Œå¦åˆ™åŠ è½½ä¼šæŠ¥é”™</p></li>

<li><p>å¯¹åº”Â <code>.bin</code>Â çš„åŒç±»æ–‡ä»¶å«Â <code>pytorch_model.bin.index.json</code></p></li>
</ul>

<hr />

<h3 id="æ€»ç»“-1">âœ…Â æ€»ç»“</h3>

<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å†…å®¹</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ–‡ä»¶å</td>
<td><code>model.safetensors.index.json</code></td>
</tr>

<tr>
<td>ä½œç”¨</td>
<td>è®°å½•æ¯ä¸ªæ¨¡å‹å‚æ•°åœ¨å“ªä¸ªÂ <code>.safetensors</code>Â åˆ†ç‰‡ä¸­</td>
</tr>

<tr>
<td>ç”¨äº</td>
<td>è‡ªåŠ¨å¤šåˆ†ç‰‡åŠ è½½ã€åˆ†å¸ƒå¼éƒ¨ç½²ã€èŠ‚çœå†…å­˜</td>
</tr>

<tr>
<td>å…¸å‹é…å¥—æ–‡ä»¶</td>
<td><code>model-00001-of-00007.safetensors</code>Â ç­‰å¤šä¸ªåˆ†ç‰‡</td>
</tr>

<tr>
<td>è‡ªåŠ¨å¤„ç†</td>
<td>TransformersÂ æ¡†æ¶ä¼šè‡ªåŠ¨è§£æå¹¶åŠ è½½</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-6-readme-md">3.6Â README.md</h2>

<p>åœ¨Â HuggingÂ FaceÂ æ¨¡å‹ç›®å½•ä¸­ï¼ˆå¦‚Â <code>huggingface.co/ä½ çš„æ¨¡å‹å/</code>ï¼‰ï¼Œ<code>README.md</code>Â çš„ä½œç”¨éå¸¸é‡è¦ï¼Œå®ƒä¸ä»…æ˜¯æ¨¡å‹ä»‹ç»æ–‡æ¡£ï¼Œè¿˜ç›´æ¥å½±å“ä½ åœ¨Â HuggingÂ FaceÂ ç½‘é¡µä¸Šçœ‹åˆ°çš„æ¨¡å‹ä¸»é¡µå†…å®¹ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯æ€»ç»“-1">ğŸ§ Â ä¸€å¥è¯æ€»ç»“</h3>

<blockquote>
<p><code>README.md</code>Â æ˜¯Â HuggingÂ FaceÂ æ¨¡å‹ä»“åº“çš„<strong>å¯è§†åŒ–ä¸»é¡µè¯´æ˜æ–‡æ¡£</strong>ï¼Œç”¨äºå±•ç¤ºæ¨¡å‹çš„ä»‹ç»ã€ç”¨æ³•ã€æ€§èƒ½ã€è®¸å¯è¯ç­‰ä¿¡æ¯ã€‚</p>
</blockquote>

<hr />

<h3 id="å…¸å‹ç»“æ„ä¸ä½œç”¨">ğŸ“„Â å…¸å‹ç»“æ„ä¸ä½œç”¨</h3>

<p>ä¸€ä¸ªæ ‡å‡†çš„Â <code>README.md</code>Â é€šå¸¸åŒ…å«å¦‚ä¸‹éƒ¨åˆ†ï¼š</p>

<pre><code class="language-json">---
license: other
license_name: tongyi-qianwen
license_link: &gt;-
  https://huggingface.co/Qwen/Qwen1.5-32B-Chat-AWQ/blob/main/LICENSE
language:
- en
pipeline_tag: text-generation
tags:
- chat
---

# Qwen1.5-32B-Chat-AWQ


## Introduction

Qwen1.5 is the beta version of Qwen2, a transformer-based decoder-only language model pretrained on a large amount of data. In comparison with the previous released Qwen, the improvements include: 

* 8 model sizes, including 0.5B, 1.8B, 4B, 7B, 14B, 32B and 72B dense models, and an MoE model of 14B with 2.7B activated;
* Significant performance improvement in human preference for chat models;
* Multilingual support of both base and chat models;
* Stable support of 32K context length for models of all sizes
* No need of `trust_remote_code`.

For more details, please refer to our [blog post](https://qwenlm.github.io/blog/qwen1.5/) and [GitHub repo](https://github.com/QwenLM/Qwen1.5).
&lt;br&gt;

## Model Details
Qwen1.5 is a language model series including decoder language models of different model sizes. For each size, we release the base language model and the aligned chat model. It is based on the Transformer architecture with SwiGLU activation, attention QKV bias, group query attention, mixture of sliding window attention and full attention, etc. Additionally, we have an improved tokenizer adaptive to multiple natural languages and codes. For the beta version, temporarily we did not include GQA (except for 32B) and the mixture of SWA and full attention.

## Training details
We pretrained the models with a large amount of data, and we post-trained the models with both supervised finetuning and direct preference optimization.

## Requirements
The code of Qwen1.5 has been in the latest Hugging face transformers and we advise you to install `transformers&gt;=4.37.0`, or you might encounter the following error:
</code></pre>

<p>KeyError: &lsquo;qwen2&rsquo;</p>

<pre><code>
## Quickstart

Here provides a code snippet with `apply_chat_template` to show you how to load the tokenizer and model and how to generate contents.

```python
from transformers import AutoModelForCausalLM, AutoTokenizer
device = &quot;cuda&quot; # the device to load the model onto

model = AutoModelForCausalLM.from_pretrained(
    &quot;Qwen/Qwen1.5-32B-Chat-AWQ&quot;,
    torch_dtype=&quot;auto&quot;,
    device_map=&quot;auto&quot;
)
tokenizer = AutoTokenizer.from_pretrained(&quot;Qwen/Qwen1.5-32B-Chat-AWQ&quot;)

prompt = &quot;Give me a short introduction to large language model.&quot;
messages = [
    {&quot;role&quot;: &quot;system&quot;, &quot;content&quot;: &quot;You are a helpful assistant.&quot;},
    {&quot;role&quot;: &quot;user&quot;, &quot;content&quot;: prompt}
]
text = tokenizer.apply_chat_template(
    messages,
    tokenize=False,
    add_generation_prompt=True
)
model_inputs = tokenizer([text], return_tensors=&quot;pt&quot;).to(device)

generated_ids = model.generate(
    model_inputs.input_ids,
    max_new_tokens=512
)
generated_ids = [
    output_ids[len(input_ids):] for input_ids, output_ids in zip(model_inputs.input_ids, generated_ids)
]

response = tokenizer.batch_decode(generated_ids, skip_special_tokens=True)[0]
</code></pre>

<h2 id="tips">Tips</h2>

<ul>
<li>If you encounter code switching or other bad cases, we advise you to use our provided hyper-parameters in <code>generation_config.json</code>.</li>
</ul>

<h2 id="citation">Citation</h2>

<p>If you find our work helpful, feel free to give us a cite.</p>

<pre><code>@article{qwen,
  title={Qwen Technical Report},
  author={Jinze Bai and Shuai Bai and Yunfei Chu and Zeyu Cui and Kai Dang and Xiaodong Deng and Yang Fan and Wenbin Ge and Yu Han and Fei Huang and Binyuan Hui and Luo Ji and Mei Li and Junyang Lin and Runji Lin and Dayiheng Liu and Gao Liu and Chengqiang Lu and Keming Lu and Jianxin Ma and Rui Men and Xingzhang Ren and Xuancheng Ren and Chuanqi Tan and Sinan Tan and Jianhong Tu and Peng Wang and Shijie Wang and Wei Wang and Shengguang Wu and Benfeng Xu and Jin Xu and An Yang and Hao Yang and Jian Yang and Shusheng Yang and Yang Yao and Bowen Yu and Hongyi Yuan and Zheng Yuan and Jianwei Zhang and Xingxuan Zhang and Yichang Zhang and Zhenru Zhang and Chang Zhou and Jingren Zhou and Xiaohuan Zhou and Tianhang Zhu},
  journal={arXiv preprint arXiv:2309.16609},
  year={2023}
}
</code></pre>

<pre><code>
#### 1.Â æ¨¡å‹ç®€ä»‹

```markdown
# Qwen2-7B-Chat

Qwen2 æ˜¯é˜¿é‡Œè¾¾æ‘©é™¢å‘å¸ƒçš„æ–°ä¸€ä»£å¤§è¯­è¨€æ¨¡å‹ï¼Œæ”¯æŒä¸­è‹±æ–‡ï¼Œå…·å¤‡å¯¹è¯èƒ½åŠ›ã€‚

</code></pre>

<blockquote>
<p>ç®€æ˜æ‰¼è¦ä»‹ç»æ¨¡å‹åç§°ã€æ¥æºã€èƒ½åŠ›ã€é€‚ç”¨åœºæ™¯ã€‚</p>
</blockquote>

<hr />

<h4 id="2-æ¨¡å‹å¡å…ƒæ•°æ®-yaml-header">2.Â æ¨¡å‹å¡å…ƒæ•°æ®ï¼ˆYAMLÂ Headerï¼‰</h4>

<pre><code class="language-markdown">---
license: apache-2.0
language:
  - zh
  - en
tags:
  - chat
  - qwen2
pipeline_tag: text-generation
---

</code></pre>

<blockquote>
<p>è¿™æ®µÂ YAMLÂ å…ƒæ•°æ®æ˜¯Â HuggingÂ FaceÂ â€œæ¨¡å‹å¡â€è§„èŒƒçš„ä¸€éƒ¨åˆ†ï¼Œä¾›ç½‘é¡µæ¸²æŸ“å’Œæœç´¢ä½¿ç”¨ã€‚å¸¸è§å­—æ®µåŒ…æ‹¬ï¼š</p>
</blockquote>

<table>
<thead>
<tr>
<th>å­—æ®µ</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>license</code></td>
<td>æ¨¡å‹è®¸å¯è¯ç±»å‹ï¼ˆå¦‚Â apache-2.0ã€mitã€openrailï¼‰</td>
</tr>

<tr>
<td><code>language</code></td>
<td>æ”¯æŒçš„è¯­è¨€</td>
</tr>

<tr>
<td><code>tags</code></td>
<td>æ¨¡å‹æ ‡ç­¾ï¼Œå½±å“æ¨èå’Œæœç´¢</td>
</tr>

<tr>
<td><code>pipeline_tag</code></td>
<td>ç”¨äºå±•ç¤ºæ¨ç†Â WidgetÂ çš„æ¨¡å‹ç±»å‹ï¼ˆå¦‚Â <code>text-generation</code>,Â <code>text-classification</code>ï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h4 id="3-æ¨¡å‹ä½¿ç”¨æ–¹å¼-ä»£ç ç¤ºä¾‹">3.Â æ¨¡å‹ä½¿ç”¨æ–¹å¼ï¼ˆä»£ç ç¤ºä¾‹ï¼‰</h4>

<pre><code class="language-python">## ä½¿ç”¨æ–¹æ³•

```python
from transformers import AutoTokenizer, AutoModelForCausalLM

tokenizer = AutoTokenizer.from_pretrained(&quot;Qwen/Qwen2-7B-Chat&quot;)
model = AutoModelForCausalLM.from_pretrained(&quot;Qwen/Qwen2-7B-Chat&quot;)

inputs = tokenizer(&quot;ä½ å¥½ï¼Œè¯·ä»‹ç»ä¸€ä¸‹ä½ è‡ªå·±ã€‚&quot;, return_tensors=&quot;pt&quot;)
outputs = model.generate(**inputs)
print(tokenizer.decode(outputs[0]))

</code></pre>

<pre><code class="language-plaintext">
&gt; å±•ç¤ºå¦‚ä½•åŠ è½½å’Œä½¿ç”¨æ¨¡å‹ï¼Œé€šå¸¸ä½¿ç”¨ `transformers` æ¥å£ï¼Œå¸®åŠ©ç”¨æˆ·å¿«é€Ÿä¸Šæ‰‹ã€‚

---

### 4. æ¨¡å‹ç»†èŠ‚ï¼ˆç»“æ„ã€è®­ç»ƒè¯­æ–™ã€æ¨ç†è®¾ç½®ï¼‰

```markdown
## æ¨¡å‹ç»“æ„

- å‚æ•°é‡ï¼š7B
- å±‚æ•°ï¼š32
- æ”¯æŒä¸Šä¸‹æ–‡é•¿åº¦ï¼š32K
- è®­ç»ƒæ•°æ®ï¼šä¸­è‹±æ··åˆã€ç½‘ç»œæ–‡æœ¬ã€ä»£ç ç­‰

</code></pre>

<blockquote>
<p>æœ‰åŠ©äºç”¨æˆ·äº†è§£æ¨¡å‹èƒ½åŠ›ä¸è¾¹ç•Œã€‚</p>
</blockquote>

<hr />

<h4 id="5-æ€§èƒ½è¯„ä¼°-benchmark-å¯é€‰">5.Â æ€§èƒ½è¯„ä¼°Â /Â Benchmarkï¼ˆå¯é€‰ï¼‰</h4>

<pre><code class="language-markdown">## Benchmark

| Dataset | Score |
|---------|-------|
| MMLU    | 68.3  |
| CMMLU   | 56.1  |

</code></pre>

<hr />

<h4 id="6-è®¸å¯ä¸è´£ä»»å£°æ˜">6.Â è®¸å¯ä¸è´£ä»»å£°æ˜</h4>

<pre><code class="language-markdown">## è®¸å¯è¯

æœ¬æ¨¡å‹é‡‡ç”¨ Apache 2.0 åè®®ï¼Œå¯å•†ç”¨ä½¿ç”¨ã€‚

## æ³¨æ„äº‹é¡¹

æœ¬æ¨¡å‹ä¸ºç ”ç©¶ç”¨é€”ï¼Œä¸å¯¹ç”Ÿæˆå†…å®¹è´Ÿè´£ã€‚è¯·å‹¿ç”¨äºè¿æ³•è¡Œä¸ºã€‚

</code></pre>

<hr />

<h3 id="å¦‚ä½•å½±å“-hugging-face-é¡µé¢">ğŸ’»Â å¦‚ä½•å½±å“Â HuggingÂ FaceÂ é¡µé¢ï¼Ÿ</h3>

<p>ä¸Šä¼ çš„Â <code>README.md</code>Â ä¼šè¢«æ¸²æŸ“ä¸ºÂ HuggingÂ FaceÂ æ¨¡å‹é¡µçš„ä¸»è¦å†…å®¹éƒ¨åˆ†ï¼š</p>

<ul>
<li><p>ä½äºæ¨¡å‹å¡æœ€ä¸Šæ–¹</p></li>

<li><p>æ˜¾ç¤ºæ¨ç†ç¤ºä¾‹ã€æ ‡ç­¾ã€è¯­è¨€æ”¯æŒã€ä¸‹è½½å…¥å£ç­‰</p></li>

<li><p>å†³å®šäº†ç”¨æˆ·æ˜¯å¦ä¿¡ä»»ã€ç†è§£ã€ä½¿ç”¨ä½ çš„æ¨¡å‹</p></li>
</ul>

<blockquote>
<p>ğŸ‘‰Â å¯ä»¥ç†è§£ä¸ºï¼š<strong>å®ƒæ—¢æ˜¯æ–‡æ¡£ï¼Œåˆæ˜¯è¥é”€é¡µï¼</strong></p>
</blockquote>

<hr />

<h3 id="å¦‚ä½•ç¼–è¾‘-ä¸Šä¼ ">ğŸ› ï¸Â å¦‚ä½•ç¼–è¾‘Â /Â ä¸Šä¼ ï¼Ÿ</h3>

<h4 id="æ–¹æ³•-1-æ‰‹åŠ¨åˆ›å»º">æ–¹æ³•Â 1ï¼šæ‰‹åŠ¨åˆ›å»º</h4>

<p>å°†Â <code>README.md</code>Â æ”¾å…¥æ¨¡å‹ç›®å½•ä¸­ï¼Œè°ƒç”¨ï¼š</p>

<pre><code class="language-bash">huggingface-cli upload ./your_model --repo-id yourname/yourmodel

</code></pre>

<h4 id="æ–¹æ³•-2-åœ¨çº¿ç¼–è¾‘">æ–¹æ³•Â 2ï¼šåœ¨çº¿ç¼–è¾‘</h4>

<p>åœ¨æ¨¡å‹é¡µé¢å³ä¸Šè§’ç‚¹å‡»Â âœï¸ã€ŒEditÂ modelÂ cardã€ï¼Œåœ¨çº¿ä¿®æ”¹Â <code>README.md</code>ã€‚</p>

<hr />

<h3 id="æ€»ç»“-2">âœ…Â æ€»ç»“</h3>

<table>
<thead>
<tr>
<th>é¡¹ç›®</th>
<th>å†…å®¹</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ–‡ä»¶å</td>
<td><code>README.md</code></td>
</tr>

<tr>
<td>ä½ç½®</td>
<td>æ¨¡å‹ç›®å½•æ ¹è·¯å¾„</td>
</tr>

<tr>
<td>ä½œç”¨</td>
<td>æ˜¾ç¤ºåœ¨Â HuggingÂ FaceÂ æ¨¡å‹ä¸»é¡µï¼Œæä¾›æ¨¡å‹ä»‹ç»ã€ä½¿ç”¨æ–¹æ³•ã€å…ƒæ•°æ®</td>
</tr>

<tr>
<td>ç±»å‹</td>
<td>MarkdownÂ æ–‡æœ¬ï¼Œæ”¯æŒä»£ç å—ã€è¡¨æ ¼ã€å›¾ç‰‡ç­‰</td>
</tr>

<tr>
<td>ä¸è°é…å¥—</td>
<td><code>config.json</code>ï¼ˆç»“æ„ï¼‰ã€<code>safetensors</code>ï¼ˆæƒé‡ï¼‰ã€<code>tokenizer.json</code>ï¼ˆåˆ†è¯å™¨ï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-7-tokenizer-config-json">3.7Â tokenizer_config.json</h2>

<p><code>tokenizer_config.json</code>Â æ˜¯Â HuggingÂ FaceÂ TransformersÂ æ¨¡å‹ç›®å½•ä¸­çš„é‡è¦é…ç½®æ–‡ä»¶ï¼Œå®ƒç”¨äº<strong>æè¿°Â tokenizerÂ çš„è¿è¡Œæ—¶è¡Œä¸ºå’Œå…ƒä¿¡æ¯</strong>ï¼Œå¯¹åŠ è½½ã€å…¼å®¹æ€§ã€æ¨ç†è¡Œä¸ºç­‰éƒ½æœ‰å½±å“ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯ç†è§£">ğŸ§ Â ä¸€å¥è¯ç†è§£</h3>

<blockquote>
<p><code>tokenizer_config.json</code>Â æ˜¯å‘Šè¯‰Â <code>AutoTokenizer</code>ï¼ˆæˆ–å…¶å®ƒÂ TokenizerÂ ç±»ï¼‰<strong>å¦‚ä½•æ­£ç¡®åŠ è½½å’Œä½¿ç”¨åˆ†è¯å™¨</strong>çš„è¯´æ˜ä¹¦ã€‚</p>
</blockquote>

<hr />

<h3 id="æ–‡ä»¶ä½ç½®">ğŸ“¦Â æ–‡ä»¶ä½ç½®</h3>

<p>åœ¨Â HuggingÂ FaceÂ æ¨¡å‹ç›®å½•ç»“æ„ä¸­ï¼Œé€šå¸¸ä¸ä¸‹åˆ—æ–‡ä»¶ä½äºåŒä¸€ç›®å½•ä¸‹ï¼š</p>

<pre><code class="language-plaintext">- config.json
- tokenizer_config.json
- tokenizer.json
- merges.txt / vocab.json
- special_tokens_map.json
- model.safetensors
- README.md

</code></pre>

<hr />

<h3 id="å…¸å‹å†…å®¹ç¤ºä¾‹">ğŸ§¾Â å…¸å‹å†…å®¹ç¤ºä¾‹</h3>

<pre><code class="language-json">{
  // æ˜¯å¦åœ¨åˆ†è¯æ—¶æ·»åŠ å‰ç¼€ç©ºæ ¼
  &quot;add_prefix_space&quot;: false,
  // ç‰¹æ®Štokençš„è§£ç å™¨
  &quot;added_tokens_decoder&quot;: {
    // &lt;|endoftext|&gt; ç»“æŸæ–‡æœ¬çš„ç‰¹æ®Štoken
    &quot;151643&quot;: {
      &quot;content&quot;: &quot;&lt;|endoftext|&gt;&quot;,
      &quot;lstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;single_word&quot;: false,
      &quot;special&quot;: true
    },
    // &lt;|im_start|&gt; å¯¹è¯å¼€å§‹çš„ç‰¹æ®Štoken
    &quot;151644&quot;: {
      &quot;content&quot;: &quot;&lt;|im_start|&gt;&quot;,
      &quot;lstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;single_word&quot;: false,
      &quot;special&quot;: true
    },
    // &lt;|im_end|&gt; å¯¹è¯ç»“æŸçš„ç‰¹æ®Štoken
    &quot;151645&quot;: {
      &quot;content&quot;: &quot;&lt;|im_end|&gt;&quot;,
      &quot;lstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;single_word&quot;: false,
      &quot;special&quot;: true
    }
  },
  // é¢å¤–çš„ç‰¹æ®Štokenåˆ—è¡¨
  &quot;additional_special_tokens&quot;: [],
  // å¥å­èµ·å§‹tokenï¼ˆæœªè®¾ç½®ï¼‰
  &quot;bos_token&quot;: null,
  // èŠå¤©æ¨¡æ¿ï¼Œå®šä¹‰æ¶ˆæ¯æ ¼å¼
  &quot;chat_template&quot;: &quot;{% for message in messages %}{% if loop.first and messages[0]['role'] != 'system' %}{{ '&lt;|im_start|&gt;system\nYou are a helpful assistant.&lt;|im_end|&gt;\n' }}{% endif %}{{'&lt;|im_start|&gt;' + message['role'] + '\n' + message['content'] + '&lt;|im_end|&gt;' + '\n'}}{% endfor %}{% if add_generation_prompt %}{{ '&lt;|im_start|&gt;assistant\n' }}{% endif %}&quot;,
  // æ˜¯å¦æ¸…ç†åˆ†è¯ç©ºæ ¼
  &quot;clean_up_tokenization_spaces&quot;: false,
  // å¥å­ç»“æŸtoken
  &quot;eos_token&quot;: &quot;&lt;|im_end|&gt;&quot;,
  // é”™è¯¯å¤„ç†æ–¹å¼
  &quot;errors&quot;: &quot;replace&quot;,
  // æ¨¡å‹æœ€å¤§é•¿åº¦
  &quot;model_max_length&quot;: 32768,
  // å¡«å……token
  &quot;pad_token&quot;: &quot;&lt;|endoftext|&gt;&quot;,
  // æ˜¯å¦åˆ†å‰²ç‰¹æ®Štoken
  &quot;split_special_tokens&quot;: false,
  // åˆ†è¯å™¨ç±»å
  &quot;tokenizer_class&quot;: &quot;Qwen2Tokenizer&quot;,
  // æœªçŸ¥tokenï¼ˆæœªè®¾ç½®ï¼‰
  &quot;unk_token&quot;: null
}
</code></pre>

<p>ä»¥ä¸€ä¸ªç”¨äºæ–‡æœ¬ç”Ÿæˆçš„Â tokenizerÂ ä¸ºä¾‹ï¼š</p>

<pre><code class="language-json">{
  &quot;add_bos_token&quot;: true,
  &quot;add_eos_token&quot;: false,
  &quot;bos_token&quot;: &quot;&lt;s&gt;&quot;,
  &quot;eos_token&quot;: &quot;&lt;/s&gt;&quot;,
  &quot;unk_token&quot;: &quot;&lt;unk&gt;&quot;,
  &quot;pad_token&quot;: &quot;&lt;pad&gt;&quot;,
  &quot;cls_token&quot;: &quot;&lt;s&gt;&quot;,
  &quot;sep_token&quot;: &quot;&lt;/s&gt;&quot;,
  &quot;do_lower_case&quot;: false,
  &quot;model_max_length&quot;: 2048,
  &quot;tokenizer_class&quot;: &quot;LlamaTokenizer&quot;,
  &quot;auto_map&quot;: {
    &quot;AutoTokenizer&quot;: [&quot;tokenization_llama.LlamaTokenizer&quot;, null]
  },
  &quot;use_fast&quot;: false
}

</code></pre>

<hr />

<h3 id="å­—æ®µè¯´æ˜">ğŸ”Â å­—æ®µè¯´æ˜</h3>

<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>ç±»å‹</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>add_bos_token</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦åœ¨è¾“å…¥å‰æ·»åŠ Â <code>&lt;s&gt;</code>Â å¼€å¤´Â tokenï¼ˆé€šå¸¸ç”¨äºÂ decoder-onlyÂ æ¨¡å‹ï¼‰</td>
</tr>

<tr>
<td><code>add_eos_token</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦è‡ªåŠ¨åœ¨è¾“å…¥åæ·»åŠ Â <code>&lt;/s&gt;</code>ï¼ˆç»ˆæ­¢ç¬¦ï¼‰</td>
</tr>

<tr>
<td><code>bos_token</code>,Â <code>eos_token</code>,Â <code>unk_token</code>,Â <code>pad_token</code>,Â <code>cls_token</code>,Â <code>sep_token</code></td>
<td><code>string</code></td>
<td>ç‰¹æ®Šæ ‡è®°ç¬¦å®šä¹‰ï¼Œå½±å“è§£ç å’Œå¤„ç†</td>
</tr>

<tr>
<td><code>do_lower_case</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦å°†è¾“å…¥å¼ºåˆ¶å°å†™ï¼ˆå¸¸ç”¨äºÂ BERTï¼‰</td>
</tr>

<tr>
<td><code>model_max_length</code></td>
<td><code>int</code></td>
<td>é»˜è®¤æ”¯æŒçš„æœ€å¤§åºåˆ—é•¿åº¦ï¼ˆè¶…å‡ºæ—¶ä¼šæŠ¥é”™æˆ–æˆªæ–­ï¼‰</td>
</tr>

<tr>
<td><code>tokenizer_class</code></td>
<td><code>string</code></td>
<td>æŒ‡å®šç”¨å“ªä¸ªÂ TokenizerÂ ç±»åŠ è½½ï¼ˆå¦‚Â <code>LlamaTokenizer</code>,Â <code>GPT2Tokenizer</code>ï¼‰</td>
</tr>

<tr>
<td><code>auto_map</code></td>
<td><code>dict</code></td>
<td>è‡ªå®šä¹‰Â TokenizerÂ ç±»æ˜ å°„ï¼ˆç”¨äºç§æœ‰Â tokenizerÂ çš„æ³¨å†Œï¼‰</td>
</tr>

<tr>
<td><code>use_fast</code></td>
<td><code>bool</code></td>
<td>æ˜¯å¦é»˜è®¤å¯ç”¨Â <code>FastTokenizer</code>ï¼ˆRustÂ å®ç°ï¼Œæ›´å¿«ï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="å’Œå…¶å®ƒæ–‡ä»¶çš„å…³ç³»">ğŸš€Â å’Œå…¶å®ƒæ–‡ä»¶çš„å…³ç³»</h3>

<table>
<thead>
<tr>
<th>æ–‡ä»¶</th>
<th>ä½œç”¨</th>
<th>ç›¸äº’å…³ç³»</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>tokenizer.json</code></td>
<td>ä¸»è¦çš„åºåˆ—åŒ–åˆ†è¯å™¨æ¨¡å‹</td>
<td><code>tokenizer_config.json</code>Â æŒ‡å®šå¦‚ä½•åŠ è½½å®ƒ</td>
</tr>

<tr>
<td><code>vocab.json</code>,Â <code>merges.txt</code></td>
<td>é€‚ç”¨äºÂ BPEÂ tokenizerï¼ˆå¦‚Â GPT-2ï¼‰</td>
<td>ä½å±‚è¯è¡¨é…ç½®æ–‡ä»¶</td>
</tr>

<tr>
<td><code>special_tokens_map.json</code></td>
<td>æ˜ å°„ç‰¹æ®ŠÂ tokenÂ åˆ°å®é™…å­—ç¬¦ä¸²ï¼ˆä¾‹å¦‚Â <code>&lt;pad&gt;</code>Â å¯¹åº”Â IDï¼‰</td>
<td>å¯ä¸æœ¬æ–‡ä»¶å†…å®¹é‡å ï¼Œä½†ä¹Ÿå¯ç‹¬ç«‹è¦†ç›–</td>
</tr>

<tr>
<td><code>config.json</code></td>
<td>æ¨¡å‹ç»“æ„ï¼ˆå±‚æ•°ã€å¤´æ•°ç­‰ï¼‰</td>
<td>å’ŒÂ tokenizerÂ é…å¥—ä½¿ç”¨ï¼Œä½†ç”¨é€”ä¸åŒ</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="ç¤ºä¾‹-åŠ è½½æ–¹å¼å—-tokenizer-config-json-å½±å“">âœ…Â ç¤ºä¾‹ï¼šåŠ è½½æ–¹å¼å—Â <code>**tokenizer_config.json**</code>Â å½±å“</h3>

<pre><code class="language-python">from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(&quot;Qwen/Qwen2-7B-Chat&quot;)

# ä¼šä¼˜å…ˆè¯»å– tokenizer_config.json ä¸­çš„ä¿¡æ¯
# å†³å®šæ˜¯å¦åŠ è½½ fast tokenizerã€é»˜è®¤ç‰¹æ®Šç¬¦å·ã€æ˜¯å¦æ·»åŠ  bos_token ç­‰

</code></pre>

<hr />

<h3 id="ç¼–è¾‘æˆ–è‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯">ğŸ› ï¸Â ç¼–è¾‘æˆ–è‡ªå®šä¹‰ä½¿ç”¨åœºæ™¯</h3>

<p>ä½ å¯èƒ½ä¼šæƒ³ä¿®æ”¹å®ƒçš„åœºæ™¯åŒ…æ‹¬ï¼š</p>

<ul>
<li><p>ä¸ºÂ tokenizerÂ æ·»åŠ Â pad_tokenÂ æˆ–Â eos_token</p></li>

<li><p>è°ƒæ•´Â <code>model_max_length</code>Â ä»¥é€‚é…Â longerÂ context</p></li>

<li><p>æ›¿æ¢Â tokenizerÂ ç±»åï¼ˆå¦‚åŠ è½½è‡ªå®šä¹‰çš„åˆ†è¯å™¨é€»è¾‘ï¼‰</p></li>

<li><p>ç¦ç”¨Â fastÂ tokenizerï¼ˆå½“Â fastÂ æ¨¡å‹å­˜åœ¨Â bugï¼‰</p></li>
</ul>

<p>ä¾‹å¦‚ï¼š</p>

<pre><code class="language-json">{
  &quot;pad_token&quot;: &quot;&lt;|pad|&gt;&quot;,
  &quot;model_max_length&quot;: 4096,
  &quot;tokenizer_class&quot;: &quot;MyCustomTokenizer&quot;,
  &quot;use_fast&quot;: false
}

</code></pre>

<hr />

<h3 id="æ€»ç»“-3">æ€»ç»“Â âœ…</h3>

<table>
<thead>
<tr>
<th>åŠŸèƒ½</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ ¸å¿ƒä½œç”¨</td>
<td>å‘Šè¯‰Â <code>AutoTokenizer</code>Â å¦‚ä½•åŠ è½½ã€é…ç½®ã€åˆå§‹åŒ–</td>
</tr>

<tr>
<td>å…³é”®å­—æ®µ</td>
<td>ç‰¹æ®Šç¬¦å·ã€æ˜¯å¦Â lower-caseã€æœ€å¤§é•¿åº¦ã€fast/slowÂ æ¨¡å¼</td>
</tr>

<tr>
<td>å’Œå…¶å®ƒæ–‡ä»¶å…³ç³»</td>
<td>é…åˆÂ <code>tokenizer.json</code>Â å’ŒÂ <code>special_tokens_map.json</code>Â ç­‰æ–‡ä»¶å…±åŒä½¿ç”¨</td>
</tr>

<tr>
<td>æ˜¯å¦å¯é€‰</td>
<td>æ˜¯ï¼Œä½†ç¼ºå¤±æ—¶ä¼šé‡‡ç”¨é»˜è®¤æ¨æ–­é€»è¾‘ï¼Œå¯èƒ½å¯¼è‡´ä¸ä¸€è‡´è¡Œä¸º</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-8-tokenizer-json">3.8Â tokenizer.json</h2>

<p><code>tokenizer.json</code>Â æ˜¯Â HuggingÂ FaceÂ TransformersÂ åˆ†è¯å™¨ç›®å½•ä¸­æœ€æ ¸å¿ƒçš„æ–‡ä»¶ä¹‹ä¸€ï¼Œå®ƒæ˜¯<strong>TokenizerÂ çš„å®Œæ•´åºåˆ—åŒ–æ–‡ä»¶</strong>ï¼ŒåŒ…æ‹¬è¯è¡¨ã€é¢„å¤„ç†è§„åˆ™ã€æ­£åˆ™ã€ç‰¹æ®ŠÂ tokenÂ æ˜ å°„ã€åˆ†è¯ç®—æ³•é€»è¾‘ç­‰ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯ç†è§£-1">ğŸ§ Â ä¸€å¥è¯ç†è§£</h3>

<blockquote>
<p><code>tokenizer.json</code>Â æ˜¯Â <strong>tokenizerÂ çš„æ‰€æœ‰è¡Œä¸ºå’Œè¯è¡¨ä¿¡æ¯çš„ç»Ÿä¸€æ‰“åŒ…ç‰ˆæœ¬</strong>ï¼Œç”¨äºå¿«é€ŸåŠ è½½å’Œå¤ç°Â tokenizerÂ è¡Œä¸ºï¼Œå°¤å…¶åœ¨ä½¿ç”¨Â <code>fastÂ tokenizer</code>Â æ—¶ã€‚</p>
</blockquote>

<hr />

<h3 id="å®ƒå’Œå…¶å®ƒæ–‡ä»¶æœ‰ä½•åŒºåˆ«">ğŸ”Â å®ƒå’Œå…¶å®ƒæ–‡ä»¶æœ‰ä½•åŒºåˆ«ï¼Ÿ</h3>

<table>
<thead>
<tr>
<th>æ–‡ä»¶</th>
<th>ä½œç”¨</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>tokenizer_config.json</code></td>
<td>å‚æ•°è®¾ç½®</td>
<td>æ§åˆ¶Â tokenizerÂ è¿è¡Œè¡Œä¸ºï¼ˆå¦‚æ˜¯å¦åŠ Â bos_tokenï¼‰</td>
</tr>

<tr>
<td><code>tokenizer.json</code></td>
<td>ä¸»ä½“</td>
<td>ä¿å­˜å®Œæ•´Â fastÂ tokenizerÂ å®šä¹‰ï¼ŒåŒ…æ‹¬è¯è¡¨ã€mergeã€pretokenizerÂ ç­‰</td>
</tr>

<tr>
<td><code>vocab.json</code>Â +Â <code>merges.txt</code></td>
<td>GPT/BPEÂ æ¨¡å‹è¯è¡¨</td>
<td>ç”¨äºÂ slowÂ tokenizerÂ çš„æ„å»º</td>
</tr>

<tr>
<td><code>special_tokens_map.json</code></td>
<td>æ˜ å°„</td>
<td><code>&lt;pad&gt;</code>ã€<code>&lt;eos&gt;</code>Â è¿™äº›ç¬¦å·çš„å®é™…å­—ç¬¦ä¸²/ID</td>
</tr>
</tbody>
</table>

<p><code>tokenizer.json</code>Â æ˜¯Â FastÂ Tokenizerï¼ˆRustÂ å®ç°ï¼‰ä¸“ç”¨æ–‡ä»¶ï¼Œå¯ä»¥<strong>æ›¿ä»£Â vocab.jsonÂ å’ŒÂ merges.txt</strong>ï¼Œå› æ­¤æ›´å¿«ã€æ›´ä¾¿æºã€‚</p>

<hr />

<h3 id="å…¸å‹ç»“æ„å†…å®¹">ğŸ“¦Â å…¸å‹ç»“æ„å†…å®¹</h3>

<pre><code class="language-json">shengping.mo@y108p30:/data2/huggingface/Qwen/Qwen1.5-32B-Chat-AWQ$ head  -n 100 tokenizer.json 
{
  &quot;version&quot;: &quot;1.0&quot;,
  &quot;truncation&quot;: null, // æˆªæ–­è®¾ç½®
  &quot;padding&quot;: null,    // å¡«å……è®¾ç½®
  &quot;added_tokens&quot;: [   // æ–°å¢çš„ç‰¹æ®Štoken
    {
      &quot;id&quot;: 151643,
      &quot;content&quot;: &quot;&lt;|endoftext|&gt;&quot;, // æ–‡æœ¬ç»“æŸæ ‡è®°
      &quot;single_word&quot;: false,
      &quot;lstrip&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;special&quot;: true
    },
    {
      &quot;id&quot;: 151644,
      &quot;content&quot;: &quot;&lt;|im_start|&gt;&quot;, // å¯¹è¯å¼€å§‹æ ‡è®°
      &quot;single_word&quot;: false,
      &quot;lstrip&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;special&quot;: true
    },
    {
      &quot;id&quot;: 151645,
      &quot;content&quot;: &quot;&lt;|im_end|&gt;&quot;, // å¯¹è¯ç»“æŸæ ‡è®°
      &quot;single_word&quot;: false,
      &quot;lstrip&quot;: false,
      &quot;rstrip&quot;: false,
      &quot;normalized&quot;: false,
      &quot;special&quot;: true
    }
  ],
  &quot;normalizer&quot;: {
    &quot;type&quot;: &quot;NFC&quot; // å½’ä¸€åŒ–ç±»å‹
  },
  &quot;pre_tokenizer&quot;: { // åˆ†è¯å‰å¤„ç†
    &quot;type&quot;: &quot;Sequence&quot;,
    &quot;pretokenizers&quot;: [
      {
        &quot;type&quot;: &quot;Split&quot;,
        &quot;pattern&quot;: {
          &quot;Regex&quot;: &quot;(?i:'s|'t|'re|'ve|'m|'ll|'d)|[^\r\n\p{L}\p{N}]?\p{L}+|\p{N}| ?[^\s\p{L}\p{N}]+[\r\n]*|\s*[\r\n]+|\s+(?!\S)|\s+&quot;
        },
        &quot;behavior&quot;: &quot;Isolated&quot;,
        &quot;invert&quot;: false
      },
      {
        &quot;type&quot;: &quot;ByteLevel&quot;,
        &quot;add_prefix_space&quot;: false,
        &quot;trim_offsets&quot;: false,
        &quot;use_regex&quot;: false
      }
    ]
  },
  &quot;post_processor&quot;: { // åˆ†è¯åå¤„ç†
    &quot;type&quot;: &quot;ByteLevel&quot;,
    &quot;add_prefix_space&quot;: false,
    &quot;trim_offsets&quot;: false,
    &quot;use_regex&quot;: false
  },
  &quot;decoder&quot;: { // è§£ç å™¨
    &quot;type&quot;: &quot;ByteLevel&quot;,
    &quot;add_prefix_space&quot;: false,
    &quot;trim_offsets&quot;: false,
    &quot;use_regex&quot;: false
  },
  &quot;model&quot;: { // æ¨¡å‹ç›¸å…³é…ç½®
    &quot;type&quot;: &quot;BPE&quot;,
    &quot;dropout&quot;: null,
    &quot;unk_token&quot;: null,
    &quot;continuing_subword_prefix&quot;: &quot;&quot;,
    &quot;end_of_word_suffix&quot;: &quot;&quot;,
    &quot;fuse_unk&quot;: false,
    &quot;byte_fallback&quot;: false,
    &quot;vocab&quot;: { // è¯è¡¨
      &quot;!&quot;: 0,
      &quot;\&quot;&quot;: 1,
      &quot;#&quot;: 2,
      &quot;$&quot;: 3,
      &quot;%&quot;: 4,
      &quot;&amp;&quot;: 5,
      &quot;'&quot;: 6,
      &quot;(&quot;: 7,
      &quot;)&quot;: 8,
      &quot;*&quot;: 9,
      &quot;+&quot;: 10,
      &quot;,&quot;: 11,
      &quot;-&quot;: 12,
      &quot;.&quot;: 13,
      &quot;/&quot;: 14,
      &quot;0&quot;: 15,
      &quot;1&quot;: 16,
      &quot;2&quot;: 17,
      &quot;3&quot;: 18,
      &quot;4&quot;: 19,
      &quot;5&quot;: 20,
      &quot;6&quot;: 21,
      &quot;7&quot;: 22,
      &quot;8&quot;: 23,
</code></pre>

<p>ä¸€ä¸ªÂ <code>tokenizer.json</code>Â æ˜¯ä¸€ä¸ªå¤§å‹Â JSONÂ æ–‡ä»¶ï¼Œé€šå¸¸åŒ…å«ä»¥ä¸‹å­—æ®µï¼š</p>

<pre><code class="language-jsonc">{
  &quot;version&quot;: &quot;1.0&quot;,
  &quot;truncation&quot;: { ... },
  &quot;padding&quot;: { ... },
  &quot;added_tokens&quot;: [ ... ],
  &quot;normalizer&quot;: { ... },
  &quot;pre_tokenizer&quot;: { ... },
  &quot;post_processor&quot;: { ... },
  &quot;decoder&quot;: { ... },
  &quot;model&quot;: {
    &quot;type&quot;: &quot;BPE&quot;,
    &quot;vocab&quot;: {
      &quot;the&quot;: 0,
      &quot;a&quot;: 1,
      ...
    },
    &quot;merges&quot;: [
      [&quot;t&quot;, &quot;h&quot;],
      [&quot;th&quot;, &quot;e&quot;],
      ...
    ]
  }
}

</code></pre>

<hr />

<h4 id="å…³é”®å­—æ®µè§£é‡Š">ğŸ”§Â å…³é”®å­—æ®µè§£é‡Š</h4>

<table>
<thead>
<tr>
<th>å­—æ®µå</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>model</code></td>
<td>åˆ†è¯æ¨¡å‹ç»“æ„ï¼Œå¦‚Â <code>BPE</code>Â /Â <code>WordPiece</code>ï¼Œå«è¯è¡¨å’Œåˆå¹¶è§„åˆ™</td>
</tr>

<tr>
<td><code>vocab</code></td>
<td>å•è¯åˆ°Â tokenÂ IDÂ çš„æ˜ å°„</td>
</tr>

<tr>
<td><code>merges</code></td>
<td>åˆå¹¶è§„åˆ™ï¼ˆä»…ç”¨äºÂ BPEï¼‰</td>
</tr>

<tr>
<td><code>normalizer</code></td>
<td>æ­£è§„åŒ–è§„åˆ™ï¼Œå¦‚Â UnicodeÂ è§„èŒƒåŒ–ã€lowercasingÂ ç­‰</td>
</tr>

<tr>
<td><code>pre_tokenizer</code></td>
<td>åˆ†è¯å‰çš„å¤„ç†ï¼Œå¦‚ç©ºæ ¼æ‹†åˆ†ã€æ­£åˆ™</td>
</tr>

<tr>
<td><code>post_processor</code></td>
<td>åˆ†è¯åçš„å¤„ç†ï¼Œå¦‚æ·»åŠ Â <code>&lt;bos&gt;</code>ã€<code>&lt;/s&gt;</code>Â ç­‰ç‰¹æ®ŠÂ token</td>
</tr>

<tr>
<td><code>decoder</code></td>
<td>å°†Â tokenÂ IDÂ åºåˆ—è¿˜åŸä¸ºå­—ç¬¦ä¸²</td>
</tr>

<tr>
<td><code>added_tokens</code></td>
<td>ç”¨æˆ·æ·»åŠ çš„ç‰¹æ®ŠÂ tokenï¼Œæ¯”å¦‚Â <code>&lt;user&gt;</code>,Â <code>&lt;bot&gt;</code>Â ç­‰</td>
</tr>

<tr>
<td><code>padding</code>Â /Â <code>truncation</code></td>
<td>paddingÂ å’Œæˆªæ–­è§„åˆ™ï¼Œå†³å®šè¾“å…¥å¯¹é½ç­–ç•¥</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="åŠ è½½ç¤ºä¾‹">âœ…Â åŠ è½½ç¤ºä¾‹</h3>

<pre><code class="language-python">from transformers import PreTrainedTokenizerFast

tokenizer = PreTrainedTokenizerFast(tokenizer_file=&quot;path/to/tokenizer.json&quot;)
print(tokenizer.tokenize(&quot;ä½ å¥½ï¼Œä¸–ç•Œï¼&quot;))

</code></pre>

<p>ä½ ä¹Ÿå¯ä»¥ä½¿ç”¨ï¼š</p>

<pre><code class="language-python">tokenizer = AutoTokenizer.from_pretrained(&quot;æ¨¡å‹è·¯å¾„æˆ–Hubå&quot;)

</code></pre>

<p>èƒŒåå°±æ˜¯è°ƒç”¨Â <code>tokenizer.json</code>Â åŠ è½½é€»è¾‘ã€‚</p>

<hr />

<h3 id="åº”ç”¨åœºæ™¯">ğŸš€Â åº”ç”¨åœºæ™¯</h3>

<h4 id="ä½¿ç”¨-rust-å®ç°çš„-fast-tokenizer-é»˜è®¤-hugging-face-ä¼šä¼˜å…ˆåŠ è½½-tokenizer-json">âœ…Â ä½¿ç”¨Â RustÂ å®ç°çš„Â fastÂ tokenizerï¼ˆé»˜è®¤Â HuggingÂ FaceÂ ä¼šä¼˜å…ˆåŠ è½½Â <code>**tokenizer.json**</code>ï¼‰</h4>

<ul>
<li><p>æ›´å¿«çš„æ‰¹é‡Â tokenization</p></li>

<li><p>æ”¯æŒÂ pretokenizerÂ +Â postprocessorÂ å…¨æµç¨‹å®šåˆ¶</p></li>

<li><p>æ›´å®¹æ˜“éƒ¨ç½²ï¼ˆæ‰“åŒ…æˆÂ ONNXÂ æˆ–å¯¼å‡ºï¼‰</p></li>
</ul>

<h4 id="è‡ªå®šä¹‰-tokenizer-æ—¶ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶">âœ…Â è‡ªå®šä¹‰Â tokenizerÂ æ—¶ç”Ÿæˆè¿™ä¸ªæ–‡ä»¶ï¼š</h4>

<pre><code class="language-python">from tokenizers import Tokenizer, trainers, models

# è®­ç»ƒ BPE æ¨¡å‹
tokenizer = Tokenizer(models.BPE())
# ...
tokenizer.train(...)  # è‡ªå®šä¹‰è®­ç»ƒ
tokenizer.save(&quot;tokenizer.json&quot;)

</code></pre>

<hr />

<h3 id="å’Œ-fast-tokenizer-çš„å…³ç³»">ğŸ“Â å’ŒÂ fastÂ tokenizerÂ çš„å…³ç³»</h3>

<table>
<thead>
<tr>
<th>ç‰¹æ€§</th>
<th>slowÂ tokenizer</th>
<th>fastÂ tokenizerÂ (<code>tokenizer.json</code>)</th>
</tr>
</thead>

<tbody>
<tr>
<td>åŠ è½½é€Ÿåº¦</td>
<td>æ…¢</td>
<td>å¿«ï¼ˆRustÂ å®ç°ï¼‰</td>
</tr>

<tr>
<td>æ˜¯å¦éœ€è¦Â vocab/merges</td>
<td>æ˜¯</td>
<td>ä¸éœ€è¦ï¼ˆå·²åˆå¹¶åˆ°Â tokenizer.jsonï¼‰</td>
</tr>

<tr>
<td>å¤šè¯­è¨€æ”¯æŒ</td>
<td>æœ‰</td>
<td>æ›´å¼º</td>
</tr>

<tr>
<td>æ­£åˆ™/pipelineÂ ç»†èŠ‚å¯é…ç½®æ€§</td>
<td>è¾ƒå¼±</td>
<td>å¾ˆå¼ºï¼ˆæ”¯æŒÂ pretokenizer/normalizer/postprocessorï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="æ€»ç»“-4">æ€»ç»“Â âœ…</h3>

<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>å†…å®¹</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ–‡ä»¶ç±»å‹</td>
<td>JSON</td>
</tr>

<tr>
<td>ç”¨é€”</td>
<td>æè¿°Â tokenizerÂ å…¨éƒ¨è¡Œä¸ºï¼Œç”¨äºÂ fastÂ tokenizerÂ åŠ è½½</td>
</tr>

<tr>
<td>æ˜¯å¦å¿…é¡»</td>
<td>ä¸æ˜¯å¿…é¡»ï¼Œä½†å­˜åœ¨æ—¶ä¼˜å…ˆä½¿ç”¨</td>
</tr>

<tr>
<td>å’ŒÂ vocab/mergesÂ çš„å…³ç³»</td>
<td>å¯ä»¥æ›¿ä»£ï¼ŒåŠŸèƒ½æ›´å®Œæ•´</td>
</tr>

<tr>
<td>ä¿®æ”¹æ–¹å¼</td>
<td>å¯é€šè¿‡Â <code>tokenizers</code>Â åº“åˆ›å»ºæˆ–ä¿®æ”¹</td>
</tr>

<tr>
<td>å»ºè®®</td>
<td>æ¨¡å‹è®­ç»ƒæˆ–éƒ¨ç½²æ¨èä½¿ç”¨Â <code>tokenizer.json</code>ï¼Œå°¤å…¶åœ¨éœ€è¦é«˜æ€§èƒ½æ—¶</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-9-vocab-json">3.9Â vocab.json</h2>

<p><code>vocab.json</code>Â æ˜¯Â HuggingÂ FaceÂ TokenizerÂ æ¨¡å‹ä¸­ç”¨äºå­˜å‚¨**è¯æ±‡è¡¨ï¼ˆvocabularyï¼‰**çš„æ–‡ä»¶ï¼Œå¸¸è§äºåŸºäºÂ BPEï¼ˆByteÂ PairÂ Encodingï¼‰æˆ–Â WordPieceÂ ç­‰å­è¯åˆ†è¯ç®—æ³•çš„æ¨¡å‹ï¼Œä¾‹å¦‚Â GPTã€BERTã€Robertaã€LLaMAÂ ç­‰ã€‚</p>

<hr />

<h3 id="ä¸€å¥è¯ç†è§£-2">âœ…Â ä¸€å¥è¯ç†è§£</h3>

<blockquote>
<p><code>vocab.json</code>Â å®šä¹‰äº†ã€Œ<strong>tokenÂ åˆ°Â IDÂ çš„æ˜ å°„å…³ç³»</strong>ã€ï¼Œæ˜¯åˆ†è¯å™¨çš„æ ¸å¿ƒæ–‡ä»¶ä¹‹ä¸€ã€‚</p>
</blockquote>

<hr />

<h3 id="æ–‡ä»¶ç»“æ„ç¤ºä¾‹">ğŸ“¦Â æ–‡ä»¶ç»“æ„ç¤ºä¾‹</h3>

<pre><code class="language-json">{
  &quot;the&quot;: 0,
  &quot;Ä the&quot;: 1,
  &quot;a&quot;: 2,
  &quot;Ä a&quot;: 3,
  &quot;apple&quot;: 1000,
  &quot;##ple&quot;: 1001,
  &quot;&lt;pad&gt;&quot;: 50256,
  &quot;&lt;eos&gt;&quot;: 50257
}

</code></pre>

<ul>
<li><p>keyï¼š<strong>tokenï¼ˆå­—ç¬¦ä¸²ï¼‰</strong>ï¼Œå¯ä»¥æ˜¯å•è¯ã€å­è¯ã€ç¬¦å·æˆ–ç‰¹æ®ŠÂ token</p></li>

<li><p>valueï¼š<strong>æ•´å‹Â ID</strong>ï¼Œç”¨äºå°†Â tokenÂ è½¬ä¸ºæ¨¡å‹å¯ç”¨çš„è¾“å…¥</p></li>
</ul>

<blockquote>
<p><code>Ä </code>Â è¡¨ç¤ºå‰é¢æœ‰ç©ºæ ¼ï¼ˆåœ¨Â Roberta/BPEÂ ä¸­å¸¸è§ï¼‰ <code>##</code>Â è¡¨ç¤ºè¿™ä¸ªè¯æ˜¯æ¥åœ¨å‰ä¸€ä¸ªè¯åé¢çš„ï¼ˆWordPieceÂ æ ‡è®°ï¼‰</p>
</blockquote>

<hr />

<h3 id="å®ƒä¸å…¶å®ƒæ–‡ä»¶çš„åŒºåˆ«">ğŸ”Â å®ƒä¸å…¶å®ƒæ–‡ä»¶çš„åŒºåˆ«</h3>

<table>
<thead>
<tr>
<th>æ–‡ä»¶</th>
<th>ä½œç”¨</th>
<th>æ˜¯å¦å¿…é¡»</th>
<th>å¿«é€Ÿè¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td><code>vocab.json</code></td>
<td>tokenÂ âœÂ IDÂ æ˜ å°„</td>
<td>æ˜¯ï¼ˆslowÂ tokenizerï¼‰</td>
<td>åˆ†è¯åæ˜ å°„æˆæ•´æ•°Â tokenÂ ID</td>
</tr>

<tr>
<td><code>merges.txt</code></td>
<td>BPEÂ åˆå¹¶è§„åˆ™</td>
<td>æ˜¯ï¼ˆBPEÂ æ¨¡å‹ï¼‰</td>
<td>æŒ‡å®šå¦‚ä½•ä»å­—ç¬¦å¯¹åˆå¹¶å‡ºÂ token</td>
</tr>

<tr>
<td><code>tokenizer.json</code></td>
<td>FastÂ tokenizerÂ å…¨éƒ¨è¡Œä¸º</td>
<td>å¦</td>
<td>æ‰“åŒ…äº†Â vocabÂ å’ŒÂ mergesï¼Œä¹Ÿæ›´å¿«</td>
</tr>

<tr>
<td><code>tokenizer_config.json</code></td>
<td>åŠ è½½Â tokenizerÂ çš„é…ç½®é¡¹</td>
<td>å¦</td>
<td>æ§åˆ¶æ˜¯å¦æ·»åŠ ç‰¹æ®ŠÂ tokenÂ ç­‰è¡Œä¸º</td>
</tr>

<tr>
<td><code>special_tokens_map.json</code></td>
<td>ç‰¹æ®ŠÂ tokenÂ çš„Â ID/æ˜ å°„</td>
<td>å¦</td>
<td>æ§åˆ¶Â ,Â Â ç­‰çš„å®šä¹‰</td>
</tr>
</tbody>
</table>

<hr />

<h3 id="åº”ç”¨æ–¹å¼">ğŸ”§Â åº”ç”¨æ–¹å¼</h3>

<p>åŠ è½½æ¨¡å‹Â tokenizerÂ æ—¶ä¼šè‡ªåŠ¨ç”¨åˆ°ï¼š</p>

<pre><code class="language-python">from transformers import AutoTokenizer

tokenizer = AutoTokenizer.from_pretrained(&quot;gpt2&quot;)  # ä¼šè¯»å– vocab.json + merges.txt
tokens = tokenizer.tokenize(&quot;The apple is red.&quot;)
ids = tokenizer.convert_tokens_to_ids(tokens)

</code></pre>

<p>ä½ ä¹Ÿå¯ä»¥æ‰‹åŠ¨åŠ è½½ï¼š</p>

<pre><code class="language-python">import json

with open(&quot;vocab.json&quot;) as f:
    vocab = json.load(f)
print(vocab[&quot;apple&quot;])  # è¾“å‡ºå¯¹åº”çš„ token ID

</code></pre>

<hr />

<h3 id="å¦‚ä½•ç”Ÿæˆ-vocab-json">ğŸ—Â å¦‚ä½•ç”ŸæˆÂ vocab.jsonï¼Ÿ</h3>

<p>é€šå¸¸æ˜¯é€šè¿‡è®­ç»ƒåˆ†è¯å™¨ï¼š</p>

<pre><code class="language-python">from tokenizers import Tokenizer, models, trainers, pre_tokenizers

tokenizer = Tokenizer(models.BPE())
tokenizer.pre_tokenizer = pre_tokenizers.Whitespace()

trainer = trainers.BpeTrainer(vocab_size=10000, special_tokens=[&quot;&lt;pad&gt;&quot;, &quot;&lt;eos&gt;&quot;])
tokenizer.train([&quot;corpus.txt&quot;], trainer)

tokenizer.model.save(&quot;.&quot;, &quot;my-tokenizer&quot;)  # è¾“å‡º vocab.json + merges.txt

</code></pre>

<hr />

<h3 id="åœ¨æ¨ç†ä¸­çš„ä½œç”¨">ğŸš€Â åœ¨æ¨ç†ä¸­çš„ä½œç”¨</h3>

<p>åœ¨æ¨ç†æ—¶ï¼Œæ–‡æœ¬è¾“å…¥æµç¨‹å¦‚ä¸‹ï¼š</p>

<pre><code class="language-plaintext">æ–‡æœ¬è¾“å…¥ â†’ åˆ†è¯å™¨ â†’ token åºåˆ— â†’ vocab.json æŸ¥ ID â†’ æ¨¡å‹è¾“å…¥

</code></pre>

<p>åå‘è¾“å‡ºæµç¨‹ï¼š</p>

<pre><code class="language-plaintext">æ¨¡å‹è¾“å‡º token ID â†’ vocab.json åæŸ¥ token â†’ æ‹¼æ¥æˆæ–‡æœ¬

</code></pre>

<p>æ‰€ä»¥å®ƒæ˜¯ç¼–ç ä¸è§£ç çš„åŸºç¡€ã€‚</p>

<hr />

<h3 id="æ€»ç»“-5">âœ…Â æ€»ç»“</h3>

<table>
<thead>
<tr>
<th>å±æ€§</th>
<th>è¯´æ˜</th>
</tr>
</thead>

<tbody>
<tr>
<td>æ–‡ä»¶ç±»å‹</td>
<td>JSONï¼ˆé”®ä¸ºå­—ç¬¦ä¸²Â tokenï¼Œå€¼ä¸ºæ•´æ•°Â IDï¼‰</td>
</tr>

<tr>
<td>ç”¨é€”</td>
<td>ä¾›Â slowÂ tokenizerÂ ä½¿ç”¨ï¼›tokenÂ â†”Â IDÂ æ˜ å°„</td>
</tr>

<tr>
<td>ä¾èµ–</td>
<td>é€šå¸¸ä¸Â merges.txtÂ é…åˆä½¿ç”¨</td>
</tr>

<tr>
<td>è¢«è°ç”¨</td>
<td><code>AutoTokenizer</code>,Â <code>PreTrainedTokenizer</code>Â ç­‰</td>
</tr>

<tr>
<td>æ˜¯å¦å¯æ›¿ä»£</td>
<td>è‹¥æœ‰Â <code>tokenizer.json</code>ï¼Œåˆ™å¯ä¸å†ä½¿ç”¨å®ƒ</td>
</tr>
</tbody>
</table>

<hr />

<h1 id="4-æ€»ç»“">4ã€æ€»ç»“</h1>

<p>HuggingÂ FaceÂ æ¨¡å‹ç›®å½•ç»“æ„æ˜¯ç”¨äºä¿å­˜ä¸€ä¸ªé¢„è®­ç»ƒæ¨¡å‹ï¼ˆåŠå…¶Â tokenizerã€é…ç½®ç­‰ï¼‰çš„å®Œæ•´æ‰“åŒ…å½¢å¼ï¼Œç›®çš„æ˜¯ä¸ºäº†æ–¹ä¾¿æ¨¡å‹çš„åŠ è½½ã€å…±äº«ã€éƒ¨ç½²å’Œæ¨ç†ã€‚ä¸‹é¢ä¸ºä½ æ€»ç»“æ¨¡å‹ç›®å½•çš„<strong>æ ‡å‡†æ„æˆ</strong>ã€æ¯ä¸ªæ–‡ä»¶çš„ä½œç”¨ã€æ˜¯å¦å¿…é¡»ã€ä»¥åŠå®ƒä»¬ä¹‹é—´çš„å…³ç³»ã€‚</p>

<hr />

<h2 id="1-ç›®å½•ç»“æ„æ€»è§ˆ">âœ…Â 1.Â ç›®å½•ç»“æ„æ€»è§ˆ</h2>

<p>ä¸€ä¸ªå…¸å‹çš„Â HuggingÂ FaceÂ æ¨¡å‹ç›®å½•å¦‚ä¸‹ï¼š</p>

<pre><code class="language-plaintext">/your-model-dir/
â”œâ”€â”€ config.json
â”œâ”€â”€ generation_config.json
â”œâ”€â”€ pytorch_model.bin / model.safetensors
â”œâ”€â”€ model.safetensors.index.json (å¦‚ä¸ºåˆ†ç‰‡æ¨¡å‹)
â”œâ”€â”€ tokenizer_config.json
â”œâ”€â”€ tokenizer.json
â”œâ”€â”€ vocab.json
â”œâ”€â”€ merges.txt (å¦‚ä¸º BPE)
â”œâ”€â”€ special_tokens_map.json
â”œâ”€â”€ README.md

</code></pre>

<hr />

<h2 id="2-å„æ–‡ä»¶åŠŸèƒ½è¯¦è§£">ğŸ“Â 2.Â å„æ–‡ä»¶åŠŸèƒ½è¯¦è§£</h2>

<table>
<thead>
<tr>
<th>æ–‡ä»¶å</th>
<th>å¿…é¡»</th>
<th>ç±»å‹</th>
<th>ä½œç”¨</th>
</tr>
</thead>

<tbody>
<tr>
<td><strong>config.json</strong></td>
<td>âœ…Â æ˜¯</td>
<td>æ¨¡å‹é…ç½®</td>
<td>å®šä¹‰æ¨¡å‹æ¶æ„å‚æ•°ï¼ˆå±‚æ•°ã€éšè—ç»´åº¦ã€dropoutÂ ç­‰ï¼‰</td>
</tr>

<tr>
<td><strong>pytorch_model.bin</strong>Â /Â <strong>model.safetensors</strong></td>
<td>âœ…Â æ˜¯</td>
<td>æ¨¡å‹æƒé‡</td>
<td>ä¿å­˜æ¨¡å‹çš„é¢„è®­ç»ƒå‚æ•°ï¼ˆPyTorchÂ æ ¼å¼Â /Â safetensorsÂ æ›´å®‰å…¨ï¼‰</td>
</tr>

<tr>
<td><strong>model.safetensors.index.json</strong></td>
<td>ğŸš«Â å¦</td>
<td>æƒé‡ç´¢å¼•</td>
<td>ç”¨äºåˆ†ç‰‡æ¨¡å‹ï¼ˆå¤šå—Â .safetensorsÂ çš„ç´¢å¼•ä¿¡æ¯ï¼‰</td>
</tr>

<tr>
<td><strong>tokenizer_config.json</strong></td>
<td>âœ…Â æ˜¯</td>
<td>tokenizerÂ é…ç½®</td>
<td>æ§åˆ¶Â tokenizerÂ è¡Œä¸ºï¼Œæ¯”å¦‚æ˜¯å¦å°å†™ã€æ˜¯å¦æ·»åŠ Â BOS/EOSÂ ç­‰</td>
</tr>

<tr>
<td><strong>tokenizer.json</strong></td>
<td>ğŸš«Â å¦</td>
<td>FastÂ tokenizer</td>
<td>HuggingÂ FaceÂ çš„Â RustÂ å®ç°Â tokenizerï¼Œé€Ÿåº¦å¿«ï¼ŒåŒ…å«Â vocab+merges</td>
</tr>

<tr>
<td><strong>vocab.json</strong></td>
<td>âœ…Â æ˜¯</td>
<td>è¯è¡¨ï¼ˆtokenÂ â†’Â idï¼‰</td>
<td>åˆ†è¯å™¨è¯å…¸ï¼Œä¸»è¦ç”¨äºÂ slowÂ tokenizer</td>
</tr>

<tr>
<td><strong>merges.txt</strong></td>
<td>âš ï¸Â è§†åˆ†è¯å™¨ç±»å‹</td>
<td>BPEÂ åˆå¹¶è§„åˆ™</td>
<td>ä»…ç”¨äºÂ BPEï¼ˆGPTã€RobertaÂ ç­‰ï¼‰</td>
</tr>

<tr>
<td><strong>special_tokens_map.json</strong></td>
<td>ğŸš«Â å¦</td>
<td>ç‰¹æ®ŠÂ tokenÂ æ˜ å°„</td>
<td>æ˜ å°„Â ã€ã€Â ç­‰åˆ°å¯¹åº”Â ID</td>
</tr>

<tr>
<td><strong>generation_config.json</strong></td>
<td>ğŸš«Â å¦</td>
<td>æ¨ç†é…ç½®</td>
<td>å®šä¹‰é‡‡æ ·ç­–ç•¥ï¼ˆå¦‚Â temperature,Â top_k,Â repetition_penaltyÂ ç­‰ï¼‰</td>
</tr>

<tr>
<td><strong>README.md</strong></td>
<td>ğŸš«Â å¦</td>
<td>æ–‡æ¡£</td>
<td>æ¨¡å‹è¯´æ˜æ–‡æ¡£ï¼ˆåœ¨Â HuggingÂ FaceÂ hubÂ ä¸Šå±•ç¤ºï¼‰</td>
</tr>
</tbody>
</table>

<hr />

<h2 id="3-å¿…é¡»-vs-å¯é€‰æ–‡ä»¶æ±‡æ€»">ğŸ§ Â 3.Â å¿…é¡»Â vsÂ å¯é€‰æ–‡ä»¶æ±‡æ€»</h2>

<h3 id="å¿…é¡»æ–‡ä»¶-ç”¨äºæ¨¡å‹åŠ è½½">âœ…Â å¿…é¡»æ–‡ä»¶ï¼ˆç”¨äºæ¨¡å‹åŠ è½½ï¼‰</h3>

<ul>
<li><p><code>config.json</code></p></li>

<li><p><code>pytorch_model.bin</code>Â æˆ–Â <code>model.safetensors</code></p></li>

<li><p><code>tokenizer_config.json</code></p></li>

<li><p><code>vocab.json</code></p></li>
</ul>

<h3 id="æ ¹æ®æ¨¡å‹ç±»å‹å¿…é¡»">âš ï¸Â æ ¹æ®æ¨¡å‹ç±»å‹å¿…é¡»</h3>

<ul>
<li><code>merges.txt</code>ï¼šå¦‚æœä½¿ç”¨Â BPEÂ tokenizerï¼ˆå¦‚Â GPTã€Robertaï¼‰
<br /></li>
</ul>

<h3 id="å¯é€‰ä½†æ¨è">ğŸš«Â å¯é€‰ä½†æ¨è</h3>

<ul>
<li><p><code>tokenizer.json</code>ï¼šæ¨èç”¨äºÂ fastÂ tokenizerï¼ŒåŠ å¿«é€Ÿåº¦</p></li>

<li><p><code>generation_config.json</code>ï¼šå¦‚æ¨¡å‹ç”¨äºç”Ÿæˆä»»åŠ¡ï¼ˆæ–‡æœ¬ç”Ÿæˆã€èŠå¤©ï¼‰</p></li>

<li><p><code>special_tokens_map.json</code>ï¼šå¯¹è¯æ¨¡å‹ã€ç¿»è¯‘ã€QAÂ å¸¸ç”¨</p></li>

<li><p><code>README.md</code>ï¼šç”¨äºæ¨¡å‹è¯´æ˜å’Œæ–‡æ¡£å±•ç¤º</p></li>

<li><p><code>model.safetensors.index.json</code>ï¼šå½“æ¨¡å‹æ˜¯åˆ†ç‰‡ç»“æ„ï¼ˆshardedï¼‰æ—¶æ‰å‡ºç°</p></li>
</ul>

<hr />

<h2 id="4-åŠ è½½æ—¶å·¥ä½œæœºåˆ¶">ğŸ“¦Â 4.Â åŠ è½½æ—¶å·¥ä½œæœºåˆ¶</h2>

<p>HuggingÂ FaceÂ çš„Â <code>AutoModel</code>Â å’ŒÂ <code>AutoTokenizer</code>Â ä¼šæ ¹æ®ç›®å½•å†…å®¹è‡ªåŠ¨åˆ¤æ–­ä½¿ç”¨å“ªç§æ–‡ä»¶ï¼š</p>

<pre><code class="language-python">from transformers import AutoModelForCausalLM, AutoTokenizer

model = AutoModelForCausalLM.from_pretrained(&quot;./your-model-dir&quot;)
tokenizer = AutoTokenizer.from_pretrained(&quot;./your-model-dir&quot;)

</code></pre>

<p>å®ƒä¼šä¾æ¬¡å°è¯•åŠ è½½ï¼š</p>

<ul>
<li><p>æƒé‡ï¼š<code>model.safetensors</code>Â &gt;Â <code>pytorch_model.bin</code></p></li>

<li><p>tokenizerï¼š<code>tokenizer.json</code>Â &gt;Â <code>vocab.jsonÂ +Â merges.txt</code></p></li>

<li><p>ç‰¹æ®ŠÂ tokenï¼š<code>special_tokens_map.json</code></p></li>

<li><p>æ¨ç†ç­–ç•¥ï¼š<code>generation_config.json</code></p></li>
</ul>

<hr />

<h2 id="5-ç¤ºä¾‹åº”ç”¨æµç¨‹">ğŸ”Â 5.Â ç¤ºä¾‹åº”ç”¨æµç¨‹</h2>

<pre><code class="language-txt">æ–‡æœ¬ â†’ tokenizer.json/vocab.json â†’ token ID â†’ æ¨¡å‹(config+æƒé‡) â†’ è¾“å‡º token ID â†’ åå‘ tokenizer â†’ æ–‡æœ¬è¾“å‡º

</code></pre>

<hr />

<h2 id="æ€»ç»“ä¸€å¥è¯-1">âœ…Â æ€»ç»“ä¸€å¥è¯</h2>

<blockquote>
<p>HuggingÂ FaceÂ æ¨¡å‹ç›®å½•åŒ…å«äº†â€œæ¨¡å‹ç»“æ„ï¼ˆconfigï¼‰+æƒé‡+åˆ†è¯å™¨+æ¨ç†ç­–ç•¥â€çš„å®Œæ•´ç»„ä»¶ï¼Œæ˜¯éƒ¨ç½²ã€å…±äº«ã€åŠ è½½æ¨¡å‹çš„æ ‡å‡†æ‰“åŒ…æ ¼å¼ã€‚</p>
</blockquote>

<hr />

    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
  <div style="float:right;margin-top:0px;">
    <img src="/img/qrcode.jpg" width="129px" height="129px"/>
    <div style="text-align:center;">å¾®ä¿¡æ‰«ä¸€æ‰«</div>
  </div>
  <div style="float:left;margin-top:0px;">
    <img src="/img/rewardcode.jpg" width="129px" height="129px"/>
  </div>
  <div>
    <p style="margin-top:0px;">ä½œè€…ï¼š<a target="_blank" href="http://blog.mospan.cn/">mospan</a>
      <br />å¾®ä¿¡å…³æ³¨ï¼šå¢¨æ–¯æ½˜åœ’
      <br />æœ¬æ–‡å‡ºå¤„ï¼š<a target="_blank" href="http://mospany.github.io/2025/11/09/hugging-face/">http://mospany.github.io/2025/11/09/hugging-face/</a>
      <br />
      æ–‡ç« ç‰ˆæƒå½’æœ¬äººæ‰€æœ‰ï¼Œæ¬¢è¿è½¬è½½ï¼Œä½†æœªç»ä½œè€…åŒæ„å¿…é¡»ä¿ç•™æ­¤æ®µå£°æ˜ï¼Œä¸”åœ¨æ–‡ç« é¡µé¢æ˜æ˜¾ä½ç½®ç»™å‡ºåŸæ–‡è¿æ¥ï¼Œå¦åˆ™ä¿ç•™è¿½ç©¶æ³•å¾‹è´£ä»»çš„æƒåˆ©ã€‚</p>
  </div>
</div>


	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="/tags/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0">æŠ€æœ¯æ–‡ç« </a>
  
  <a href="/tags/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">äººå·¥æ™ºèƒ½</a>
  
</div>



<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="/categories/%E6%8A%80%E6%9C%AF%E6%96%87%E7%AB%A0">æŠ€æœ¯æ–‡ç« </a>
  
  <a class="article-category-link" href="/categories/%E4%BA%BA%E5%B7%A5%E6%99%BA%E8%83%BD">äººå·¥æ™ºèƒ½</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="http://mospany.github.io/2025/11/09/hugging-face/" data-title="å¤§æ¨¡å‹æƒé‡æ–‡ä»¶è§£æ" data-tsina="3833537679" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  





<div id="git-comments"></div>
<link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
<script src="https://billts.site/js/gitment.js"></script>
<script>
var gitment = new Gitment({
  id: '<%= page.date %>',
  owner: 'mospany',
  repo: 'mospan-hugo-blog-gitment',
  oauth: {
    client_id: '0cafe299c964f0af2d1e',
    client_secret: 'ec47ee9481210935a662298791c31da203694a8f',
  },
})
gitment.render('git-comments')
</script>    


</div>

    <div class="openaside"><a class="navbutton" href="#" title="æ˜¾ç¤ºä¾§è¾¹æ "></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="éšè—ä¾§è¾¹æ "></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">åˆ†ç±»</p>
  <ul>
    
    <li><a href="http://mospany.github.io/categories/%e4%ba%91%e8%ae%a1%e7%ae%97" title="äº‘è®¡ç®—">äº‘è®¡ç®—<sup>7</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e4%ba%ba%e5%b7%a5%e6%99%ba%e8%83%bd" title="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½<sup>14</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" title="å·¥å…·ä½¿ç”¨">å·¥å…·ä½¿ç”¨<sup>3</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" title="æŠ€æœ¯æ–‡ç« ">æŠ€æœ¯æ–‡ç« <sup>49</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" title="ç”Ÿæ´»è®°å½•">ç”Ÿæ´»è®°å½•<sup>1</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" title="èŒåœºäººç”Ÿ">èŒåœºäººç”Ÿ<sup>1</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" title="è¯»ä¹¦ç¬”è®°">è¯»ä¹¦ç¬”è®°<sup>2</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">æ ‡ç­¾</p>
		<ul class="clearfix">
      
			<li><a href="http://mospany.github.io/tags/" title=""><sup>8</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/dns" title="dns">dns<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/dpdk" title="dpdk">dpdk<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/emacs" title="emacs">emacs<sup>5</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/gpu" title="gpu">gpu<sup>6</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/hugo" title="hugo">hugo<sup>3</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/ipv6" title="ipv6">ipv6<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/k8s" title="k8s">k8s<sup>20</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/linux" title="linux">linux<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/openresty" title="openresty">openresty<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/org-mode" title="org-mode">org-mode<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/pango" title="pango">pango<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/redis" title="redis">redis<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/spacemacs" title="spacemacs">spacemacs<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/vim" title="vim">vim<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/vue" title="vue">vue<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/xns" title="xns">xns<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/yaml" title="yaml">yaml<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e4%ba%91%e8%ae%a1%e7%ae%97" title="äº‘è®¡ç®—">äº‘è®¡ç®—<sup>6</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e4%ba%92%e8%81%94%e7%bd%91" title="äº’è”ç½‘">äº’è”ç½‘<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e4%ba%ba%e5%b7%a5%e6%99%ba%e8%83%bd" title="äººå·¥æ™ºèƒ½">äººå·¥æ™ºèƒ½<sup>3</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%89%8d%e7%ab%af" title="å‰ç«¯">å‰ç«¯<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%8d%9a%e5%ae%a2" title="åšå®¢">åšå®¢<sup>7</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%ad%98%e5%82%a8" title="å­˜å‚¨">å­˜å‚¨<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%b7%a5%e5%85%b7" title="å·¥å…·">å·¥å…·<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%be%ae%e4%bf%a1" title="å¾®ä¿¡">å¾®ä¿¡<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" title="æŠ€æœ¯æ–‡ç« ">æŠ€æœ¯æ–‡ç« <sup>5</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e6%9e%b6%e6%9e%84" title="æ¶æ„">æ¶æ„<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e7%8b%ac%e7%ab%8b" title="ç‹¬ç«‹">ç‹¬ç«‹<sup>3</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" title="ç”Ÿæ´»è®°å½•">ç”Ÿæ´»è®°å½•<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" title="èŒåœºäººç”Ÿ">èŒåœºäººç”Ÿ<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" title="è¯»ä¹¦ç¬”è®°">è¯»ä¹¦ç¬”è®°<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%82%ae%e7%ae%b1" title="é‚®ç®±">é‚®ç®±<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%9d%a2%e8%af%95" title="é¢è¯•">é¢è¯•<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%a1%b9%e7%9b%ae%e5%ae%9e%e8%b7%b5" title="é¡¹ç›®å®è·µ">é¡¹ç›®å®è·µ<sup>4</sup></a></li>
      
		</ul>
</div>



    <div class="linkslist">
  <p class="asidetitle">æˆ‘çš„å…³æ³¨</p>
    <ul>
          <li>
            	<a href="http://www.csdn.net/" target="_blank" title="ä¸­å›½è½¯ä»¶å¼€å‘ç½‘(CSDN)">ä¸­å›½è½¯ä»¶å¼€å‘ç½‘(CSDN)</a>
          </li>
          <li>
            	<a href="http://www.golangtc.com/" target="_blank" title="Golangä¸­å›½">Golangä¸­å›½</a>
          </li>
          <li>
            	<a href="http://blog.qiniu.com/" target="_blank" title="ä¸ƒç‰›å›¢é˜Ÿåšå®¢">ä¸ƒç‰›å›¢é˜Ÿåšå®¢</a>
          </li>
          <li>
            	<a href="http://csrd.aliapp.com/" target="_blank" title="é˜¿é‡Œæ ¸å¿ƒç³»ç»Ÿå›¢é˜Ÿåšå®¢">é˜¿é‡Œæ ¸å¿ƒç³»ç»Ÿå›¢é˜Ÿåšå®¢</a>
          </li>
          <li>
            	<a href="http://coolshell.cn/" target="_blank" title="é…·å£³ï¼é™ˆæµ©">é…·å£³ï¼é™ˆæµ©</a>
          </li>
          <li>
            	<a href="http://www.ruanyifeng.com/blog/" target="_blank" title="é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—">é˜®ä¸€å³°çš„ç½‘ç»œæ—¥å¿—</a>
          </li>
          <li>
            	<a href="https://blog.dandyweng.com/" target="_blank" title="homeschoolerï¼ç¿å¤©ä¿¡çš„åšå®¢">homeschoolerï¼ç¿å¤©ä¿¡çš„åšå®¢</a>
          </li>
          <li>
            	<a href="http://www.jeffjade.com/" target="_blank" title="æ™šæ™´å¹½è‰è½©">æ™šæ™´å¹½è‰è½©</a>
          </li>
          <li>
            	<a href="https://nicejade.github.io/index.html" target="_blank" title="å¤©æ„äººé—´èˆ«">å¤©æ„äººé—´èˆ«</a>
          </li>
    </ul>
</div>

    <div class="linkslist">
  <p class="asidetitle">åœ¨çº¿ä¹¦ç±</p>
    <ul>
          <li>
            	<a href="https://docs.ruanjiadeng.com/gopl-zh/index.html" target="_blank" title="Goè¯­è¨€åœ£ç»ï¼ˆä¸­æ–‡ç‰ˆï¼‰">Goè¯­è¨€åœ£ç»ï¼ˆä¸­æ–‡ç‰ˆï¼‰</a>
          </li>
          <li>
            	<a href="http://studygolang.com/pkgdoc" target="_blank" title="Goè¯­è¨€æ ‡å‡†åº“">Goè¯­è¨€æ ‡å‡†åº“</a>
          </li>
          <li>
            	<a href="http://www.w3school.com.cn/" target="_blank" title="w3school åœ¨çº¿æ•™ç¨‹">w3school åœ¨çº¿æ•™ç¨‹</a>
          </li>
    </ul>
</div>

    <div class="linkslist">
  <p class="asidetitle">å‹æƒ…é“¾æ¥</p>
    <ul>
          <li>
            	<a href="http://www.cloudxns.net/" target="_blank" title="CloudXNSå®˜ç½‘">CloudXNSå®˜ç½‘</a>
          </li>
          <li>
            	<a href="http://www.chinatesters.com/" target="_blank" title="åå¤è¯„æµ‹å¸ˆå®¶å›­">åå¤è¯„æµ‹å¸ˆå®¶å›­</a>
          </li>
    </ul>
</div>

  
  <div class="archiveslist">
    <p class="asidetitle">å½’æ¡£</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2025-11">2025å¹´11æœˆ</a><span class="archive-list-count">10</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2025-08">2025å¹´08æœˆ</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2025-07">2025å¹´07æœˆ</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2024-02">2024å¹´02æœˆ</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2024-01">2024å¹´01æœˆ</a><span class="archive-list-count">7</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2023-06">2023å¹´06æœˆ</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2023-03">2023å¹´03æœˆ</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2023-01">2023å¹´01æœˆ</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-12">2022å¹´12æœˆ</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-11">2022å¹´11æœˆ</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-10">2022å¹´10æœˆ</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-09">2022å¹´09æœˆ</a><span class="archive-list-count">7</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-11">2019å¹´11æœˆ</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-10">2019å¹´10æœˆ</a><span class="archive-list-count">8</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-08">2019å¹´08æœˆ</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-02">2019å¹´02æœˆ</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2018-02">2018å¹´02æœˆ</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-08">2017å¹´08æœˆ</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-07">2017å¹´07æœˆ</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-03">2017å¹´03æœˆ</a><span class="archive-list-count">8</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-09">2016å¹´09æœˆ</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-05">2016å¹´05æœˆ</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-03">2016å¹´03æœˆ</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-02">2016å¹´02æœˆ</a><span class="archive-list-count">11</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-01">2016å¹´01æœˆ</a><span class="archive-list-count">6</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#0001-01">0001å¹´01æœˆ</a><span class="archive-list-count">1</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">æ ‡ç­¾äº‘</p>
  <div class="tagcloudlist clearfix">
    
    <a href="http://mospany.github.io/tags/" style="font-size: 12px;"></a>
    
    <a href="http://mospany.github.io/tags/dns" style="font-size: 12px;">dns</a>
    
    <a href="http://mospany.github.io/tags/dpdk" style="font-size: 12px;">dpdk</a>
    
    <a href="http://mospany.github.io/tags/emacs" style="font-size: 12px;">emacs</a>
    
    <a href="http://mospany.github.io/tags/gpu" style="font-size: 12px;">gpu</a>
    
    <a href="http://mospany.github.io/tags/hugo" style="font-size: 12px;">hugo</a>
    
    <a href="http://mospany.github.io/tags/ipv6" style="font-size: 12px;">ipv6</a>
    
    <a href="http://mospany.github.io/tags/k8s" style="font-size: 12px;">k8s</a>
    
    <a href="http://mospany.github.io/tags/linux" style="font-size: 12px;">linux</a>
    
    <a href="http://mospany.github.io/tags/openresty" style="font-size: 12px;">openresty</a>
    
    <a href="http://mospany.github.io/tags/org-mode" style="font-size: 12px;">org-mode</a>
    
    <a href="http://mospany.github.io/tags/pango" style="font-size: 12px;">pango</a>
    
    <a href="http://mospany.github.io/tags/redis" style="font-size: 12px;">redis</a>
    
    <a href="http://mospany.github.io/tags/spacemacs" style="font-size: 12px;">spacemacs</a>
    
    <a href="http://mospany.github.io/tags/vim" style="font-size: 12px;">vim</a>
    
    <a href="http://mospany.github.io/tags/vue" style="font-size: 12px;">vue</a>
    
    <a href="http://mospany.github.io/tags/xns" style="font-size: 12px;">xns</a>
    
    <a href="http://mospany.github.io/tags/yaml" style="font-size: 12px;">yaml</a>
    
    <a href="http://mospany.github.io/tags/%e4%ba%91%e8%ae%a1%e7%ae%97" style="font-size: 12px;">äº‘è®¡ç®—</a>
    
    <a href="http://mospany.github.io/tags/%e4%ba%92%e8%81%94%e7%bd%91" style="font-size: 12px;">äº’è”ç½‘</a>
    
    <a href="http://mospany.github.io/tags/%e4%ba%ba%e5%b7%a5%e6%99%ba%e8%83%bd" style="font-size: 12px;">äººå·¥æ™ºèƒ½</a>
    
    <a href="http://mospany.github.io/tags/%e5%89%8d%e7%ab%af" style="font-size: 12px;">å‰ç«¯</a>
    
    <a href="http://mospany.github.io/tags/%e5%8d%9a%e5%ae%a2" style="font-size: 12px;">åšå®¢</a>
    
    <a href="http://mospany.github.io/tags/%e5%ad%98%e5%82%a8" style="font-size: 12px;">å­˜å‚¨</a>
    
    <a href="http://mospany.github.io/tags/%e5%b7%a5%e5%85%b7" style="font-size: 12px;">å·¥å…·</a>
    
    <a href="http://mospany.github.io/tags/%e5%be%ae%e4%bf%a1" style="font-size: 12px;">å¾®ä¿¡</a>
    
    <a href="http://mospany.github.io/tags/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" style="font-size: 12px;">æŠ€æœ¯æ–‡ç« </a>
    
    <a href="http://mospany.github.io/tags/%e6%9e%b6%e6%9e%84" style="font-size: 12px;">æ¶æ„</a>
    
    <a href="http://mospany.github.io/tags/%e7%8b%ac%e7%ab%8b" style="font-size: 12px;">ç‹¬ç«‹</a>
    
    <a href="http://mospany.github.io/tags/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" style="font-size: 12px;">ç”Ÿæ´»è®°å½•</a>
    
    <a href="http://mospany.github.io/tags/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" style="font-size: 12px;">èŒåœºäººç”Ÿ</a>
    
    <a href="http://mospany.github.io/tags/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" style="font-size: 12px;">è¯»ä¹¦ç¬”è®°</a>
    
    <a href="http://mospany.github.io/tags/%e9%82%ae%e7%ae%b1" style="font-size: 12px;">é‚®ç®±</a>
    
    <a href="http://mospany.github.io/tags/%e9%9d%a2%e8%af%95" style="font-size: 12px;">é¢è¯•</a>
    
    <a href="http://mospany.github.io/tags/%e9%a1%b9%e7%9b%ae%e5%ae%9e%e8%b7%b5" style="font-size: 12px;">é¡¹ç›®å®è·µ</a>
    
  </div>
</div>



  
</aside>
</div>

  </div>
  <footer><div id="footer" >
  
  <div class="line">
    <span></span>
    <div style='background:no-repeat url("http://mospany.github.io/img/author.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/qiniu_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/fastweb_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/leadsec_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/raisecom_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/jbt_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  
  
  <div class="social-font clearfix">
    
    <a href="http://weibo.com/mospan" target="_blank" title="weibo"></a>
    
    
    <a href="https://twitter.com/mospan" target="_blank" title="twitter"></a>
    
    
    <a href="https://github.com/mospany" target="_blank" title="github"></a>
    
    
    <a href="https://www.facebook.com/mospan" target="_blank" title="facebook"></a>
    
    
    <a href="https://www.linkedin.com/mospan" target="_blank" title="linkedin"></a>
    
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/mospany/mospan-hugo-blog/tree/master/themes/hugo-panman-theme" target="_blank" title="hugo-panman-theme">hugo-panman-theme</a> Â© 2025
    
    <a href="http://mospany.github.io/" target="_blank" title="mospan">mospan</a>
    
  </p>
</div>
</footer>
  <script src="http://mospany.github.io/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:http:\/\/mospany.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>æ‰«æäºŒç»´ç åˆ†äº«åˆ°å¾®ä¿¡æœ‹å‹åœˆ</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="http://mospany.github.io/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="http://mospany.github.io/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
