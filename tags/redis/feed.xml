<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title>Redis on 墨斯潘園</title>
        <link>http://yanwushuang.github.io/tags/redis/</link>
        <language>zh-CN</language>
        <author>Mospan</author>
        <rights>Copyright (c) 2016, mospan; all rights reserved.</rights>
        <updated>Thu, 02 Mar 2017 11:14:08 HKT</updated>
        
        <item>
            <title>openresty&#43;redis实践</title>
            <link>http://yanwushuang.github.io/2017/03/02/openrestyredis-practices/</link>
            <pubDate>Thu, 02 Mar 2017 11:14:08 HKT</pubDate>
            <author>Mospan</author>
            <guid>http://yanwushuang.github.io/2017/03/02/openrestyredis-practices/</guid>
            <description>

&lt;h1 id=&#34;安装-a-id-sec-1-name-sec-1-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;安装&lt;a id=&#34;sec-1&#34; name=&#34;sec-1&#34;&gt;&lt;/a&gt;&lt;/h1&gt;

&lt;h2 id=&#34;openresty安装-a-id-sec-1-1-name-sec-1-1-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;openresty安装&lt;a id=&#34;sec-1-1&#34; name=&#34;sec-1-1&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;详见 &lt;a href=&#34;https://openresty.org/cn/installation.html&#34;&gt;openresty安装&lt;/a&gt;&lt;/p&gt;

&lt;h2 id=&#34;redis安装-a-id-sec-1-2-name-sec-1-2-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;redis安装&lt;a id=&#34;sec-1-2&#34; name=&#34;sec-1-2&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;执行如下命令：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;sudo apt-get update  
sudo apt-get install redis-server
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;详见 &lt;a href=&#34;http://www.jianshu.com/p/c8723b677304&#34;&gt;Ubuntu安装配置Redis&lt;/a&gt;&lt;/p&gt;

&lt;h1 id=&#34;编写api-a-id-sec-2-name-sec-2-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;编写API&lt;a id=&#34;sec-2&#34; name=&#34;sec-2&#34;&gt;&lt;/a&gt;&lt;/h1&gt;

&lt;p&gt;根据项目要求编写openresty+lua的增删改查API接口。&lt;/p&gt;

&lt;h1 id=&#34;测试-a-id-sec-3-name-sec-3-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;测试&lt;a id=&#34;sec-3&#34; name=&#34;sec-3&#34;&gt;&lt;/a&gt;&lt;/h1&gt;

&lt;h2 id=&#34;发送请求-a-id-sec-3-1-name-sec-3-1-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;发送请求&lt;a id=&#34;sec-3-1&#34; name=&#34;sec-3-1&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;使用curl命令发送http json请求:&lt;/p&gt;

&lt;ol&gt;
&lt;li&gt;先写请求json&lt;/li&gt;
&lt;/ol&gt;

&lt;blockquote&gt;
&lt;p&gt;root@bj94:~/dr302client# cat add.json
{&lt;/p&gt;

&lt;p&gt;&amp;ldquo;www.example.com&amp;rdquo;: {&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    &amp;quot;sub\_domain&amp;quot;: &amp;quot;@&amp;quot;,
    &amp;quot;record\_type&amp;quot;: &amp;quot;CNAME&amp;quot;,
    &amp;quot;record\_line&amp;quot;: &amp;quot;all&amp;quot;,
    &amp;quot;record\_line\_id&amp;quot;: &amp;quot;00000000&amp;quot;,
    &amp;quot;value&amp;quot;: &amp;quot;all.china.qiniu.qnydns.com&amp;quot;,
    &amp;quot;mx&amp;quot;: 1,
    &amp;quot;ttl&amp;quot;: 86400,
    &amp;quot;status&amp;quot;: &amp;quot;enable&amp;quot;,
    &amp;quot;weight&amp;quot;: 100
}
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;}&lt;/p&gt;
&lt;/blockquote&gt;

&lt;ol&gt;
&lt;li&gt;&lt;p&gt;执行命令：&lt;/p&gt;

&lt;p&gt;curl -i -H &amp;lsquo;content-type: application/json&amp;rsquo; -X POST -d @add.json &lt;a href=&#34;http://dev.mgrconfig.api.qiniudns.com/qiniu/dr302/records/add&#34;&gt;http://dev.mgrconfig.api.qiniudns.com/qiniu/dr302/records/add&lt;/a&gt;&lt;/p&gt;&lt;/li&gt;
&lt;/ol&gt;

&lt;h2 id=&#34;回复响应-a-id-sec-3-2-name-sec-3-2-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;回复响应&lt;a id=&#34;sec-3-2&#34; name=&#34;sec-3-2&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;根据不同返回码表示操作结果。&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;root@bj94:~/dr302client# curl -i -H &amp;lsquo;content-type: application/json&amp;rsquo; -X POST -d @addA.json &lt;a href=&#34;http://dev.mgrconfig.api.qiniudns.com/qiniu/dr302/records/add&#34;&gt;http://dev.mgrconfig.api.qiniudns.com/qiniu/dr302/records/add&lt;/a&gt;
HTTP/1.1 200 OK
Date: Thu, 09 Mar 2017 03:01:17 GMT
Content-Type: text/plain
Transfer-Encoding: chunked
Connection: keep-alive
Server: DR302-MGR&lt;/p&gt;

&lt;p&gt;{
    &amp;ldquo;status&amp;rdquo;:{
               &amp;ldquo;created_at&amp;rdquo;:&amp;ldquo;2017-03-09 11:01:17&amp;rdquo;,
               &amp;ldquo;code&amp;rdquo;:0,
               &amp;ldquo;message&amp;rdquo;:&amp;ldquo;success&amp;rdquo;
             },
    &amp;ldquo;record&amp;rdquo;:{
               &amp;ldquo;status&amp;rdquo;:&amp;ldquo;enable&amp;rdquo;,
               &amp;ldquo;key&amp;rdquo;:&amp;ldquo;www.example.com#all&amp;rdquo;,
               &amp;ldquo;name&amp;rdquo;:&amp;ldquo;@&amp;rdquo;
             }
}&lt;/p&gt;
&lt;/blockquote&gt;

&lt;h2 id=&#34;查看存储-a-id-sec-3-3-name-sec-3-3-a:38a21b9d2dd371e907c19440321d5c01&#34;&gt;查看存储&lt;a id=&#34;sec-3-3&#34; name=&#34;sec-3-3&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;执行命令:&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;(echo  &amp;quot;select 10&amp;quot;; echo &amp;quot;hgetall www.example.com#all&amp;quot;) | redis-cli -a cdnfusion -p 7648&amp;quot;)
&lt;/code&gt;&lt;/pre&gt;

&lt;p&gt;显示如下:&lt;/p&gt;

&lt;blockquote&gt;
&lt;p&gt;root@bj94:~/dr302client# (echo  &amp;ldquo;select 10&amp;rdquo;; echo &amp;ldquo;hgetall www.example.com#all&amp;rdquo;) | redis-cli -a cdnfusion -p 7648
OK
1.  &amp;ldquo;weight&amp;rdquo;
2.  &amp;ldquo;20&amp;rdquo;
3.  &amp;ldquo;record_type&amp;rdquo;
4.  &amp;ldquo;A&amp;rdquo;
5.  &amp;ldquo;record_line&amp;rdquo;
6.  &amp;ldquo;all&amp;rdquo;
7.  &amp;ldquo;status&amp;rdquo;
8.  &amp;ldquo;enable&amp;rdquo;
9.  &amp;ldquo;mx&amp;rdquo;
10. &amp;ldquo;1&amp;rdquo;
11. &amp;ldquo;value&amp;rdquo;
12. &amp;ldquo;1.1.1.1#10|2.2.2.2#20&amp;rdquo;
13. &amp;ldquo;ttl&amp;rdquo;
14. &amp;ldquo;86400&amp;rdquo;
15. &amp;ldquo;record_line_id&amp;rdquo;
16. &amp;ldquo;00000000&amp;rdquo;
17. &amp;ldquo;sub_domain&amp;rdquo;
18. &amp;ldquo;@&amp;rdquo;&lt;/p&gt;
&lt;/blockquote&gt;
</description>
        </item>
        
    </channel>
</rss>
