<?xml version="1.0" encoding="utf-8" standalone="yes" ?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
    <channel>
        <title> on 墨斯潘園</title>
        <link>http://yanwushuang.github.io/categories/</link>
        <language>zh-CN</language>
        <author>Mospan</author>
        <rights>Copyright (c) 2016, mospan; all rights reserved.</rights>
        <updated>Tue, 06 Sep 2016 19:37:20 HKT</updated>
        
        <item>
            <title>DPDK开发随记</title>
            <link>http://yanwushuang.github.io/2016/09/06/dpdk-develop-notes</link>
            <pubDate>Tue, 06 Sep 2016 19:37:20 HKT</pubDate>
            <author>Mospan</author>
            <guid>http://yanwushuang.github.io/2016/09/06/dpdk-develop-notes</guid>
            <description>

&lt;h1 id=&#34;faq-a-id-sec-1-name-sec-1-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;FAQ&lt;a id=&#34;sec-1&#34; name=&#34;sec-1&#34;&gt;&lt;/a&gt;&lt;/h1&gt;

&lt;h2 id=&#34;打开dpdk工程makefile编译详细信息-a-id-sec-1-1-name-sec-1-1-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;打开DPDK工程Makefile编译详细信息？&lt;a id=&#34;sec-1-1&#34; name=&#34;sec-1-1&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;答：&lt;br /&gt;
1.  打开dpdk/mk/rte.sdkroot.mk文件。
2.  把变量Q赋为空。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;# define Q to &#39;@&#39; or not. $(Q) is used to prefix all shell commands to
# be executed silently.
Q=
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;出现这个错误-include-dpdk-rte-memcpy-h-870-2-错误-mm-storeu-si128-的第-2-个实参类型不兼容的解决办法-a-id-sec-1-2-name-sec-1-2-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;出现这个错误： include/dpdk/rte_memcpy.h:870:2: 错误：‘_mm_storeu_si128’的第 2 个实参类型不兼容的解决办法&lt;a id=&#34;sec-1-2&#34; name=&#34;sec-1-2&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;答：&lt;br /&gt;
1.  只要在自己的Makefile中增加如下两行即可。&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;    include $(RTE_SDK)/mk/rte.vars.mk
    include $(RTE_SDK)/mk/internal/rte.build-pre.mk
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;在虚拟机中跑dpdk-网卡接收不正常问题-a-id-sec-1-3-name-sec-1-3-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;在虚拟机中跑DPDK，网卡接收不正常问题。&lt;a id=&#34;sec-1-3&#34; name=&#34;sec-1-3&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;h3 id=&#34;现象-a-id-sec-1-3-1-name-sec-1-3-1-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;现象&lt;a id=&#34;sec-1-3-1&#34; name=&#34;sec-1-3-1&#34;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;虚拟出来的网卡只收到了少量的ARP包，并且QANS可以响应ARP请求成功，但收不到icmp与DNS包等。&lt;/p&gt;

&lt;h3 id=&#34;调试过程-a-id-sec-1-3-2-name-sec-1-3-2-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;调试过程&lt;a id=&#34;sec-1-3-2&#34; name=&#34;sec-1-3-2&#34;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;ol&gt;
&lt;li&gt;虚拟网卡虚拟出来的是intel 82540EM网卡。&lt;/li&gt;
&lt;li&gt;查看DPDK官方支持网卡列表，支持intel 82540，但不知道与82540EM有哪些细微差别。&lt;/li&gt;
&lt;li&gt;尝试了virtual下可配的虚拟网卡(82545em，82543gc, 82545em，virtio-net)，无一完全成功。&lt;/li&gt;
&lt;li&gt;网卡流量统计，确实只收到了少量与arp包数等同的包(一直ping了10多分钟)。&lt;/li&gt;
&lt;li&gt;查看了KNI创建的虚拟网卡发现每次启动MAC地址都随机的变化，查看了官方文档与网上结论说有些时候网卡MAC会随机变化，但没有说具体原因情况。&lt;/li&gt;
&lt;li&gt;使用DPDK本身提供的接口rte_eth_macaddr_get()进行读取，发现与物理网卡一致而与KNI创建出的虚拟网卡不一致。&lt;/li&gt;
&lt;/ol&gt;

&lt;h3 id=&#34;原因-a-id-sec-1-3-3-name-sec-1-3-3-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;原因&lt;a id=&#34;sec-1-3-3&#34; name=&#34;sec-1-3-3&#34;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;使用虚拟机创建出的KNI虚拟机网卡，每次重启后会随机变化并且与物理网卡不一致，到时ARP学习不正常。&lt;/p&gt;

&lt;h3 id=&#34;解决办法-a-id-sec-1-3-4-name-sec-1-3-4-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;解决办法&lt;a id=&#34;sec-1-3-4&#34; name=&#34;sec-1-3-4&#34;&gt;&lt;/a&gt;&lt;/h3&gt;

&lt;p&gt;在KNI创建虚拟机网卡成功后，使用命令: ifconfig XX hw ether XX:XX:XX:XX:XX:XX 进行配置成物理网卡MAC即可。&lt;/p&gt;

&lt;h2 id=&#34;出现igb-uio-unknown-symbol-uio-unregister-device的解决办法-a-id-sec-1-4-name-sec-1-4-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;出现igb_uio: Unknown symbol uio_unregister_device的解决办法？&lt;a id=&#34;sec-1-4&#34; name=&#34;sec-1-4&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;答：&lt;br /&gt;
   在在dpdk/lib/librte_eal/linuxapp/igb_uio/Makefile中添加如下行：&lt;/p&gt;

&lt;pre&gt;&lt;code&gt;KBUILD_EXTRA_SYMBOLS=/usr/src/linux-headers-`uname -r`/Module.symvers
&lt;/code&gt;&lt;/pre&gt;

&lt;h2 id=&#34;使用vmware-exsi虚拟出来的vmnet3类型网卡不能绑定gib网卡将会系统挂掉的解决办法-a-id-sec-1-5-name-sec-1-5-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;使用vmware EXSI虚拟出来的vmnet3类型网卡不能绑定gib网卡将会系统挂掉的解决办法。&lt;a id=&#34;sec-1-5&#34; name=&#34;sec-1-5&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;答：在vmware中换成E1000类型网卡即可正常。&lt;/p&gt;

&lt;h2 id=&#34;在最小ubuntu-16-04系统下要运行dpdk进程需安装文件列表-a-id-sec-1-6-name-sec-1-6-a:b2e9d0c1dcbde982306f1857e117155c&#34;&gt;在最小Ubuntu 16.04系统下要运行dpdk进程需安装文件列表。&lt;a id=&#34;sec-1-6&#34; name=&#34;sec-1-6&#34;&gt;&lt;/a&gt;&lt;/h2&gt;

&lt;p&gt;答: 只要安装如下软件即可。&lt;br /&gt;
-   apt-get update
-   apt-get install openssh-server
-   apt-get install tcpdump
-   apt install gcc
-   apt install libpcap-dev
-   apt install lrzsz
-   apt install kernel-source
-   apt-get install kernel-source
-   apt-get install linux-headers-`uname -r`
-   apt install python
-   apt-get install make
-   apt install libpcap-dev
-   apt install doxygen
-   apt-get install libdbus-1-dev
-   apt-get install libdbus-glib-1-dev
-   ln -sf dbus-1.0/dbus dbus
-   apt install libssl-dev
-   apt-get install libexpat1-dev
-   apt install flex
-   apt install tree
-   apt install linux-tools-generic&lt;/p&gt;
</description>
        </item>
        
    </channel>
</rss>
