+++
categories = ["技术文章"]
date = "2017-03-02T11:14:08+08:00"
description = ""
keywords = ["openresty", "redis"]
tags = ["openresty", "redis"]
title = "openresty+redis practices"
url = ""
url = "/2017/03/02/openresty+redis-practices/"

+++

* 安装
** openresty安装
   详见 [[https://openresty.org/cn/installation.html][openresty安装]]
** redis安装
   执行如下命令：
   #+BEGIN_SRC sh 
   sudo apt-get update  
   sudo apt-get install redis-server
   #+END_SRC
   详见 [[http://www.jianshu.com/p/c8723b677304][Ubuntu安装配置Redis]]

* 编写API
   根据项目要求编写openresty+lua的API接口。


* 测试
** 发送请求
  使用curl命令发送http json请求:
  
  1. 先写请求json
  #+BEGIN_QUOTE
  root@bj94:~/dr302client# cat set.json
  {

      "www.example.com": {

          "sub_domain": "@",
          "record_type": "CNAME",
          "record_line": "all",
          "record_line_id": "00000000",
          "value": "all.china.qiniu.qnydns.com",
          "mx": 1,
          "ttl": 86400,
          "status": "enable",
          "weight": 100
      }
  }
  #+END_QUOTE
  2. 执行命令：
  #+BEGIN_SRC sh 
  curl -i -H 'content-type: application/json' -X POST -d @set.json http://dev.mgrconfig.api.qiniudns.com/qiniu/dr302/records/set
  #+END_SRC
** 回复响应
   根据不同返回码表示操作结果。
   
