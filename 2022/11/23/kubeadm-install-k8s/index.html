<!DOCTYPE HTML>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <base href="http://mospany.github.io/">
  <title>K8S项目实践(01): kubeadm安装K8S集群 - 墨斯潘園</title>
  <meta name="viewport" content="width=device-width, initial-scale=1, maximum-scale=3, minimum-scale=1">
  <meta name="keywords" content="K8S,云计算,">
  <meta name="description" content="规划 服务配置 OS 配置 用途 CentOS 7.6 (172.25.140.216) 2C4G k8s-master CentOS 7.6 (172.25.140.215) 2C4G k8s-work1 CentOS 7.6 (172.25.140.214) 2C4G k8s-work2 **注**：这是演示 k8s 集群安装的实验环境，配置较低，生产环境中我们的服务器配置至少都是 8C/16G">
  <meta name="author" content="mospan">
  <meta itemprop="name" content="K8S项目实践(01): kubeadm安装K8S集群 - 墨斯潘園">
  <meta itemprop="description" content="规划 服务配置 OS 配置 用途 CentOS 7.6 (172.25.140.216) 2C4G k8s-master CentOS 7.6 (172.25.140.215) 2C4G k8s-work1 CentOS 7.6 (172.25.140.214) 2C4G k8s-work2 **注**：这是演示 k8s 集群安装的实验环境，配置较低，生产环境中我们的服务器配置至少都是 8C/16G">
  <meta itemprop="image" content="http://mospany.github.io/img/author.jpg">
  <meta name="twitter:card" content="summary" />
  <meta name="twitter:site" content="@mospan" />
  <meta name="twitter:title" content="K8S项目实践(01): kubeadm安装K8S集群 - 墨斯潘園" />
  
  <meta name="twitter:description" content="">
  <link rel="shortcut icon" href="img/favicon.ico"/>
  <link rel="apple-touch-icon" href="apple-touch-icon.png" />
  <link rel="apple-touch-icon-precomposed" href="apple-touch-icon.png" />
  <link rel="stylesheet" href="highlight/styles/github.css">
  <script src="highlight/highlight.pack.js"></script>
  <script>hljs.initHighlightingOnLoad();</script>
  <link rel="stylesheet" href="font/hack/css/hack.min.css">
  <link rel="stylesheet" href="css/style.css">
</head>

<body>
  <header>
    <div>
  
  <div id="imglogo">
    <a href="http://mospany.github.io/"><img src="http://mospany.github.io/img/logo.jpg" alt="墨斯潘園" title="墨斯潘園"/></a>
  </div>
  
  <div id="textlogo">
    <h1 class="site-name"><a href="http://mospany.github.io/" title="墨斯潘園">墨斯潘園</a></h1>
    <h2 class="blog-motto">技术改变生活，学习成就未来</h2>
  </div>
  <div class="navbar"><a class="navbutton navmobile" href="#" title="menu"></a></div>
  <nav class="animated">
    <ul>
      
      <li><a href="/">首页</a></li> 
      
      <li><a href="/about">关于</a></li> 
      
      <li>
        <form class="search" method="get" action="https://www.google.com/search">
          <div>
            <input type="text" id="search" name="q" placeholder="搜索">
          </div>
        </form>
      </li>
    </ul>
  </nav>
</div>

  </header>
  <div id="container">
    <div id="main" class="post" itemscope itemprop="blogPost">
	<article itemprop="articleBody">
    <header class="article-info clearfix">
  <h1 itemprop="name">
      <a href="http://mospany.github.io/2022/11/23/kubeadm-install-k8s/" title="K8S项目实践(01): kubeadm安装K8S集群" itemprop="url">K8S项目实践(01): kubeadm安装K8S集群</a>
  </h1>
  <p class="article-author">By 
    
      <a href="http://blog.mospan.cn" title="mospan">mospan</a>
    
  </p>
  <p class="article-time">
    <time datetime="2022-11-22 20:58:52 &#43;0800 CST" itemprop="datePublished">2022年11月22日</time>
  </p>
</header>

	<div class="article-content">
    
    

<p><a id="org4f3c086"></a></p>

<h1 id="规划">规划</h1>

<p><a id="orgfdfecef"></a></p>

<h2 id="服务配置">服务配置</h2>

<table border="2" cellspacing="0" cellpadding="6" rules="groups" frame="hsides">


<colgroup>
<col  class="org-left" />

<col  class="org-left" />

<col  class="org-left" />
</colgroup>
<thead>
<tr>
<th scope="col" class="org-left">OS</th>
<th scope="col" class="org-left">配置</th>
<th scope="col" class="org-left">用途</th>
</tr>
</thead>

<tbody>
<tr>
<td class="org-left">CentOS 7.6 (172.25.140.216)</td>
<td class="org-left">2C4G</td>
<td class="org-left">k8s-master</td>
</tr>


<tr>
<td class="org-left">CentOS 7.6 (172.25.140.215)</td>
<td class="org-left">2C4G</td>
<td class="org-left">k8s-work1</td>
</tr>


<tr>
<td class="org-left">CentOS 7.6 (172.25.140.214)</td>
<td class="org-left">2C4G</td>
<td class="org-left">k8s-work2</td>
</tr>
</tbody>
</table>

<p>**注**：这是演示 k8s 集群安装的实验环境，配置较低，生产环境中我们的服务器配置至少都是 8C/16G 的基础配置。</p>

<p><a id="orgbfb1037"></a></p>

<h2 id="版本选择">版本选择</h2>

<ul>
<li>CentOS：7.6</li>
<li>k8s组件版本：1.23.6</li>
</ul>

<p><a id="orge0cd109"></a></p>

<h1 id="一-服务器基础配置">一、服务器基础配置</h1>

<p><a id="orgfbbc6fc"></a></p>

<h2 id="1-配置主机名">1、 配置主机名</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>[root@iZ8vbfafp7g52u8976flc0Z ~]# hostnamectl set-hostname k8s-master
[root@iZ8vbfafp7g52u8976flc1Z ~]# hostnamectl set-hostname k8s-work1
[root@iZ8vbfafp7g52u8976flc2Z ~]# hostnamectl set-hostname k8s-work2
</code></pre>

<p><a id="orgec07355"></a></p>

<h2 id="2-关闭防火墙">2、关闭防火墙</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>1  # 关闭firewalld
2  [root@k8s-master ~]# systemctl stop firewalld
3  
4  # 关闭selinux
5  [root@k8s-master ~]# sed -i 's/enforcing/disabled/' /etc/selinux/config
6  [root@k8s-master ~]# setenforce 0
7   setenforce: SELinux is disabled
8  [root@k8s-master ~]#
9  
</code></pre>

<p><a id="org1b9a204"></a></p>

<h2 id="3-互做本地解析">3、互做本地解析</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>[root@k8s-master ~]# cat /etc/hosts
172.25.140.216 k8s-master
172.25.140.215 k8s-work1
172.25.140.214 k8s-work2

[root@k8s-master ~]#
</code></pre>

<p><a id="orgf3b9e1a"></a></p>

<h2 id="4-ssh-免密通信-可选">4、SSH 免密通信（可选）</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>[root@k8s-master ~]# ssh-keygen
  Generating public/private rsa key pair.
  Enter file in which to save the key (/root/.ssh/id_rsa):
  Enter passphrase (empty for no passphrase):
  Enter same passphrase again:
  Your identification has been saved in /root/.ssh/id_rsa.
  Your public key has been saved in /root/.ssh/id_rsa.pub.
  The key fingerprint is:
  SHA256:s+JcU9ctsItBgDC+UwxgmFhnsQGpy9SELkEOx4Lmk/0 root@k8s-master
  The key's randomart image is:
  +---[RSA 2048]----+
  |=*B+Oo ..        |
  |X=o= *.  .       |
  |+== o o   . .    |
  |o* o o   .   + . |
  |+.. +   S o o o .|
  |..   E   + + . . |
  |      . + . .    |
  |     o o .       |
  |      o          |
  +----[SHA256]-----+
  [root@k8s-master ~]#
</code></pre>

<blockquote>
<p>所有节点执行（互发公钥）</p>
</blockquote>

<pre><code>[root@k8s-master ~]# ssh-copy-id root@k8s-work1
  /usr/bin/ssh-copy-id: INFO: Source of key(s) to be installed: &quot;/root/.ssh/id_rsa.pub&quot;
  The authenticity of host 'k8s-work1 (172.25.140.215)' can't be established.
  ECDSA key fingerprint is SHA256:BMN7TIKDbFKdG3v1TVHmy3i6BYm7TGS8Hsnu1F9+UkI.
  ECDSA key fingerprint is MD5:71:60:e2:6c:38:e2:20:d8:9c:94:77:54:cb:10:33:32.
  Are you sure you want to continue connecting (yes/no)? yes
  /usr/bin/ssh-copy-id: INFO: attempting to log in with the new key(s), to filter out any that are already installed
  /usr/bin/ssh-copy-id: INFO: 1 key(s) remain to be installed -- if you are prompted now it is to install the new keys
  root@k8s-work1's password:

  Number of key(s) added: 1

  Now try logging into the machine, with:   &quot;ssh 'root@k8s-work1'&quot;
  and check to make sure that only the key(s) you wanted were added.

  [root@k8s-master ~]# ssh-copy-id root@k8s-work2
</code></pre>

<p><a id="org97fcb39"></a></p>

<h2 id="5-加载-br-netfilter-模块">5、加载 br_netfilter 模块</h2>

<blockquote>
<p>确保 br_netfilter 模块被加载<br />
所有节点执行</p>
</blockquote>

<pre><code> 1  # 加载模块
 2  [root@k8s-master ~]# modprobe br_netfilter
 3  ## 查看加载请看
 4  [root@k8s-master ~]# lsmod | grep br_netfilter
 5  br_netfilter           22256  0
 6  bridge                151336  1 br_netfilter
 7  
 8  # 永久生效
 9  [root@k8s-master ~]# cat &lt;&lt;EOF | tee /etc/modules-load.d/k8s.conf
10  &gt; br_netfilter
11  &gt; EOF
12  br_netfilter
13  [root@k8s-master ~]#
14  
</code></pre>

<p><a id="org6cf490e"></a></p>

<h2 id="6-允许-iptables-检查桥接流量">6、允许 iptables 检查桥接流量</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code> 1   [root@k8s-master ~]# cat &lt;&lt;EOF | sudo tee /etc/modules-load.d/k8s.conf
 2   &gt; br_netfilter
 3   &gt; EOF
 4   br_netfilter
 5   [root@k8s-master ~]# cat &lt;&lt;EOF | sudo tee /etc/sysctl.d/k8s.conf
 6   &gt; net.bridge.bridge-nf-call-ip6tables = 1
 7   &gt; net.bridge.bridge-nf-call-iptables = 1
 8   &gt; EOF
 9   net.bridge.bridge-nf-call-ip6tables = 1
10   net.bridge.bridge-nf-call-iptables = 1
11  [root@k8s-master ~]# sudo sysctl --system
12  
</code></pre>

<p><a id="org716427b"></a></p>

<h2 id="7-关闭-swap">7、关闭 swap</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>1  # 临时关闭
2  [root@k8s-master ~]# swapoff -a
3  
4  # 永久关闭
5  [root@k8s-master ~]# sed -ri 's/.*swap.*/#&amp;/' /etc/fstab
6  
</code></pre>

<p><a id="orga15d3fb"></a></p>

<h2 id="8-时间同步">8、时间同步</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<pre><code>1  # 同步网络时间
2  [root@k8s-master ~]# ntpdate time.nist.gov
3  23 Nov 22:36:07 ntpdate[12307]: adjust time server 132.163.96.6 offset -0.009024 sec
4  
5  [root@k8s-master ~]#
6  # 将网络时间写入硬件时间
7  [root@k8s-master ~]# hwclock --systohc
8  
</code></pre>

<p><a id="org7ff8672"></a></p>

<h2 id="9-安装-docker">9、安装 Docker</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<p>1、使用 sudo 或 root 权限登录 Centos。</p>

<p>2、确保 yum 包更新到最新。</p>

<pre><code>sudo yum update
</code></pre>

<p>3、执行 Docker 安装脚本。</p>

<pre><code>curl -fsSL https://get.docker.com/ | sh 
</code></pre>

<p>执行这个脚本会添加 docker.repo 源并安装 Docker。</p>

<p>4、启动 Docker 进程。</p>

<pre><code>$ sudo service docker start
</code></pre>

<p>5、验证 docker 是否安装成功并在容器中执行一个测试的镜像。</p>

<pre><code>sudo docker run hello-world

[root@k8s-master ~]# sudo docker run hello-world

  Hello from Docker!
  This message shows that your installation appears to be working correctly.
</code></pre>

<p>到此，docker 在 CentOS 系统的安装完成。</p>

<p><a id="orge392402"></a></p>

<h2 id="10-安装-kubeadm-kubelet">10、安装 kubeadm、kubelet</h2>

<blockquote>
<p>所有节点执行</p>
</blockquote>

<p>1、添加 k8s 镜像源</p>

<blockquote>
<p>地址：<a href="https://developer.aliyun.com/mirror/kubernetes?spm=a2c6h.13651102.0.0.1cd01b116JYQIn">https://developer.aliyun.com/mirror/kubernetes?spm=a2c6h.13651102.0.0.1cd01b116JYQIn</a></p>
</blockquote>

<pre><code> 1  [root@k8s-master ~]# cat &lt;&lt;EOF &gt; /etc/yum.repos.d/kubernetes.repo
 2  &gt; [kubernetes]
 3  &gt; name=Kubernetes
 4  &gt; baseurl=https://mirrors.aliyun.com/kubernetes/yum/repos/kubernetes-el7-x86_64/
 5  &gt; enabled=1
 6  &gt; gpgcheck=0
 7  &gt; repo_gpgcheck=0
 8  &gt; gpgkey=https://mirrors.aliyun.com/kubernetes/yum/doc/yum-key.gpg https://mirrors.aliyun.com/kubernetes/yum/doc/rpm-package-key.gpg
 9  &gt; EOF
10  [root@k8s-master ~]#
11  
</code></pre>

<p>2、建立 k8s YUM 缓存</p>

<pre><code> 1  [root@k8s-master ~]# yum makecache
 2  已加载插件：fastestmirror
 3  Loading mirror speeds from cached hostfile
 4  base                                                                                                                                                                                 | 3.6 kB  00:00:00
 5  docker-ce-stable                                                                                                                                                                     | 3.5 kB  00:00:00
 6  epel                                                                                                                                                                                 | 4.7 kB  00:00:00
 7  extras                                                                                                                                                                               | 2.9 kB  00:00:00
 8  updates                                                                                                                                                                              | 2.9 kB  00:00:00
 9  元数据缓存已建立
10  [root@k8s-master ~]#
11  
</code></pre>

<p>3、安装 k8s 相关工具</p>

<pre><code> 1   # 查看可安装版本
 2   [root@k8s-master ~]# yum list kubelet --showduplicates
 3  
 4   ...
 5   ...
 6   kubelet.x86_64                                           1.23.0-0                                             kubernetes
 7   kubelet.x86_64                                           1.23.1-0                                             kubernetes
 8   kubelet.x86_64                                           1.23.2-0                                             kubernetes
 9   kubelet.x86_64                                           1.23.3-0                                             kubernetes
10   kubelet.x86_64                                           1.23.4-0                                             kubernetes
11   kubelet.x86_64                                           1.23.5-0                                             kubernetes
12   kubelet.x86_64                                           1.23.6-0                                             kubernetes
13  
14   # 开始安装（指定你要安装的版本）
15   [root@k8s-master ~]# yum install -y kubelet-1.23.6 kubeadm-1.23.6 kubectl-1.23.6
16  
17  # 设置开机自启动并启动kubelet（kubelet由systemd管理）
18  [root@k8s-master ~]# systemctl enable kubelet &amp;&amp; systemctl start kubelet
19  
</code></pre>

<p><a id="org02e7601"></a></p>

<h1 id="二-master-节点">二、Master 节点</h1>

<p><a id="org88d2a45"></a></p>

<h2 id="1-k8s-初始化">1、k8s 初始化</h2>

<blockquote>
<p>Master 节点执行</p>
</blockquote>

<pre><code>1   [root@k8s-master ~]# kubeadm init \
2  --apiserver-advertise-address=172.25.140.216 \
3  --image-repository registry.aliyuncs.com/google_containers \
4  --kubernetes-version v1.23.6 \
5  --service-cidr=10.96.0.0/12 \
6  --pod-network-cidr=10.244.0.0/16 \
7  --ignore-preflight-errors=all
8  
</code></pre>

<p>参数说明：</p>

<pre><code>1  --apiserver-advertise-address  # 集群master地址
2  --image-repository             # 指定k8s镜像仓库地址
3  --kubernetes-version           # 指定K8s版本（与kubeadm、kubelet版本保持一致）
4  --service-cidr                 # Pod统一访问入口
5  --pod-network-cidr             # Pod网络（与CNI网络保持一致）
6  
</code></pre>

<p>初始化后输出内容：</p>

<pre><code> 1  ...
 2  ...
 3  [addons] Applied essential addon: CoreDNS
 4  [addons] Applied essential addon: kube-proxy
 5  
 6  Your Kubernetes control-plane has initialized successfully!
 7  
 8  To start using your cluster, you need to run the following as a regular user:
 9  
10     mkdir -p $HOME/.kube
11     sudo cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
12     sudo chown $(id -u):$(id -g) $HOME/.kube/config
13  
14    Alternatively, if you are the root user, you can run:
15  
16    export KUBECONFIG=/etc/kubernetes/admin.conf
17  
18  You should now deploy a pod network to the cluster.
19  Run &quot;kubectl apply -f [podnetwork].yaml&quot; with one of the options listed at:
20  https://kubernetes.io/docs/concepts/cluster-administration/addons/
21  
22  Then you can join any number of worker nodes by running the following on each as root:
23  
24  kubeadm join 172.25.140.216:6443 --token 8d9mk7.08nyz6xc2d5boiy8 \
25      --discovery-token-ca-cert-hash sha256:45542b0b380a8f959e5bc93f6dd7d1c5c78b202ff1a3eea5c97804549af9a12e
26  
</code></pre>

<p><a id="org0b51700"></a></p>

<h2 id="2-根据输出提示创建相关文件">2、根据输出提示创建相关文件</h2>

<blockquote>
<p>Master 节点执行</p>
</blockquote>

<pre><code>1  [root@k8s-master ~]# mkdir -p $HOME/.kube
2  [root@k8s-master ~]# cp -i /etc/kubernetes/admin.conf $HOME/.kube/config
3  [root@k8s-master ~]# chown $(id -u):$(id -g) $HOME/.kube/config
4  [root@k8s-master ~]#
5  
</code></pre>

<p><a id="org5a02bac"></a></p>

<h2 id="3-查看-k8s-运行的容器">3、查看 k8s 运行的容器</h2>

<blockquote>
<p>Master 节点执行</p>
</blockquote>

<pre><code> 1  root@k8s-master ~]# kubectl get pods -n kube-system -o wide
 2  NAME                                 READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES
 3  coredns-6d8c4cb4d-ck2x5              0/1     Pending   0          8m4s    &lt;none&gt;           &lt;none&gt;       &lt;none&gt;           &lt;none&gt;
 4  coredns-6d8c4cb4d-mbctj              0/1     Pending   0          8m4s    &lt;none&gt;           &lt;none&gt;       &lt;none&gt;           &lt;none&gt;
 5  etcd-k8s-master                      1/1     Running   0          8m18s   172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 6  kube-apiserver-k8s-master            1/1     Running   0          8m18s   172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 7  kube-controller-manager-k8s-master   1/1     Running   0          8m18s   172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 8  kube-proxy-r84lg                     1/1     Running   0          8m4s    172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 9  kube-scheduler-k8s-master            1/1     Running   0          8m18s   172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
10  [root@k8s-master ~]#
11  
</code></pre>

<p><a id="org2688836"></a></p>

<h2 id="4-查看-k8s-节点">4、查看 k8s 节点</h2>

<blockquote>
<p>Master 节点执行</p>
</blockquote>

<pre><code>1  [root@k8s-master ~]# kubectl  get node -o wide
2  NAME         STATUS     ROLES                  AGE   VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
3  k8s-master   NotReady   control-plane,master   11m   v1.23.6   172.25.140.216   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.21.3.el7.x86_64   docker://20.10.21
4  [root@k8s-master ~]#
5  
</code></pre>

<p>可看到当前只有 k8s-master 节点，而且状态是 NotReady（未就绪），因为我们还没有部署网络插件（kubectl apply -f [podnetwork].yaml），于是接着部署容器网络（CNI）。</p>

<p><a id="orge6d35ae"></a></p>

<h2 id="5-容器网络-cni-部署">5、容器网络（CNI）部署</h2>

<blockquote>
<p>Master 节点执行<br />
插件地址：<a href="https://kubernetes.io/docs/concepts/cluster-administration/addons/">https://kubernetes.io/docs/concepts/cluster-administration/addons/</a><br />
该地址在 k8s-master 初始化成功时打印出来。</p>
</blockquote>

<p>1、选择一个主流的容器网络插件部署（Calico）<br />
   <img src="http://blog.mospan.cn/post/img/k8s/kubeadm-install-k8s/calico-install-page.png" alt="img" /></p>

<p>2、下载yml文件</p>

<pre><code>[root@k8s-master kubeadm-install-k8s]# wget https://docs.projectcalico.org/manifests/calico.yaml --no-check-certificate
</code></pre>

<p>3、根据初始化的输出提示执行启动指令</p>

<pre><code> 1  [root@k8s-master kubeadm-install-k8s]# kubectl apply -f calico.yaml
 2  poddisruptionbudget.policy/calico-kube-controllers created
 3  serviceaccount/calico-kube-controllers created
 4  serviceaccount/calico-node created
 5  configmap/calico-config created
 6  customresourcedefinition.apiextensions.k8s.io/bgpconfigurations.crd.projectcalico.org created
 7  customresourcedefinition.apiextensions.k8s.io/bgppeers.crd.projectcalico.org created
 8  customresourcedefinition.apiextensions.k8s.io/blockaffinities.crd.projectcalico.org created
 9  customresourcedefinition.apiextensions.k8s.io/caliconodestatuses.crd.projectcalico.org created
10  customresourcedefinition.apiextensions.k8s.io/clusterinformations.crd.projectcalico.org created
11  customresourcedefinition.apiextensions.k8s.io/felixconfigurations.crd.projectcalico.org created
12  customresourcedefinition.apiextensions.k8s.io/globalnetworkpolicies.crd.projectcalico.org created
13  customresourcedefinition.apiextensions.k8s.io/globalnetworksets.crd.projectcalico.org created
14  customresourcedefinition.apiextensions.k8s.io/hostendpoints.crd.projectcalico.org created
15  customresourcedefinition.apiextensions.k8s.io/ipamblocks.crd.projectcalico.org created
16  customresourcedefinition.apiextensions.k8s.io/ipamconfigs.crd.projectcalico.org created
17  customresourcedefinition.apiextensions.k8s.io/ipamhandles.crd.projectcalico.org created
18  customresourcedefinition.apiextensions.k8s.io/ippools.crd.projectcalico.org created
19  customresourcedefinition.apiextensions.k8s.io/ipreservations.crd.projectcalico.org created
20  customresourcedefinition.apiextensions.k8s.io/kubecontrollersconfigurations.crd.projectcalico.org created
21  customresourcedefinition.apiextensions.k8s.io/networkpolicies.crd.projectcalico.org created
22  customresourcedefinition.apiextensions.k8s.io/networksets.crd.projectcalico.org created
23  clusterrole.rbac.authorization.k8s.io/calico-kube-controllers created
24  clusterrole.rbac.authorization.k8s.io/calico-node created
25  clusterrolebinding.rbac.authorization.k8s.io/calico-kube-controllers created
26  clusterrolebinding.rbac.authorization.k8s.io/calico-node created
27  daemonset.apps/calico-node created
28  deployment.apps/calico-kube-controllers created
29  [root@k8s-master kubeadm-install-k8s]# 
30  
</code></pre>

<p>4、看看该yaml文件所需要启动的容器</p>

<pre><code> 1   [root@k8s-master kubeadm-install-k8s]# cat calico.yaml |grep image
 2         image: docker.io/calico/cni:v3.24.5
 3         imagePullPolicy: IfNotPresent
 4         image: docker.io/calico/cni:v3.24.5
 5         imagePullPolicy: IfNotPresent
 6         image: docker.io/calico/node:v3.24.5
 7         imagePullPolicy: IfNotPresent
 8         image: docker.io/calico/node:v3.24.5
 9         imagePullPolicy: IfNotPresent
10         image: docker.io/calico/kube-controllers:v3.24.5
11         imagePullPolicy: IfNotPresent
12  [root@k8s-master kubeadm-install-k8s]   #
13  
</code></pre>

<p>5、查看容器是否都 Running</p>

<pre><code> 1  [root@k8s-master kubeadm-install-k8s]# kubectl get pods -n kube-system -o wide
 2  NAME                                       READY   STATUS    RESTARTS   AGE     IP               NODE         NOMINATED NODE   READINESS GATES
 3  calico-kube-controllers-7b8458594b-pdx5z   1/1     Running   0          4m37s   10.244.235.194   k8s-master   &lt;none&gt;           &lt;none&gt;
 4  calico-node-t8hhf                          1/1     Running   0          4m37s   172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 5  coredns-6d8c4cb4d-ck2x5                    1/1     Running   0          32m     10.244.235.195   k8s-master   &lt;none&gt;           &lt;none&gt;
 6  coredns-6d8c4cb4d-mbctj                    1/1     Running   0          32m     10.244.235.193   k8s-master   &lt;none&gt;           &lt;none&gt;
 7  etcd-k8s-master                            1/1     Running   0          32m     172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 8  kube-apiserver-k8s-master                  1/1     Running   0          32m     172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
 9  kube-controller-manager-k8s-master         1/1     Running   0          32m     172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
10  kube-proxy-r84lg                           1/1     Running   0          32m     172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
11  kube-scheduler-k8s-master                  1/1     Running   0          32m     172.25.140.216   k8s-master   &lt;none&gt;           &lt;none&gt;
12  [root@k8s-master kubeadm-install-k8s]#
13  
</code></pre>

<p><a id="org4f4a98b"></a></p>

<h1 id="三-work-节点">三、work 节点</h1>

<p><a id="orgfc01846"></a></p>

<h2 id="1-work-节点加入-k8s-集群">1、work 节点加入 k8s 集群</h2>

<blockquote>
<p>所有 work 节点执行</p>
</blockquote>

<pre><code> 1  # 复制k8s-master初始化屏幕输出的语句并在work节点执行
 2  [root@k8s-work1 ~]# kubeadm join 172.25.140.216:6443 --token 8d9mk7.08nyz6xc2d5boiy8 --discovery-token-ca-cert-hash sha256:45542b0b380a8f959e5bc93f6dd7d1c5c78b202ff1a3eea5c97804549af9a12e
 3  [root@k8s-work2 ~]# kubeadm join 172.25.140.216:6443 --token 8d9mk7.08nyz6xc2d5boiy8 --discovery-token-ca-cert-hash sha256:45542b0b380a8f959e5bc93f6dd7d1c5c78b202ff1a3eea5c97804549af9a12e
 4  
 5  preflight] Running pre-flight checks
 6  [preflight] Reading configuration from the cluster...
 7  [preflight] FYI: You can look at this config file with 'kubectl -n kube-system get cm kubeadm-config -o yaml'
 8  [kubelet-start] Writing kubelet configuration to file &quot;/var/lib/kubelet/config.yaml&quot;
 9  [kubelet-start] Writing kubelet environment file with flags to file &quot;/var/lib/kubelet/kubeadm-flags.env&quot;
10  [kubelet-start] Starting the kubelet
11  [kubelet-start] Waiting for the kubelet to perform the TLS Bootstrap...
12  
13  This node has joined the cluster:
14  * Certificate signing request was sent to apiserver and a response was received.
15  * The Kubelet was informed of the new secure connection details.
16  
17  Run 'kubectl get nodes' on the control-plane to see this node join the cluster.
18  
19  [root@k8s-work2 ~]#
20  
</code></pre>

<p><a id="org362c07d"></a></p>

<h2 id="2-查询集群节点">2、查询集群节点</h2>

<blockquote>
<p>Master 节点执行</p>
</blockquote>

<pre><code>1  [root@k8s-master kubeadm-install-k8s]# kubectl  get node -o wide
2  NAME         STATUS   ROLES                  AGE     VERSION   INTERNAL-IP      EXTERNAL-IP   OS-IMAGE                KERNEL-VERSION               CONTAINER-RUNTIME
3  k8s-master   Ready    control-plane,master   50m     v1.23.6   172.25.140.216   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.21.3.el7.x86_64   docker://20.10.21
4  k8s-work1    Ready    &lt;none&gt;                 9m50s   v1.23.6   172.25.140.215   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.21.3.el7.x86_64   docker://20.10.21
5  k8s-work2    Ready    &lt;none&gt;                 2m41s   v1.23.6   172.25.140.214   &lt;none&gt;        CentOS Linux 7 (Core)   3.10.0-957.21.3.el7.x86_64   docker://20.10.21
6  [root@k8s-master kubeadm-install-k8s]#
7  
</code></pre>

<p>都为就绪状态了</p>

<p><a id="orge747a84"></a></p>

<h2 id="四-验证">四、验证</h2>

<p>k8s 集群部署 nginx 服务，并通过浏览器进行访问验证。</p>

<p><a id="org5ec8220"></a></p>

<h2 id="1-创建-pod">1、创建 pod</h2>

<pre><code> 1  [root@k8s-master kubeadm-install-k8s]# kubectl create deployment nginx --image=nginx
 2  deployment.apps/nginx created
 3  [root@k8s-master kubeadm-install-k8s]# kubectl expose deployment nginx --port=80 --type=NodePort
 4  service/nginx exposed
 5  [root@k8s-master kubeadm-install-k8s]# kubectl get pod,svc
 6  NAME                         READY   STATUS    RESTARTS   AGE
 7  pod/nginx-85b98978db-qkd6h   1/1     Running   0          36s
 8  
 9  NAME                 TYPE        CLUSTER-IP      EXTERNAL-IP   PORT(S)        AGE
10  service/kubernetes   ClusterIP   10.96.0.1       &lt;none&gt;        443/TCP        54m
11  service/nginx        NodePort    10.108.180.91   &lt;none&gt;        80:31648/TCP   15s
12  [root@k8s-master kubeadm-install-k8s]#
13  
</code></pre>

<p><a id="orgd537fac"></a></p>

<h2 id="2-访问-nginx">2、访问 Nginx</h2>

<pre><code> 1  [root@k8s-master kubeadm-install-k8s]# curl 10.108.180.91:80
 2  &lt;!DOCTYPE html&gt;
 3  &lt;html&gt;
 4  &lt;head&gt;
 5  &lt;title&gt;Welcome to nginx!&lt;/title&gt;
 6  &lt;style&gt;
 7  html { color-scheme: light dark; }
 8  body { width: 35em; margin: 0 auto;
 9  font-family: Tahoma, Verdana, Arial, sans-serif; }
10  &lt;/style&gt;
11  &lt;/head&gt;
12  &lt;body&gt;
13  &lt;h1&gt;Welcome to nginx!&lt;/h1&gt;
14  &lt;p&gt;If you see this page, the nginx web server is successfully installed and
15  working. Further configuration is required.&lt;/p&gt;
16  
17  &lt;p&gt;For online documentation and support please refer to
18  &lt;a href=&quot;http://nginx.org/&quot;&gt;nginx.org&lt;/a&gt;.&lt;br/&gt;
19  Commercial support is available at
20  &lt;a href=&quot;http://nginx.com/&quot;&gt;nginx.com&lt;/a&gt;.&lt;/p&gt;
21  
22  &lt;p&gt;&lt;em&gt;Thank you for using nginx.&lt;/em&gt;&lt;/p&gt;
23  &lt;/body&gt;
24  &lt;/html&gt;
25  [root@k8s-master kubeadm-install-k8s]#
26  
</code></pre>

<p>至此：kubeadm方式的k8s集群已经部署完成。</p>

<p><a id="orga6cfda4"></a></p>

<h1 id="faq">FAQ</h1>

<p><a id="org4405cb7"></a></p>

<h2 id="1-k8s编译报错">1、k8s编译报错</h2>

<pre><code> 1  ...
 2  ...
 3  [kubelet-check] It seems like the kubelet isn't running or healthy.
 4  [kubelet-check] The HTTP call equal to 'curl -sSL http://localhost:10248/healthz' failed with error: Get &quot;http://localhost:10248/healthz&quot;: dial tcp [::1]:10248: connect: connection refused.
 5  
 6   Unfortunately, an error has occurred:
 7       timed out waiting for the condition
 8  
 9   This error is likely caused by:
10       - The kubelet is not running
11       - The kubelet is unhealthy due to a misconfiguration of the node in some way (required cgroups disabled)
12  
13   If you are on a systemd-powered system, you can try to troubleshoot the error with the following commands:
14       - 'systemctl status kubelet'
15       - 'journalctl -xeu kubelet'
16  
17   Additionally, a control plane component may have crashed or exited when started by the container runtime.
18   To troubleshoot, list all containers using your preferred container runtimes CLI.
19  
20   Here is one example how you may list all Kubernetes containers running in docker:
21       - 'docker ps -a | grep kube | grep -v pause'
22       Once you have found the failing container, you can inspect its logs with:
23       - 'docker logs CONTAINERID'
24  
25  error execution phase wait-control-plane: couldn't initialize a Kubernetes cluster
26  To see the stack trace of this error execute with --v=5 or higher
27  
28  
</code></pre>

<p>查看日志</p>

<pre><code>    Apr 26 20:33:30 test3 kubelet: I0426 20:33:30.588349   21936 docker_service.go:264] &quot;Docker Info&quot; dockerInfo=&amp;{ID:2NSH:KJPQ:XOKI:5XHN:ULL3:L4LG:SXA4:PR6J:DITW:HHCF:2RKL:U2NJ Containers:0 ContainersRunning:0 ContainersPaused:0 ContainersStopped:0 Images:7 Driver:overlay2 DriverStatus:[[Backing Filesystem extfs] [Supports d_type true] [Native Overlay Diff true]] SystemStatus:[] Plugins:{Volume:[local] Network:[bridge host macvlan null overlay] Authorization:[] Log:[awslogs fluentd gcplogs gelf journald json-file logentries splunk syslog]} MemoryLimit:true SwapLimit:true KernelMemory:true KernelMemoryTCP:false CPUCfsPeriod:true CPUCfsQuota:true CPUShares:true CPUSet:true PidsLimit:false IPv4Forwarding:true BridgeNfIptables:true BridgeNfIP6tables:true Debug:false NFd:24 OomKillDisable:true NGoroutines:45 SystemTime:2022-04-26T20:33:30.583063427+08:00 LoggingDriver:json-file CgroupDriver:cgroupfs CgroupVersion: NEventsListener:0 KernelVersion:3.10.0-1160.59.1.el7.x86_64 OperatingSystem:CentOS Linux 7 (Core) OSVersion: OSType:linux Architecture:x86_64 IndexServerAddress:https://index.docker.io/v1/ RegistryConfig:0xc000263340 NCPU:2 MemTotal:3873665024 GenericResources:[] DockerRootDir:/var/lib/docker HTTPProxy: HTTPSProxy: NoProxy: Name:k8s-master Labels:[] ExperimentalBuild:false ServerVersion:18.06.3-ce ClusterStore: ClusterAdvertise: Runtimes:map[runc:{Path:docker-runc Args:[] Shim:&lt;nil&gt;}] DefaultRuntime:runc Swarm:{NodeID: NodeAddr: LocalNodeState:inactive ControlAvailable:false Error: RemoteManagers:[] Nodes:0 Managers:0 Cluster:&lt;nil&gt; Warnings:[]} LiveRestoreEnabled:false Isolation: InitBinary:docker-init ContainerdCommit:{ID:468a545b9edcd5932818eb9de8e72413e616e86e Expected:468a545b9edcd5932818eb9de8e72413e616e86e} RuncCommit:{ID:a592beb5bc4c4092b1b1bac971afed27687340c5 Expected:a592beb5bc4c4092b1b1bac971afed27687340c5} InitCommit:{ID:fec3683 Expected:fec3683} SecurityOptions:[name=seccomp,profile=default] ProductLicense: DefaultAddressPools:[] Warnings:[]}
Apr 26 20:33:30 test3 kubelet: E0426 20:33:30.588383   21936 server.go:302] &quot;Failed to run kubelet&quot; err=&quot;failed to run Kubelet: misconfiguration: kubelet cgroup driver: \&quot;systemd\&quot; is different from docker cgroup driver: \&quot;cgroupfs\&quot;&quot;
</code></pre>

<p>看报错的最后解释kubelet cgroup driver: \&ldquo;systemd\&rdquo; is different from docker cgroup driver: \&ldquo;cgroupfs\&rdquo;&ldquo;很明显 kubelet 与 Docker 的 cgroup 驱动程序不同，kubelet 为 systemd，而 Docker 为 cgroupfs。</p>

<p>简单查看一下docker驱动：<br />
[root@k8s-master opt]# docker info |grep Cgroup<br />
Cgroup Driver: cgroupfs</p>

<p>解决方案</p>

<pre><code># 重置初始化
[root@k8s-master ~]# kubeadm reset

# 删除相关配置文件
[root@k8s-master ~]# rm -rf $HOME/.kube/config  &amp;&amp; rm -rf $HOME/.kube

# 修改 Docker 驱动为 systemd（即&quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]）
[root@k8s-master opt]# cat /etc/docker/daemon.json 
{
  &quot;registry-mirrors&quot;: [&quot;https://q1rw9tzz.mirror.aliyuncs.com&quot;],
  &quot;exec-opts&quot;: [&quot;native.cgroupdriver=systemd&quot;]
}

# 重启 Docker
[root@k8s-master opt]# systemctl daemon-reload 
[root@k8s-master opt]# systemctl restart docker.service

# 再次初始化k8s即可
[root@k8s-master ~]# kubeadm init ...
</code></pre>

<p><a id="org0b33cbe"></a></p>

<h2 id="2-work-节点加入-k8s-集群报错">2、work 节点加入 k8s 集群报错</h2>

<p>报错1：</p>

<pre><code>1  accepts at most 1 arg(s), received 3
2  To see the stack trace of this error execute with --v=5 or higher
3  
</code></pre>

<p>原因：命令不对，我是直接复制粘贴 k8s-master 初始化的终端输出结果，导致报错，所以最好先复制到 txt 文本下修改好格式再粘贴执行。</p>

<p>报错2：</p>

<pre><code>1  ...
2  [kubelet-check] The HTTP call equal to 'curl -sSL http://localhost:10248/healthz' failed with error: Get &quot;http://localhost:10248/healthz&quot;: dial tcp 127.0.0.1:10248: connect: connection refused.
3  
</code></pre>

<p>解决方法同Master</p>

<p><a id="org9d65a10"></a></p>

<h1 id="参考">参考</h1>

<p>[01]<a href="https://blog.csdn.net/IT_ZRS/article/details/124466870">kubeadm 部署 k8s 集群</a><br />
[02]<a href="https://blog.csdn.net/oscarun/article/details/125595521?spm=1001.2014.3001.5502">kubeadm系列-00-overview</a></p>

    <div style="border: 1px dashed #e0e0e0; padding: 10px 10px 10px 10px; background-color: #fffeee; background-repeat: no-repeat; background-attachment: scroll; background-position: 1% 50%; -moz-background-size: auto auto; -moz-background-clip: -moz-initial; -moz-background-origin: -moz-initial; -moz-background-inline-policy: -moz-initial;">
  <div style="float:right;margin-top:0px;">
    <img src="/img/qrcode.jpg" width="129px" height="129px"/>
    <div style="text-align:center;">微信扫一扫</div>
  </div>
  <div style="float:left;margin-top:0px;">
    <img src="/img/rewardcode.jpg" width="129px" height="129px"/>
  </div>
  <div>
    <p style="margin-top:0px;">作者：<a target="_blank" href="http://blog.mospan.cn/">mospan</a>
      <br />微信关注：墨斯潘園
      <br />本文出处：<a target="_blank" href="http://mospany.github.io/2022/11/23/kubeadm-install-k8s/">http://mospany.github.io/2022/11/23/kubeadm-install-k8s/</a>
      <br />
      文章版权归本人所有，欢迎转载，但未经作者同意必须保留此段声明，且在文章页面明显位置给出原文连接，否则保留追究法律责任的权利。</p>
  </div>
</div>


	</div>
  <footer class="article-footer clearfix">
  

<div class="article-tags">
  <span></span>
  
  <a href="/tags/k8s">K8S</a>
  
  <a href="/tags/%E4%BA%91%E8%AE%A1%E7%AE%97">云计算</a>
  
</div>



<div class="article-categories">
  <span></span>
  
  <a class="article-category-link" href="/categories/k8s">K8S</a>
  
  <a class="article-category-link" href="/categories/%E4%BA%91%E8%AE%A1%E7%AE%97">云计算</a>
  
</div>



  <div class="article-share" id="share">
    <div data-url="http://mospany.github.io/2022/11/23/kubeadm-install-k8s/" data-title="K8S项目实践(01): kubeadm安装K8S集群" data-tsina="3833537679" class="share clearfix">
    </div>
  </div>
</footer>

	</article>
  





<div id="git-comments"></div>
<link rel="stylesheet" href="https://billts.site/extra_css/gitment.css">
<script src="https://billts.site/js/gitment.js"></script>
<script>
var gitment = new Gitment({
  id: '<%= page.date %>',
  owner: 'mospany',
  repo: 'mospan-hugo-blog-gitment',
  oauth: {
    client_id: '0cafe299c964f0af2d1e',
    client_secret: 'ec47ee9481210935a662298791c31da203694a8f',
  },
})
gitment.render('git-comments')
</script>    


</div>

    <div class="openaside"><a class="navbutton" href="#" title="显示侧边栏"></a></div>
<div id="asidepart">
<div class="closeaside"><a class="closebutton" href="#" title="隐藏侧边栏"></a></div>
<aside class="clearfix">
  

<div class="categorieslist">
  <p class="asidetitle">分类</p>
  <ul>
    
    <li><a href="http://mospany.github.io/categories/%e5%b7%a5%e5%85%b7%e4%bd%bf%e7%94%a8" title="工具使用">工具使用<sup>3</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" title="技术文章">技术文章<sup>39</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" title="生活记录">生活记录<sup>1</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" title="职场人生">职场人生<sup>1</sup></a></li>
    
    <li><a href="http://mospany.github.io/categories/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" title="读书笔记">读书笔记<sup>2</sup></a></li>
    
  </ul>
</div>



  

<div class="tagslist">
	<p class="asidetitle">标签</p>
		<ul class="clearfix">
      
			<li><a href="http://mospany.github.io/tags/" title=""><sup>4</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/dns" title="dns">dns<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/dpdk" title="dpdk">dpdk<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/emacs" title="emacs">emacs<sup>5</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/hugo" title="hugo">hugo<sup>3</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/ipv6" title="ipv6">ipv6<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/k8s" title="k8s">k8s<sup>12</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/openresty" title="openresty">openresty<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/org-mode" title="org-mode">org-mode<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/pango" title="pango">pango<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/redis" title="redis">redis<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/spacemacs" title="spacemacs">spacemacs<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/vim" title="vim">vim<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/vue" title="vue">vue<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/xns" title="xns">xns<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/yaml" title="yaml">yaml<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e4%ba%91%e8%ae%a1%e7%ae%97" title="云计算">云计算<sup>5</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e4%ba%92%e8%81%94%e7%bd%91" title="互联网">互联网<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%89%8d%e7%ab%af" title="前端">前端<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%8d%9a%e5%ae%a2" title="博客">博客<sup>7</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%b7%a5%e5%85%b7" title="工具">工具<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e5%be%ae%e4%bf%a1" title="微信">微信<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" title="技术文章">技术文章<sup>2</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e6%9e%b6%e6%9e%84" title="架构">架构<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e7%8b%ac%e7%ab%8b" title="独立">独立<sup>3</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" title="生活记录">生活记录<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" title="职场人生">职场人生<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" title="读书笔记">读书笔记<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%82%ae%e7%ae%b1" title="邮箱">邮箱<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%9d%a2%e8%af%95" title="面试">面试<sup>1</sup></a></li>
      
			<li><a href="http://mospany.github.io/tags/%e9%a1%b9%e7%9b%ae%e5%ae%9e%e8%b7%b5" title="项目实践">项目实践<sup>3</sup></a></li>
      
		</ul>
</div>



    <div class="linkslist">
  <p class="asidetitle">我的关注</p>
    <ul>
          <li>
            	<a href="http://www.csdn.net/" target="_blank" title="中国软件开发网(CSDN)">中国软件开发网(CSDN)</a>
          </li>
          <li>
            	<a href="http://www.golangtc.com/" target="_blank" title="Golang中国">Golang中国</a>
          </li>
          <li>
            	<a href="http://blog.qiniu.com/" target="_blank" title="七牛团队博客">七牛团队博客</a>
          </li>
          <li>
            	<a href="http://csrd.aliapp.com/" target="_blank" title="阿里核心系统团队博客">阿里核心系统团队博客</a>
          </li>
          <li>
            	<a href="http://coolshell.cn/" target="_blank" title="酷壳－陈浩">酷壳－陈浩</a>
          </li>
          <li>
            	<a href="http://www.ruanyifeng.com/blog/" target="_blank" title="阮一峰的网络日志">阮一峰的网络日志</a>
          </li>
          <li>
            	<a href="https://blog.dandyweng.com/" target="_blank" title="homeschooler－翁天信的博客">homeschooler－翁天信的博客</a>
          </li>
          <li>
            	<a href="http://www.jeffjade.com/" target="_blank" title="晚晴幽草轩">晚晴幽草轩</a>
          </li>
          <li>
            	<a href="https://nicejade.github.io/index.html" target="_blank" title="天意人间舫">天意人间舫</a>
          </li>
    </ul>
</div>

    <div class="linkslist">
  <p class="asidetitle">在线书籍</p>
    <ul>
          <li>
            	<a href="https://docs.ruanjiadeng.com/gopl-zh/index.html" target="_blank" title="Go语言圣经（中文版）">Go语言圣经（中文版）</a>
          </li>
          <li>
            	<a href="http://studygolang.com/pkgdoc" target="_blank" title="Go语言标准库">Go语言标准库</a>
          </li>
          <li>
            	<a href="http://www.w3school.com.cn/" target="_blank" title="w3school 在线教程">w3school 在线教程</a>
          </li>
    </ul>
</div>

    <div class="linkslist">
  <p class="asidetitle">友情链接</p>
    <ul>
          <li>
            	<a href="http://www.cloudxns.net/" target="_blank" title="CloudXNS官网">CloudXNS官网</a>
          </li>
          <li>
            	<a href="http://www.chinatesters.com/" target="_blank" title="华夏评测师家园">华夏评测师家园</a>
          </li>
    </ul>
</div>

  
  <div class="archiveslist">
    <p class="asidetitle">归档</p>
    <ul class="archive-list">
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-12">2022年12月</a><span class="archive-list-count">11</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-11">2022年11月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-10">2022年10月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2022-09">2022年09月</a><span class="archive-list-count">7</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-11">2019年11月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-10">2019年10月</a><span class="archive-list-count">8</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-08">2019年08月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2019-02">2019年02月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2018-02">2018年02月</a><span class="archive-list-count">3</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-08">2017年08月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-07">2017年07月</a><span class="archive-list-count">1</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2017-03">2017年03月</a><span class="archive-list-count">8</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-09">2016年09月</a><span class="archive-list-count">2</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-05">2016年05月</a><span class="archive-list-count">4</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-03">2016年03月</a><span class="archive-list-count">5</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-02">2016年02月</a><span class="archive-list-count">11</span>
      </li>
      
      
      <li class="archive-list-item">
        <a class="archive-list-link" href="http://mospany.github.io/post/#2016-01">2016年01月</a><span class="archive-list-count">6</span>
      </li>
      
    </ul>

  </div>


  

<div class="tagcloudlist">
  <p class="asidetitle">标签云</p>
  <div class="tagcloudlist clearfix">
    
    <a href="http://mospany.github.io/tags/" style="font-size: 12px;"></a>
    
    <a href="http://mospany.github.io/tags/dns" style="font-size: 12px;">dns</a>
    
    <a href="http://mospany.github.io/tags/dpdk" style="font-size: 12px;">dpdk</a>
    
    <a href="http://mospany.github.io/tags/emacs" style="font-size: 12px;">emacs</a>
    
    <a href="http://mospany.github.io/tags/hugo" style="font-size: 12px;">hugo</a>
    
    <a href="http://mospany.github.io/tags/ipv6" style="font-size: 12px;">ipv6</a>
    
    <a href="http://mospany.github.io/tags/k8s" style="font-size: 12px;">k8s</a>
    
    <a href="http://mospany.github.io/tags/openresty" style="font-size: 12px;">openresty</a>
    
    <a href="http://mospany.github.io/tags/org-mode" style="font-size: 12px;">org-mode</a>
    
    <a href="http://mospany.github.io/tags/pango" style="font-size: 12px;">pango</a>
    
    <a href="http://mospany.github.io/tags/redis" style="font-size: 12px;">redis</a>
    
    <a href="http://mospany.github.io/tags/spacemacs" style="font-size: 12px;">spacemacs</a>
    
    <a href="http://mospany.github.io/tags/vim" style="font-size: 12px;">vim</a>
    
    <a href="http://mospany.github.io/tags/vue" style="font-size: 12px;">vue</a>
    
    <a href="http://mospany.github.io/tags/xns" style="font-size: 12px;">xns</a>
    
    <a href="http://mospany.github.io/tags/yaml" style="font-size: 12px;">yaml</a>
    
    <a href="http://mospany.github.io/tags/%e4%ba%91%e8%ae%a1%e7%ae%97" style="font-size: 12px;">云计算</a>
    
    <a href="http://mospany.github.io/tags/%e4%ba%92%e8%81%94%e7%bd%91" style="font-size: 12px;">互联网</a>
    
    <a href="http://mospany.github.io/tags/%e5%89%8d%e7%ab%af" style="font-size: 12px;">前端</a>
    
    <a href="http://mospany.github.io/tags/%e5%8d%9a%e5%ae%a2" style="font-size: 12px;">博客</a>
    
    <a href="http://mospany.github.io/tags/%e5%b7%a5%e5%85%b7" style="font-size: 12px;">工具</a>
    
    <a href="http://mospany.github.io/tags/%e5%be%ae%e4%bf%a1" style="font-size: 12px;">微信</a>
    
    <a href="http://mospany.github.io/tags/%e6%8a%80%e6%9c%af%e6%96%87%e7%ab%a0" style="font-size: 12px;">技术文章</a>
    
    <a href="http://mospany.github.io/tags/%e6%9e%b6%e6%9e%84" style="font-size: 12px;">架构</a>
    
    <a href="http://mospany.github.io/tags/%e7%8b%ac%e7%ab%8b" style="font-size: 12px;">独立</a>
    
    <a href="http://mospany.github.io/tags/%e7%94%9f%e6%b4%bb%e8%ae%b0%e5%bd%95" style="font-size: 12px;">生活记录</a>
    
    <a href="http://mospany.github.io/tags/%e8%81%8c%e5%9c%ba%e4%ba%ba%e7%94%9f" style="font-size: 12px;">职场人生</a>
    
    <a href="http://mospany.github.io/tags/%e8%af%bb%e4%b9%a6%e7%ac%94%e8%ae%b0" style="font-size: 12px;">读书笔记</a>
    
    <a href="http://mospany.github.io/tags/%e9%82%ae%e7%ae%b1" style="font-size: 12px;">邮箱</a>
    
    <a href="http://mospany.github.io/tags/%e9%9d%a2%e8%af%95" style="font-size: 12px;">面试</a>
    
    <a href="http://mospany.github.io/tags/%e9%a1%b9%e7%9b%ae%e5%ae%9e%e8%b7%b5" style="font-size: 12px;">项目实践</a>
    
  </div>
</div>



  
</aside>
</div>

  </div>
  <footer><div id="footer" >
  
  <div class="line">
    <span></span>
    <div style='background:no-repeat url("http://mospany.github.io/img/author.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/qiniu_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/fastweb_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/leadsec_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/raisecom_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  <div class="line">
    <div style='background:no-repeat url("http://mospany.github.io/img/jbt_logo.jpg") left top;-webkit-background-size:6.875em 6.875em;-moz-background-size:6.875em 6.875em;background-size:6.875em 6.875em;' class="author" ></div>
  </div>
  
  
  <div class="social-font clearfix">
    
    <a href="http://weibo.com/mospan" target="_blank" title="weibo"></a>
    
    
    <a href="https://twitter.com/mospan" target="_blank" title="twitter"></a>
    
    
    <a href="https://github.com/mospany" target="_blank" title="github"></a>
    
    
    <a href="https://www.facebook.com/mospan" target="_blank" title="facebook"></a>
    
    
    <a href="https://www.linkedin.com/mospan" target="_blank" title="linkedin"></a>
    
  </div>
  <p class="copyright">Powered by <a href="http://gohugo.io" target="_blank" title="hugo">hugo</a> and Theme by <a href="https://github.com/mospany/mospan-hugo-blog/tree/master/themes/hugo-panman-theme" target="_blank" title="hugo-panman-theme">hugo-panman-theme</a> © 2022
    
    <a href="http://mospany.github.io/" target="_blank" title="mospan">mospan</a>
    
  </p>
</div>
</footer>
  <script src="http://mospany.github.io/js/jquery-2.1.0.min.js"></script>
<script type="text/javascript">
done = false;
$(document).ready(function(){
  $('.navbar').click(function(){
    $('header nav').toggleClass('shownav');
  });
  var myWidth = 0;
  function getSize(){
    if( typeof( window.innerWidth ) == 'number' ) {
      myWidth = window.innerWidth;
    } else if( document.documentElement && document.documentElement.clientWidth) {
      myWidth = document.documentElement.clientWidth;
    };
  };
  var m = $('#main'),
      a = $('#asidepart'),
      c = $('.closeaside'),
      o = $('.openaside');
  $(window).resize(function(){
    getSize();
    if (myWidth >= 1024) {
      $('header nav').removeClass('shownav');
    }else
    {
      m.removeClass('moveMain');
      a.css('display', 'block').removeClass('fadeOut');
      o.css('display', 'none');
    }
  });
  c.click(function(){
    a.addClass('fadeOut').css('display', 'none');
    o.css('display', 'block').addClass('fadeIn');
    m.addClass('moveMain');
  });
  o.click(function(){
    o.css('display', 'none').removeClass('beforeFadeIn');
    a.css('display', 'block').removeClass('fadeOut').addClass('fadeIn');
    m.removeClass('moveMain');
  });
  $(window).scroll(function(){
    o.css("top",Math.max(80,260-$(this).scrollTop()));
  });
  $('form.search').on('submit', function (event) {
    if (false === done) {
      event.preventDefault();
      var orgVal = $(this).find('#search').val();
      $(this).find('#search').val('site:http:\/\/mospany.github.io\/ ' + orgVal);
      done = true;
      $(this).submit();
    }
  });
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var ai = $('.article-content>iframe'),
      ae = $('.article-content>embed'),
      t  = $('#toc'),
      h  = $('article h2')
      ah = $('article h2'),
      ta = $('#toc.toc-aside'),
      o  = $('.openaside'),
      c  = $('.closeaside');
  if(ai.length>0){
    ai.wrap('<div class="video-container" />');
  };
  if(ae.length>0){
   ae.wrap('<div class="video-container" />');
  };
  if(ah.length==0){
    t.css('display','none');
  }else{
    c.click(function(){
      ta.css('display', 'block').addClass('fadeIn');
    });
    o.click(function(){
      ta.css('display', 'none');
    });
    $(window).scroll(function(){
      ta.css("top",Math.max(140,320-$(this).scrollTop()));
    });
  };
});
</script>

<script type="text/javascript">
$(document).ready(function(){
  var $this = $('.share'),
      url = $this.attr('data-url'),
      encodedUrl = encodeURIComponent(url),
      title = $this.attr('data-title'),
      tsina = $this.attr('data-tsina');
  var html = [
  '<a href="#" class="overlay" id="qrcode"></a>',
  '<div class="qrcode clearfix"><span>扫描二维码分享到微信朋友圈</span><a class="qrclose" href="#share"></a><strong>Loading...Please wait</strong><img id="qrcode-pic" data-src="http://s.jiathis.com/qrcode.php?url=' + encodedUrl + '"/></div>',
  '<a href="#textlogo" class="article-back-to-top" title="Top"></a>',
  '<a href="https://www.facebook.com/sharer.php?u=' + encodedUrl + '" class="article-share-facebook" target="_blank" title="Facebook"></a>',
  '<a href="#qrcode" class="article-share-qrcode" title="QRcode"></a>',
  '<a href="https://twitter.com/intent/tweet?url=' + encodedUrl + '" class="article-share-twitter" target="_blank" title="Twitter"></a>',
  '<a href="http://service.weibo.com/share/share.php?title='+title+'&url='+encodedUrl +'&ralateUid='+ tsina +'&searchPic=true&style=number' +'" class="article-share-weibo" target="_blank" title="Weibo"></a>',
  '<span title="Share to"></span>'
  ].join('');
  $this.append(html);
  $('.article-share-qrcode').click(function(){
    var imgSrc = $('#qrcode-pic').attr('data-src');
    $('#qrcode-pic').attr('src', imgSrc);
    $('#qrcode-pic').load(function(){
        $('.qrcode strong').text(' ');
    });
  });
});
</script>


<link rel="stylesheet" href="http://mospany.github.io/fancybox/jquery.fancybox.css" media="screen" type="text/css">
<script src="http://mospany.github.io/fancybox/jquery.fancybox.pack.js"></script>
<script type="text/javascript">
$(document).ready(function(){
  $('.article-content').each(function(i){
    $(this).find('img').each(function(){
      if ($(this).parent().hasClass('fancybox')) return;
      var alt = this.alt;
      if (alt) $(this).after('<span class="caption">' + alt + '</span>');
      $(this).wrap('<a href="' + this.src + '" title="' + alt + '" class="fancybox"></a>');
    });
    $(this).find('.fancybox').each(function(){
      $(this).attr('rel', 'article' + i);
    });
  });
  if($.fancybox){
    $('.fancybox').fancybox();
  }
});
</script>




</body>
</html>
